!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PPTSpeechClient=t():e.PPTSpeechClient=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=16)}([function(e,t,n){"use strict";var r,i,a,s,o,c,l,u,h,m,d;n.d(t,"i",(function(){return r})),n.d(t,"g",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"f",(function(){return o})),n.d(t,"h",(function(){return c})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return u})),n.d(t,"j",(function(){return h})),n.d(t,"k",(function(){return m})),n.d(t,"e",(function(){return d})),function(e){e[e.PptSession=817]="PptSession"}(r||(r={})),function(e){e.Subtitles="Subtitles",e.Rehearsal="Rehearsal",e.Dictation="Dictation",e.Live="Live",e.ReadAlong="ReadAlong",e.ConversationTranscription="ConversationTranscription"}(i||(i={})),function(e){e[e.PowerPoint=0]="PowerPoint",e[e.Word=1]="Word",e[e.OneNote=2]="OneNote",e[e.Outlook=3]="Outlook",e[e.Unknown=4]="Unknown",e[e.LinkedIn=5]="LinkedIn",e[e.Flipgrid=6]="Flipgrid",e[e.OfficeMobie=7]="OfficeMobie",e[e.OfficeSuite=8]="OfficeSuite",e[e.Teams=9]="Teams"}(a||(a={})),function(e){e.web="web",e.win32="win32",e.mac="mac",e.ios="ios",e.android="android"}(s||(s={})),function(e){e.ErrorNone="ErrorNone",e.ErrorInvalidSubscriptionFromConfig="ErrorInvalidSubscriptionFromConfig",e.ErrorInvalidRegionFromConfig="ErrorInvalidRegionFromConfig",e.ErrorAddSessionFailure="ErrorAddSessionFailure",e.ErrorCreateSpeechSessionBadRequest="ErrorCreateSpeechSessionBadRequest",e.ErrorSpeechHandlerWebSocketFailure="ErrorSpeechHandlerWebSocketFailure",e.ErrorInvalidMessage="ErrorInvalidMessage",e.ErrorWaitAudioTimeout="ErrorWaitAudioTimeout",e.ErrorInitialSilenceTimeout="ErrorInitialSilenceTimeout",e.ErrorInitialBabbleTimeout="ErrorInitialBabbleTimeout",e.ErrorProtobufDeserializationFailure="ErrorProtobufDeserializationFailure",e.ErrorSpeechRecognitionFailure="ErrorSpeechRecognitionFailure",e.ErrorTranslationFailure="ErrorTranslationFailure",e.ErrorFailedToGetSupportedTextLanguages="ErrorFailedToGetSupportedTextLanguages",e.ErrorCustomEndpointTimeout="ErrorCustomEndpointTimeout",e.ErrorAudioAbortError="ErrorAudioAbortError",e.ErrorAudioNotAllowedError="ErrorAudioNotAllowedError",e.ErrorAudioNotFoundError="ErrorAudioNotFoundError",e.ErrorAudioNotReadableError="ErrorAudioNotReadableError",e.ErrorAudioOverconstrainedError="ErrorAudioOverconstrainedError",e.ErrorAudioSecurityError="ErrorAudioSecurityError",e.ErrorAudioTypeError="ErrorAudioTypeError",e.ErrorAudioSetupFailure="ErrorAudioSetupFailure",e.ErrorAudioCaptureStalePermission="ErrorAudioCaptureStalePermission",e.ErrorConnectionRetryFailure="ErrorConnectionRetryFailure",e.ErrorWebcamSamplingUnsupportedSpeechMode="ErrorWebcamSamplingUnsupportedSpeechMode",e.ErrorWebcamSetupFailure="ErrorWebcamSetupFailure",e.ErrorWebcamNotFoundError="ErrorWebcamNotFoundError",e.ErrorMultipleWebcamsFound="ErrorMultipleWebcamsFound",e.ErrorMaxConnectionRetryFailureInSession="ErrorMaxConnectionRetryFailureInSession",e.ErrorUnknown="ErrorUnknown"}(o||(o={})),function(e){e.Normal="Normal",e.WaitForSpeechEndTimeout="WaitForSpeechEndTimeout"}(c||(c={})),function(e){e.RehearsalDashboardUpdate="RehearsalDashboardUpdate",e.MediaEvent="MediaEvent",e.QualityStatusUpdate="QualityStatusUpdate",e.ConnectionRetry="ConnectionRetry"}(l||(l={})),function(e){e.AudioDeviceConnected="AudioDeviceConnected",e.VideoSetupCompleted="VideoSetupCompleted"}(u||(u={})),function(e){e[e.None=0]="None",e[e.Listening=1]="Listening",e[e.Warning_CannotHearYou=2]="Warning_CannotHearYou",e[e.Warning_BackgroundNoise=3]="Warning_BackgroundNoise",e[e.Warning_TooLoud=4]="Warning_TooLoud",e[e.Warning_TooQuiet=5]="Warning_TooQuiet",e[e.Warning_WeakConnection=6]="Warning_WeakConnection",e[e.Warning_SlowConnection=7]="Warning_SlowConnection",e[e.Warning_UnstableConnection=8]="Warning_UnstableConnection",e[e.Warning_ServiceIssue=9]="Warning_ServiceIssue",e[e.Error_CannotHearYou=10]="Error_CannotHearYou",e[e.Error_BackgroundNoise=11]="Error_BackgroundNoise",e[e.Error_TooLoud=12]="Error_TooLoud",e[e.Error_TooQuiet=13]="Error_TooQuiet",e[e.Error_WeakConnection=14]="Error_WeakConnection",e[e.Error_SlowConnection=15]="Error_SlowConnection",e[e.Error_UnstableConnection=16]="Error_UnstableConnection",e[e.Error_ServiceIssue=17]="Error_ServiceIssue"}(h||(h={})),function(e){e.Closed="Closed",e.Closing="Closing",e.Connecting="Connecting",e.Open="Open"}(m||(m={})),function(e){e[e.NotStarted=0]="NotStarted",e[e.Started=1]="Started",e[e.Paused=2]="Paused",e[e.Stopped=3]="Stopped"}(d||(d={}))},function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return p})),n.d(t,"d",(function(){return g})),n.d(t,"c",(function(){return S}));var r=n(4),i=n(6),a=n(0),s=n(5),o=n(8),c=n(2),l=n(10),u=n(3),h=n(9);let m;class d{}d.AudioFactorCalculationDurationMS="AudioFactorCalculationDurationMS",d.BufferSize="BufferSize",d.CustomEndpointEnabled="CustomEndpointEnabled",d.CustomEndpointRequestCorrelationID="CustomEndpointRequestCorrelationID",d.CurrentTimestampMS="CurrentTimestampMS",d.DataLoggingTimeInterval="DataLoggingTimeInterval",d.Endpoint="Endpoint",d.FatalErrors="FatalErrors",d.FirstMessageLatencyMS="FirstMessageLatencyMS",d.InitializeWebSocketEndTimeMS="InitializeWebSocketEndTimeMS",d.InitializeWebSocketStartTimeMS="InitializeWebSocketStartTimeMS",d.LatencyTableDeletedCount="LatencyTableDeletedCount",d.MaxFinalMessageLatencyMS="MaxFinalMessageLatencyMS",d.MaxPartialMessageLatencyMS="MaxPartialMessageLatencyMS",d.MessageLatencyCalculationTimeMS="MessageLatencyCalculationTimeMS",d.MinFinalMessageLatencyMS="MinFinalMessageLatencyMS",d.MinPartialMessageLatencyMS="MinPartialMessageLatencyMS",d.NonFatalErrors="NonFatalErrors",d.OnGetUserMediaSuccessEntryPoint="OnGetUserMediaSuccessEntryPoint",d.RealTimeFactorLowerThreshold="RealTimeFactorLowerThreshold",d.RealTimeFactorUpperThreshold="RealTimeFactorUpperThreshold",d.RequestCustomEndpointEndTimeMS="RequestCustomEndpointEndTimeMS",d.RequestCustomEndpointFailedEndTimeMS="RequestCustomEndpointFailedEndTimeMS",d.RequestCustomEndpointStartTimeMS="RequestCustomEndpointStartTimeMS",d.RequestCustomEndpointTimedOutEndTimeMS="RequestCustomEndpointTimedOutEndTimeMS",d.SendFirstMessageTime="SendFirstMessageTime",d.SpeechLanguage="SpeechLanguage",d.TotalAudioFactorOutsideOfThresholdCount="TotalAudioFactorOutsideOfThresholdCount",d.TotalEntriesInLatencyTable="TotalEntriesInLatencyTable",d.TotalFinalMessagesCount="TotalFinalMessagesCount",d.TotalFinalMessageLatency="TotalFinalMessageLatency",d.TotalHighLatencyPartialMessagesCount="TotalHighLatencyPartialMessagesCount",d.TotalHighLatencyFinalMessagesCount="TotalHighLatencyFinalMessagesCount",d.TotalMessageCorrelationIDNotFoundCount="TotalMessageCorrelationIDNotFoundCount",d.TotalNetworkErrorMessageCount="TotalNetworkErrorMessageCount",d.TotalNetworkWarningMessageCount="TotalNetworkWarningMessageCount",d.AverageFrontDoorRoundTripLatencyCount="AverageFrontDoorRoundTripLatencyCount",d.TotalPartialMessageLatency="TotalPartialMessageLatency",d.TotalPartialMessagesCount="TotalPartialMessagesCount",d.TotalTranscriptOutsideOfThresholdCount="TotalTranscriptOutsideOfThresholdCount",d.TranscriberID="TranscriberID",d.TranscriptionEntryPointCalled="TranscriptionEntryPointCalled",d.TranscriptionStartTime="TranscriptionStartTime",d.TranscriptionEndTime="TranscriptionEndTime",d.TranslationLanguage="TranslationLanguage",d.WebSocketClosedTimestamp="WebSocketClosedTimestamp",d.WebSocketConnectionDurationMS="WebSocketConnectionDurationMS",d.WebSocketCreateTimestamp="WebSocketCreateTimestamp",d.WebSocketCustomEndpoint="WebSocketCustomEndpoint",d.WebSocketOpenedTimestamp="WebSocketOpenedTimestamp",d.WebSocketRetryAttempts="WebSocketRetryAttempts",d.WebSocketRetryReason="WebSocketRetryReason",d.FEnableContentlogging="FEnableContentlogging",d.SpeechMode="SpeechMode",d.SpeechClientRecognitionStartTime="SpeechClientConnectionStartTime";class p{}p.CustomEndpointClientError="CustomEndpointClientError",p.CustomEndpointClientFailureReason="CustomEndpointClientFailureReason",p.CustomEndpointServerError="CustomEndpointServerError",p.CustomEndpointServerErrorCode="CustomEndpointServerErrorCode",p.CustomEndpointServerFailureReason="CustomEndpointServerFailureReason",p.ErrorStatus="ErrorStatus",p.InvalidDocId="InvalidDocId",p.MessageErrorCode="MessageErrorCode",p.TranscriptErrorCode="TranscriptErrorCode",p.WebSocketDisconnected="WebSocketDisconnected",p.WebSocketErrorCode="WebSocketErrorCode",p.WebSocketRetryConnectionFailed="WebSocketRetryConnectionFailed",p.WebsocketConnectionFailure="WebsocketConnectionFailure",p.InitializeAudioContextFailed="InitializeAudioContextFailed",p.InitializeTranscriberSessionFailed="InitializeTranscriberSessionFailed",p.GetUserMediaFailed="GetUserMediaFailed",p.ReadSettingsFailed="ReadSettingsFailed",p.DisplayQualityStatusException="DisplayQualityStatusException",p.TemporaryDisableSubtitleDueNetworkError="TemporaryDisableSubtitleDueNetworkError",p.LossInternetConnection="LossInternetConnection";class g{}var T;g.MaxAllowedFragmentLatencyMS=5e3,g.MaxAllowedFinalFragmentLatencyMS=2e4,g.DefaultBufferSize=8192,g.DataLoggingIntervalMS=3e4,g.RealTimeFactorLowerThreshold=0,g.RealTimeFactorUpperThreshold=999,g.IsLogEachTranscriptMessage=!0,g.IsContentLoggingEnabled=!1,g.CustomEndpointRequestTimeoutInMs=5e3,g.HeartbeatInterval=5e3,g.RoundtripLatencyWarnThreshold=500,g.RoundtripLatencyErrorThreshold=2500,g.FragmentLatencyWarnThreshold=2e4,g.FragmentLatencyErrorThreshold=3e4,g.MaxAllowedRetryCountPerSession=15,g.FragmentLatencyWarnWindow=6,g.FragmentLatencyErrorWindow=3,g.NoInternetConnectionInMs=12e4,g.MessageType="mix",g.SpeechFDBase="wss://pptservicescast.officeapps.live.com/",function(e){e.NotStarted="NotStarted",e.InitialConnecting="InitialConnecting",e.InitialConnectionRetrying="InitialConnectionRetrying",e.InitialConnectionRetryingFailed="InitialConnectionRetryingFailed",e.ConnectionSuccessful="ConnectionSuccessful",e.ConnectionDropRetrying="ConnectionDropRetrying",e.ConnectionDropRetryingFailed="ConnectionDropRetryingFailed"}(T||(T={}));class S extends r.EventEmitter{constructor(e,t,n,i,a,s){super(),this.m_wsUri="",this.m_webSocketConnectionRetryAttempts=-1,this.m_webSocketTotalRetryCountInSession=-1,this.c_maxWebSocketRetryAttempts=5,this.c_websocketRetryInterval=5e3,this.m_wsTimer=0,this.m_sessionTimer=new o.a,this.m_transcriberId="",this.m_isFirstWebSocketConnection=!0,this.m_roundLatencyTimerId=0,this.m_sendPingMessageFlag=!1,this.m_fSendClientMetadata=!0,this.m_endpointId=null,this.telemetryManager={},this.speechHealthManager={},this.webSocket=null,this.customSettingsMap=new Map,this.disableStreaming=!1,this.events=new r.EventEmitter,this.generatedUserSessionId=Object(u.v4)(),this.m_fSessionPaused=!1,this.m_fEndOfAudioSent=!1,this.m_fdConnectionState=T.NotStarted,m=i,this.speechConfig=e,this.authProvider=t,this.webSocketFactory=n,this.telemetryManager=a,this.speechHealthManager=s}on(e,t){return this.events.on(e,t),this}onSendEndOfAudio(){this.m_fEndOfAudioSent=!0}setCustomSetting(e,t){this.customSettingsMap.set(e,t)}getCustomSetting(e){return this.customSettingsMap.get(e)}enableVoiceStreaming(){this.disableStreaming=!1,this.m_sessionTimer.resume(),m.sendTraceTag(595632129,a.i.PptSession,c.a.Info,"Voice streaming is enabled: TranscriberID: "+this.m_transcriberId)}disableVoiceStreaming(){this.disableStreaming=!0,this.m_sessionTimer.pause(),m.sendTraceTag(595632130,a.i.PptSession,c.a.Info,"Voice streaming is disabled: TranscriberID: "+this.m_transcriberId)}pauseSpeechRecognition(){this.speechHealthManager.resetMessageLatency(),this.m_fSessionPaused=!0,this.m_sessionTimer.pause()}resumeSpeechRecognition(){this.m_fSessionPaused=!1,this.m_sessionTimer.resume()}getElapsedSessionTimeInMS(){return this.m_sessionTimer.getElapsedSessionTimeInMS()}startConnection(e,t){this.m_fdConnectionState=T.InitialConnecting,this.telemetryManager.recordSpeechRecognitionStart(),this.initialize();let n=Object(u.v4)();m.sendTraceTag(595126293,a.i.PptSession,c.a.Info,"Start speech connection: TranscriberID: "+n),this.disableStreaming=t,this.disableStreaming&&m.sendTraceTag(595632131,a.i.PptSession,c.a.Info,"Voice streaming is disabled: TranscriberID: "+n);let r=g.DefaultBufferSize;isNaN(r)||(g.DefaultBufferSize=r),this.speechConfig.documentDownloadConfig&&!this.speechConfig.requestServiceCustomEndpoint?(m.sendTraceTag(595716118,a.i.PptSession,c.a.Info,JSON.stringify({EnableCustomEndpoint:this.speechConfig.documentDownloadConfig||!1,TranscriberID:n})),this.configureCustomEndpointRequest(e,n)):this.startSpeechConnection(e,n),this.speechHealthManager.startSession(n),this.m_sessionTimer.restart(!this.disableStreaming)}initialize(){this.m_webSocketConnectionRetryAttempts=-1,this.m_webSocketTotalRetryCountInSession=-1,clearTimeout(this.m_wsTimer),this.m_wsTimer=0,this.m_transcriberId="",this.m_isFirstWebSocketConnection=!0,this.m_sendPingMessageFlag=!1,this.m_endpointId=""}stopConnection(){try{this.speechHealthManager.stopSession(),this.telemetryManager.recordSpeechClientConnectionEnd(this.m_transcriberId),this.telemetryManager.recordWebSocketRetryCounts(this.m_webSocketTotalRetryCountInSession),this.m_fdConnectionState!==T.NotStarted&&this.m_fdConnectionState!==T.ConnectionSuccessful&&this.telemetryManager.recordSpeechClientError(p.WebsocketConnectionFailure,this.m_fdConnectionState,Date.now(),!0),this.telemetryManager.publishSessionTelemetry(),this.m_sessionTimer.stop(),this.m_fdConnectionState=T.NotStarted}catch(e){m.sendTraceTag(595716045,a.i.PptSession,c.a.Info,`Transcriber::stopFrontdoorConnection threw an exception:${e}TranscriberID: ${this.m_transcriberId}`)}this.closeWebSocket(),clearTimeout(this.m_wsTimer),this.m_wsTimer=0,this.removeAllListeners()}sendClientRequestMessage(e){if(this.webSocket)if(this.webSocket.readyState===a.k.Open)try{this.webSocket.send(e.serializeBinary())}catch(e){m.sendTraceTag(595711878,a.i.PptSession,c.a.Error,`sendClientRequestMessage threw an exception:${e}. TranscriberID: ${this.m_transcriberId}`)}else m.sendTraceTag(595711877,a.i.PptSession,c.a.Info,`Cannot send client request message because WebSocket not open. WebSocketReadyState: ${this.webSocket.readyState} TranscriberID: ${this.m_transcriberId}`);else m.sendTraceTag(595711876,a.i.PptSession,c.a.Info,"WebSocket is null. TranscriberID: "+this.m_transcriberId)}logTranscriberErrorTelemetry(e){e[d.TranscriberID]=this.m_transcriberId,e[d.CurrentTimestampMS]=Date.now(),m.sendTraceTag(595716049,a.i.PptSession,c.a.Error,JSON.stringify(e))}setTranscriptionResult(e){this.events.emit("text",e)}setTranscriptionErrorText(e){this.events.emit("error",e)}triggerSpeechStatusEvent(e){this.events.emit("speechStatus",e,this.m_transcriberId)}triggerAudioDataEvent(e){this.events.emit("audioData",e)}triggerRehearsalUpdate(e){let t=e.isFinal;this.speechHealthManager.calculatePostMessageLatency(t,e.correlationId,-1),this.events.emit("rehearsalUpdate",e)}triggerQualityStatusUpdate(e){this.events.emit("qualityStatusUpdate",e)}triggerFrontdoorConnectionRetryEvent(){this.events.emit("webSocketConnectionRetry")}triggerSpeechSessionStarted(e){this.events.emit("speechSessionStarted",e)}processAudioChunk(e,t){if(this.disableStreaming||this.m_fSessionPaused)return;if(!this.webSocket)return void m.sendTraceTag(595716169,a.i.PptSession,c.a.Info,"WebSocket is null. TranscriberID: "+this.m_transcriberId);if(this.webSocket.readyState!==a.k.Open)return void m.sendTraceTag(595716170,a.i.PptSession,c.a.Info,`Cannot send audio data because WebSocket not open. WebSocketReadyState: ${this.webSocket.readyState} TranscriberID: ${this.m_transcriberId}`);let n=Date.now(),r=new s.a;r.correlationId=t||Object(u.v4)(),this.speechHealthManager.calculatePreMessageLatency(r.correlationId),this.triggerAudioDataEvent(new Int16Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/2)));const i=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);r.audio=i,r.sourceLanguage=this.speechConfig.sourceLanguage,r.settings.set("targetLanguageList",this.speechConfig.targetLanguages);for(let[e,t]of this.customSettingsMap)"clientMetadata"===e&&(this.m_fSendClientMetadata=!0),r.settings.set(e,t);this.speechConfig.documentDownloadConfig&&this.m_endpointId&&r.settings.set("endpointId",this.m_endpointId),this.m_fSendClientMetadata&&(this.m_fSendClientMetadata=!1,r.setClientMetaData(this.getClientMetaDataMap())),this.m_sendPingMessageFlag&&(r.settings.set("isPingMessage","true"),this.m_sendPingMessageFlag=!1,this.speechHealthManager.onPingMessageSent(r.correlationId)),this.speechConfig.properties&&r.setProperties(this.speechConfig.properties),r.setOperationMetadata(Date.now(),this.m_sessionTimer.getElapsedSessionTimeInMS());const o=r.serializeBinary();this.telemetryManager.recordInitialAudioMessage(),this.speechHealthManager.calculatePreAudioMessageStats(n),this.webSocket.send(o),this.speechHealthManager.calculatePostAudioMessageStats(r.correlationId)}enablePingMessage(){this.m_sendPingMessageFlag||(this.m_sendPingMessageFlag=!0)}startSpeechConnection(e,t){this.m_transcriberId=t;let n=Object(u.v4)(),r=this.speechConfig.speechFDBase||g.SpeechFDBase,i=`${r}SpeechHandler.ashx?action=Transcribe&client=${this.speechConfig.clientType||a.b.web}&session=${this.m_transcriberId}&message=${g.MessageType}&speechMode=${this.speechConfig.speechMode}&sampleRate=${e.sampleRate}&app=${this.speechConfig.clientApp||a.a.PowerPoint}&locale=${this.speechConfig.sourceLanguage}&contenttype=url&requestcorrelationid=${n}`;if(this.speechConfig.scenarioName&&(i+="&scenarioName="+this.speechConfig.scenarioName),this.speechConfig.requestServiceCustomEndpoint&&(i+="&fCreateCustomEndpoint="+this.speechConfig.requestServiceCustomEndpoint),this.speechConfig.documentDownloadConfig){let e=this.sanitizeDocID(this.speechConfig.documentDownloadConfig.docId,t);i+="&PodSID="+this.speechConfig.documentDownloadConfig.podsSessionId+"&podurl="+this.speechConfig.documentDownloadConfig.webServiceBase+"&wacuserdatacluster="+this.speechConfig.documentDownloadConfig.userDataCenterClusterId+"&docid="+e}this.telemetryManager.recordWebSocketConnectionStart(r,t),this.m_wsUri=i,e.onaudioprocess=this.processAudioChunk.bind(this),this.openWebSocketConnection(),this.m_roundLatencyTimerId=0,this.m_sendPingMessageFlag=!1,this.telemetryManager.recordWebSocketConnectionEnd()}sanitizeDocID(e,t){let n="";if(0===e.length)return n;let r=e.indexOf("access_token");return-1===r?m.sendTraceTag(573309463,a.i.PptSession,c.a.Warning,"Transcriber::startSpeechConnection access_token was not found in docID. TranscriberID: "+t):n=e.substring(0,r),n}handleWebSocketOpenEvent(){this.m_fdConnectionState=T.ConnectionSuccessful,this.m_roundLatencyTimerId=setInterval(this.enablePingMessage.bind(this),g.HeartbeatInterval),this.m_isFirstWebSocketConnection&&(this.telemetryManager.recordWebSocketConnectionOpen(),this.m_isFirstWebSocketConnection=!1),clearTimeout(this.m_wsTimer),this.m_wsTimer=0,this.m_webSocketConnectionRetryAttempts=0,this.m_fSendClientMetadata=!0,this.triggerSpeechStatusEvent(i.b.SpeechRecognitionStarted)}handleRehearsalUpdate(e){this.triggerRehearsalUpdate(e)}handleQualityStatusUpdate(e){this.triggerQualityStatusUpdate(e)}handleTranscriptResultMessage(e){if(this.telemetryManager.recordInitialMessageLatency(),"success"===e.status){if(e.isPong)return void this.speechHealthManager.onPongMessageReceived(e.correlationId);let t=e.correlationId;this.setTranscriptionResult(e);let n=e.isFinal;this.speechHealthManager.calculatePostMessageLatency(n,t,-1)}else if("speechEnd"===e.status)this.triggerSpeechStatusEvent(i.b.SpeechEnd);else if("nomatch"===e.status||"notranslation"===e.status){let t=e.messageErrorCode;switch(null!=t&&""!==t||(t="ErrorUnknown"),e.transcriptErrorCode){case"NoMatchReason:NotRecognized":break;case"NoMatchReason:InitialBabbleTimeout":this.setTranscriptionErrorText("ErrorInitialBabbleTimeout");break;case"NoMatchReason:InitialSilenceTimeout":this.setTranscriptionErrorText("ErrorInitialSilenceTimeout");break;case"NoMatchReason:KeywordNotRecognized":break;default:this.handleOnMessageTranscriptionError(e)}}else this.handleOnMessageTranscriptionError(e)}handleOnMessageTranscriptionError(e){try{null==e&&m.sendTraceTag(595716051,a.i.PptSession,c.a.Warning,`Transcriber::handleOnMessageTranscriptionError TranscriberID${this.m_transcriberId}\n           Response received from speech service was null.`);let t=e.messageErrorCode;null!=t&&""!==t||(t="Unknown");let n=e.transcriptErrorCode;-1===["ErrorProtobufDeserializationFailure","ErrorInvalidSubscriptionFromConfig","ErrorInvalidRegionFromConfig","ErrorAddSessionFailure","ErrorInvalidMessage","ErrorCreateSpeechSessionBadRequest","ErrorWaitAudioTimeout","ErrorSpeechHandlerWebSocketFailure","ErrorSpeechRecognitionFailure","ErrorTranslationFailure","ErrorFailedToGetSupportedTextLanguages","ErrorCustomEndpointTimeout"].indexOf(t)?this.telemetryManager.recordSpeechClientError(t,`${n}_${e.status}`,Date.now(),!1):this.telemetryManager.recordSpeechClientError(t,"",Date.now(),!0),this.setTranscriptionErrorText(t);let r={};r[p.MessageErrorCode]=t,r[p.TranscriptErrorCode]=n,r[p.ErrorStatus]=e.status,this.logTranscriberErrorTelemetry(r)}catch(e){m.sendTraceTag(595716052,a.i.PptSession,c.a.Warning,`Transcriber::handleOnMessageTranscriptionError TranscriberID${this.m_transcriberId}Exception thrown: ${e}`)}}handleSpeechResultMessage(e){this.handleTranscriptResultMessage(e)}handleSpeechSessionStartedMessage(e){this.triggerSpeechSessionStarted(e)}handleRehearsalResultMessage(e){this.handleRehearsalUpdate(e)}handleQualityStatusMessage(e){this.handleQualityStatusUpdate(e)}handleWebSocketMessage(e){Object(s.c)(e,this)}handleWebSocketCloseEvent(e){if(this.closeIntervalTimer(),1e3!==e){let t={};t[p.WebSocketErrorCode]=e,t[d.WebSocketRetryReason]="WebSocketDisconnected",this.logTranscriberErrorTelemetry(t),this.telemetryManager.recordWebsocketCloseError(e),this.retryWebSocketConnectionWrapper()}}openWebSocketConnection(){this.m_webSocketTotalRetryCountInSession+=1,this.m_webSocketConnectionRetryAttempts+=1,this.m_isFirstWebSocketConnection&&0===this.m_webSocketTotalRetryCountInSession&&this.telemetryManager.recordWebSocketCreation(),this.webSocket&&(m.sendTraceTag(595716109,a.i.PptSession,c.a.Warning,"Transcriber::OpenWebSocketConnection Found existing web socket connection. Closing it and will open a new one. TranscriberID: "+this.m_transcriberId),this.closeWebSocket()),this.webSocket=this.webSocketFactory.createWebSocket(this.m_wsUri),{}[d.WebSocketRetryReason]="WebSocketConnectionTimeout",this.retryWebSocketConnectionWrapper(),this.webSocket.onopen=this.handleWebSocketOpenEvent.bind(this),this.webSocket.onmessage=this.handleWebSocketMessage.bind(this),this.webSocket.onclose=this.handleWebSocketCloseEvent.bind(this)}retryWebSocketConnection(){if(clearTimeout(this.m_wsTimer),this.m_wsTimer=0,this.speechHealthManager.resetMessageLatency(),!this.m_fEndOfAudioSent){if(!this.shouldRetryConnection())return clearTimeout(this.m_wsTimer),this.m_wsTimer=0,void this.closeWebSocket();m.sendTraceTag(595716056,a.i.PptSession,c.a.Info,`Transcriber::RetryWebSocketConnection - WebSocket retry attempt: ${this.m_webSocketConnectionRetryAttempts}\n        TranscriberID: ${this.m_transcriberId}`),this.closeWebSocket(),this.m_fdConnectionState=this.m_isFirstWebSocketConnection?T.InitialConnectionRetrying:this.m_fdConnectionState=T.ConnectionDropRetrying,this.triggerFrontdoorConnectionRetryEvent(),this.openWebSocketConnection()}}retryWebSocketConnectionWrapper(){0===this.m_wsTimer&&(this.m_wsTimer=setTimeout(this.retryWebSocketConnection.bind(this),this.c_websocketRetryInterval))}configureCustomEndpointRequest(e,t){if(!this.speechConfig.documentDownloadConfig)return;let n={docId:this.speechConfig.documentDownloadConfig.docId,speechFrontDoorBase:this.speechConfig.speechFDBase||g.SpeechFDBase,podUrl:this.speechConfig.documentDownloadConfig.webServiceBase,podSessionId:this.speechConfig.documentDownloadConfig.podsSessionId,speechLanguage:this.speechConfig.sourceLanguage,isContentLoggingEnabled:g.IsContentLoggingEnabled,CustomEndpointRequestTimeoutInMs:g.CustomEndpointRequestTimeoutInMs,transcriberID:t,logger:m,telemetryManager:this.telemetryManager,userDataCenterClusterId:this.speechConfig.documentDownloadConfig.userDataCenterClusterId,userSessionId:this.speechConfig.userSessionId||this.generatedUserSessionId,speechMode:this.speechConfig.speechMode,clientApp:this.speechConfig.clientApp||a.a.PowerPoint};Object(l.a)(n).then(n=>{this.m_endpointId=n.customEndpointID,""===this.m_transcriberId&&this.startSpeechConnection(e,t)}).catch(n=>{this.telemetryManager.recordSpeechClientError(n.recordErrorCode,n.recordErrorReason,Date.now(),!1),this.logTranscriberErrorTelemetry(n.errorInfo),""===this.m_transcriberId&&this.startSpeechConnection(e,t)})}getClientMetaDataMap(){for(let[e,t]of this.customSettingsMap)if("clientMetadata"===e){Object(h.isNullOrUndefined)(this.speechConfig.clientMetaData)&&(this.speechConfig.clientMetaData=new Map);let e=JSON.parse(t);for(const t of Object.keys(e))this.speechConfig.clientMetaData.set(t,e[t])}let e=this.speechConfig.clientApp||a.a.PowerPoint,t={supportedResponseTypes:"speechresultmixmessage,qualitystatusmixmessage,rehearsalresultmixMessage,speechSessionStartedMixMessage",authorization:this.authProvider.accessToken};if(Object(h.isNullOrUndefined)(e)||(t.app=e),!Object(h.isNullOrUndefined)(this.speechConfig.clientMetaData))for(let[e,n]of this.speechConfig.clientMetaData)t[e]=n;return t}closeIntervalTimer(){0!==this.m_roundLatencyTimerId&&(clearInterval(this.m_roundLatencyTimerId),this.m_roundLatencyTimerId=0)}closeWebSocket(){this.webSocket&&(this.closeIntervalTimer(),this.webSocket.onclose=function(){},this.webSocket.close(),this.webSocket=null)}shouldRetryConnection(){let e=!0,t="",n="";if(this.speechConfig.maxRetryCountsInSession&&this.m_webSocketTotalRetryCountInSession>=this.speechConfig.maxRetryCountsInSession?(t=a.f.ErrorMaxConnectionRetryFailureInSession,n="Client specified maximum retry counts in session reached",e=!1):this.m_webSocketConnectionRetryAttempts>=this.c_maxWebSocketRetryAttempts&&(t=a.f.ErrorConnectionRetryFailure,n="Maximum retry count reached in current window",e=!1),m.sendTraceTag(571770508,a.i.PptSession,c.a.Info,`WebSocket connection retry failed with error: ${n} TranscriberID: ${this.m_transcriberId}`),!e){this.setTranscriptionErrorText(t),this.m_fdConnectionState=this.m_isFirstWebSocketConnection?T.InitialConnectionRetryingFailed:this.m_fdConnectionState=T.ConnectionDropRetryingFailed;let e={};return e[p.WebSocketRetryConnectionFailed]="WebSocketRetryConnectionFailed",this.logTranscriberErrorTelemetry(e),!1}return!0}}},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(r||(r={}))},function(e,t,n){var r=n(21),i=n(22),a=i;a.v1=r,a.v4=i,e.exports=a},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var i,a,s,o;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),s=a[t]),void 0===s)s=a[t]=n,++e._eventsCount;else if("function"==typeof s?s=a[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=l(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,o=c,console&&console.warn&&console.warn(o)}return e}function h(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,e))}function m(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)a(c,this,t);else{var l=c.length,u=g(c,l);for(n=0;n<l;++n)a(u[n],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,m(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,m(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,a,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){s=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,a=Object.keys(n);for(r=0;r<a.length;++r)"removeListener"!==(i=a[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return d(this,e,!0)},o.prototype.rawListeners=function(e){return d(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";function r(e){let t=Object.create(null);for(let[n,r]of e)t[n]=r;return t}function i(e){let t=new Map;if(e)for(let n of Object.keys(e))t.set(n,e[n]);return t}n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return h})),n(19);class a{constructor(e){this.speechResultJson=JSON.parse(e),this.transcriptsMap=i(this.speechResultJson.transcripts),this.propertiesMap=i(this.speechResultJson.properties)}get correlationId(){return this.speechResultJson.correlationId}get status(){return this.speechResultJson.status}get sourceLanguage(){return this.speechResultJson.sourceLanguage}get transcripts(){return this.transcriptsMap}get properties(){return this.propertiesMap}get isAdapted(){return this.speechResultJson.isAdapted}get isFinal(){return this.speechResultJson.isFinal}get isPong(){return this.speechResultJson.isPongMessage}get transcriptErrorCode(){return this.speechResultJson.transcriptErrorCode}get messageErrorCode(){return this.speechResultJson.messageErrorCode}}class s{constructor(e){this.rehearsalResultJson=JSON.parse(e),this.featuresMap=function e(t){let n=new Map;for(let r of Object.keys(t))t[r]instanceof Object?n.set(r,e(t[r])):n.set(r,t[r]);return n}(this.rehearsalResultJson.features)}get correlationId(){return this.rehearsalResultJson.correlationId}get status(){return this.rehearsalResultJson.status}get sourceLanguage(){return this.rehearsalResultJson.sourceLanguage}get isFinal(){return this.rehearsalResultJson.isFinal}get currentSlideIndex(){return this.rehearsalResultJson.currentSlideIndex}get features(){return this.featuresMap}}class o{constructor(e){this.qualityStatusJson=JSON.parse(e)}get severity(){return this.qualityStatusJson.severity}get priority(){return this.qualityStatusJson.priority}get shortCode(){return this.qualityStatusJson.shortCode}get longCode(){return this.qualityStatusJson.longCode}get shortString(){return this.qualityStatusJson.shortString}get longString(){return this.qualityStatusJson.longString}}class c{constructor(e){this.speechSessionStartedJson=JSON.parse(e)}get speechSessionId(){return this.speechSessionStartedJson.speechSessionId}get transcriptionSignature(){return this.speechSessionStartedJson.transcriptionSignature}get speechSessionHostDataCenter(){return this.speechSessionStartedJson.speechSessionHostDataCenter}}class l{constructor(){this.settings=new Map}setProperties(e){this.settings.set("properties",JSON.stringify(r(e)))}setOperationMetadata(e,t){let n={clientSentTimeMS:e,clientSessionSentTimeMS:t};this.settings.set("operationMetadata",JSON.stringify(n))}setClientMetaData(e){this.settings.set("clientMetadata",JSON.stringify(e))}serializeBinary(){let e=(new TextEncoder).encode(JSON.stringify({correlationId:this.correlationId,sourceLanguage:this.sourceLanguage,settings:r(this.settings)})),t=new Uint8Array(4+e.byteLength+(null==this.audio?0:this.audio.byteLength));return t.set(function(e){let t=new ArrayBuffer(4);return new DataView(t).setInt32(0,e,!1),new Uint8Array(t)}(e.byteLength)),t.set(e,4),null!=this.audio&&t.set(this.audio,4+e.byteLength),t}}class u{constructor(e,t){this.type=e,this.message=t}serializeBinary(){let e=(new TextEncoder).encode(JSON.stringify({type:this.type,message:this.message})),t=new Uint8Array(4+e.byteLength);return t.set(e,4),t}static fromMap(e){return new u("DictionaryMessage",JSON.stringify(r(e)))}}function h(e,t){let n=JSON.parse((new TextDecoder).decode(e));"speechresultmixmessage"===n.messageType&&t.handleSpeechResultMessage(new a(n.message)),"rehearsalresultmixmessage"===n.messageType&&t.handleRehearsalResultMessage(new s(n.message)),"qualitystatusmixmessage"===n.messageType&&t.handleQualityStatusMessage(new o(n.message)),"speechsessionstartedmixmessage"===n.messageType&&t.handleSpeechSessionStartedMessage(new c(n.message))}},function(e,t,n){"use strict";n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return S}));var r=n(1),i=n(0),a=n(5),s=n(7),o=n(2),c=n(11),l=n(12),u=n(15),h=n(8),m=n(13),d=n(4);let p;var g;!function(e){e[e.SpeechRecognitionStarted=0]="SpeechRecognitionStarted",e[e.SpeechEnd=1]="SpeechEnd"}(g||(g={}));class T{}T.ProcessVisionDataCommand="processVisionData",T.HandleClientMetaData="handleClientMetaData";class S{constructor(e,t,n,a,o,u){this.speechRecognitionPaused=!1,this.telemetryManager={},this.webcamClient=null,this.speechHealthManager={},this.events=new d.EventEmitter,this.onText=e=>{if(this.speechClientObserver){let t=Object(h.b)(e.transcripts),n=this.getRecognitionResultMetadata(e.properties);e.isFinal?(this.speechClientObserver.onFinalText(e.transcripts,e.properties),this.speechClientObserver.onFinalRecognitionText&&this.speechClientObserver.onFinalRecognitionText(t,n),this.events.emit("FinalReceived")):(this.speechClientObserver.onFragmentText(e.transcripts,e.properties),this.speechClientObserver.onPartialRecognitionText&&this.speechClientObserver.onPartialRecognitionText(t,n))}},this.onErr=e=>{this.speechClientObserver&&this.speechClientObserver.onError(e)},this.onSpeechStatus=(e,t)=>{if(this.speechClientObserver)switch(e){case g.SpeechRecognitionStarted:!this.speechRecognitionPaused&&this.speechClientObserver&&this.speechClientObserver.onSpeechRecognitionStarted&&(this.speechClientObserver.onSpeechRecognitionStarted(t),this.speechClientConfig.sendClientMetaDataOnSessionStart&&this.sendClientMetaData(t));break;case g.SpeechEnd:this.speechClientObserver&&this.speechClientObserver.onSpeechEnd&&this.speechClientObserver.onSpeechEnd(),this.events.emit("SpeechEnd")}},this.onSpeechSessionStarted=e=>{this.speechClientObserver&&this.speechClientObserver.onSpeechSessionStarted&&this.speechClientObserver.onSpeechSessionStarted(e)},this.onAudioData=e=>{this.speechClientObserver&&this.speechClientObserver.onAudioData&&this.speechClientObserver.onAudioData(e)},this.onRehearsalUpdate=e=>{if(this.speechClientObserver&&this.speechClientObserver.onEventUpdate){let t={eventName:i.c.RehearsalDashboardUpdate,currentSlideIndex:e.currentSlideIndex,features:e.features};this.speechClientObserver.onEventUpdate(t)}e.isFinal&&this.events.emit("FinalReceived")},this.onQualityStatusUpdate=e=>{if(this.speechClientObserver&&this.speechClientObserver.onEventUpdate){let t={eventName:i.c.QualityStatusUpdate,severity:e.severity,priority:e.priority,shortCode:e.shortCode,longCode:e.longCode,shortString:e.shortString,longString:e.longString};this.speechClientObserver.onEventUpdate(t)}},this.onFrontDoorConnectionRetry=()=>{if(this.speechClientObserver&&this.speechClientObserver.onEventUpdate){let e={eventName:i.c.ConnectionRetry};this.speechClientObserver.onEventUpdate(e)}},this.speechClientObserver=t,p=o,this.speechClientConfig=e,this.mediaSource=a||new c.a(this.speechClientConfig.speechProcessorScript,e.microphoneDeviceId),this.telemetryManager=new l.a(p),this.speechHealthManager=new m.a(p,this.telemetryManager),this.speechFrontDoorProxy=new r.c(this.speechClientConfig,n,u||new s.a,p,this.telemetryManager,this.speechHealthManager),this.startWebcamCapture(),this.registerSpeechFrontDoorEvents()}async startSpeechRecognition(e){this.telemetryManager.recordSpeechClientConnectionStart(this.speechClientConfig),this.speechRecognitionPaused=!1,await this.tryInitializeUserMedia()&&this.speechFrontDoorProxy.startConnection(this.mediaSource,e||!1)}startWebcamCapture(){this.speechClientConfig.webcamConfig&&(this.webcamClient?p.sendTraceTag(593019980,i.i.PptSession,o.a.Warning,"SpeechClient::startWebcamCapture webcam already exists"):this.webcamClient=new u.a(this.speechClientConfig.webcamConfig,this.onWebcamFrame.bind(this)))}stopWebcamCapture(){this.webcamClient&&(this.webcamClient.stopMediaCapture(),this.webcamClient=null)}resumeWebcamCapture(){if(this.webcamClient)if(this.speechClientConfig.captureAudioPauseResumeRecordingState){this.webcamClient.startMediaCapture();let e={eventName:i.c.MediaEvent,mediaStatus:i.d.VideoSetupCompleted};this.speechClientObserver&&this.speechClientObserver.onEventUpdate&&this.speechClientObserver.onEventUpdate(e)}else this.webcamClient.resumeMediaCapture()}pauseWebcamCapture(){this.webcamClient&&(this.speechClientConfig.captureAudioPauseResumeRecordingState?this.webcamClient.stopMediaCapture():this.webcamClient.pauseMediaCapture())}stopSpeechRecognition(){if(this.speechClientConfig.handleEndOfAudioInSpeechClientStopRecognition){this.sendEndOfAudio();let e=new Promise((e,t)=>{let n=this.speechClientConfig.handleEndOfAudioTimeoutInMS?this.speechClientConfig.handleEndOfAudioTimeoutInMS:1e4;setTimeout(e,n,i.h.WaitForSpeechEndTimeout)}),t=new Promise((e,t)=>{this.events.on("SpeechEnd",e)});Promise.race([e,t]).then(e=>{this.closeConnectionInternal(),this.speechClientObserver&&this.speechClientObserver.onSpeechRecognitionStopped&&(e?this.speechClientObserver.onSpeechRecognitionStopped(String(e)):this.speechClientObserver.onSpeechRecognitionStopped(i.h.Normal))})}else this.mediaSource.stopAudioCapture(),this.closeConnectionInternal(),this.speechClientObserver&&this.speechClientObserver.onSpeechRecognitionStopped&&this.speechClientObserver.onSpeechRecognitionStopped(i.h.Normal)}closeConnectionInternal(){this.speechFrontDoorProxy.stopConnection(),this.speechRecognitionPaused=!1}sendEndOfAudio(){this.speechFrontDoorProxy.onSendEndOfAudio(),this.mediaSource.stopAudioCapture(),this.sendDictionaryRequestMessage(new Map([["command","endOfAudio"]]))}pauseSpeechRecognition(){this.speechRecognitionPaused=!0,this.speechClientConfig.captureAudioPauseResumeRecordingState?this.mediaSource.stopAudioCapture():this.mediaSource.pauseAudioCapture(),this.sendDictionaryRequestMessage(new Map([["command","pause"]])),this.speechFrontDoorProxy.pauseSpeechRecognition()}resumeSpeechRecognition(){this.speechRecognitionPaused=!1,this.speechClientConfig.captureAudioPauseResumeRecordingState?this.mediaSource.startAudioCapture():this.mediaSource.resumeAudioCapture(),this.sendDictionaryRequestMessage(new Map([["command","resume"]])),this.speechFrontDoorProxy.resumeSpeechRecognition()}setCustomSetting(e,t){this.speechFrontDoorProxy.setCustomSetting(e,t)}getCustomSetting(e){return this.speechFrontDoorProxy.getCustomSetting(e)}enableVoiceStreaming(){this.speechFrontDoorProxy.enableVoiceStreaming()}disableVoiceStreaming(){this.speechFrontDoorProxy.disableVoiceStreaming()}sendDictionaryRequestMessage(e){this.sendClientRequestMessage(a.b.fromMap(e))}sendGenericRequestMessage(e,t){this.sendClientRequestMessage(new a.b(e,t))}sendClientRequestMessage(e){this.speechFrontDoorProxy.sendClientRequestMessage(e)}getRecognitionResultMetadata(e){let t={};return e.size>0&&e.forEach((e,n)=>{if(e)if("JsonResult"===n){let n=JSON.parse(e);t.id=n.Id,t.duration=n.Duration,t.offset=n.Offset,t.properties=JSON.parse(e)}else null===t.properties||void 0===t.properties?t.properties={key:e}:t.properties[n]=e;else p.sendTraceTag(592229530,i.i.PptSession,o.a.Info,`SpeechClient::getRecognitionResultMetadata value is null for key: ${n} }`)}),t}async tryInitializeUserMedia(){try{let e=await this.mediaSource.startAudioCapture();if(e!==i.f.ErrorNone)return this.telemetryManager.recordSpeechClientError(r.a.GetUserMediaFailed,e,Date.now(),!1),this.onErr(e),!1;{let e={eventName:i.c.MediaEvent,mediaStatus:i.d.AudioDeviceConnected};this.speechClientObserver&&this.speechClientObserver.onEventUpdate&&this.speechClientObserver.onEventUpdate(e)}}catch(e){return this.telemetryManager.recordSpeechClientError(r.a.GetUserMediaFailed,"ErrorAudio"+e.name,Date.now(),!1),this.speechClientObserver&&this.speechClientObserver.onError&&this.speechClientObserver.onError("ErrorAudio"+e.name),!1}if(this.webcamClient)try{let e=await this.webcamClient.startMediaCapture();if(e!==i.f.ErrorNone)return this.telemetryManager.recordSpeechClientError(r.a.GetUserMediaFailed,e,Date.now(),!1),this.speechClientObserver&&this.speechClientObserver.onError&&this.speechClientObserver.onError("ErrorVideo"+e),!1;{let e={eventName:i.c.MediaEvent,mediaStatus:i.d.VideoSetupCompleted};this.speechClientObserver&&this.speechClientObserver.onEventUpdate&&this.speechClientObserver.onEventUpdate(e)}}catch(e){return this.telemetryManager.recordSpeechClientError(r.a.GetUserMediaFailed,"ErrorVideo"+e.name,Date.now(),!1),this.speechClientObserver&&this.speechClientObserver.onError&&this.speechClientObserver.onError("ErrorVideo"+e.name),!1}return!0}registerSpeechFrontDoorEvents(){this.speechFrontDoorProxy.on("text",e=>{this.onText(e)}),this.speechFrontDoorProxy.on("error",e=>{this.onErr(e)}),this.speechFrontDoorProxy.on("speechStatus",(e,t)=>{this.onSpeechStatus(e,t)}),this.speechFrontDoorProxy.on("speechSessionStarted",e=>{this.onSpeechSessionStarted(e)}),this.speechFrontDoorProxy.on("audioData",e=>{this.onAudioData(e)}),this.speechFrontDoorProxy.on("rehearsalUpdate",e=>{this.onRehearsalUpdate(e)}),this.speechFrontDoorProxy.on("qualityStatusUpdate",e=>{this.onQualityStatusUpdate(e)}),this.speechFrontDoorProxy.on("webSocketConnectionRetry",()=>{this.onFrontDoorConnectionRetry()}),this.speechHealthManager.on("qualityStatusUpdate",e=>{this.onQualityStatusUpdate(e)})}sendClientMetaData(e){let t=new Map;t.set("command",T.HandleClientMetaData),t.set("data",JSON.stringify(this.speechFrontDoorProxy.getClientMetaDataMap())),t.set("speechMode",this.speechClientConfig.speechMode),t.set("SessionId",e),this.sendDictionaryRequestMessage(t)}onWebcamFrame(e,t){let n={clientSentTimeMS:Date.now(),clientSessionSentTimeMS:this.speechFrontDoorProxy.getElapsedSessionTimeInMS()},r=new Map;r.set("command",T.ProcessVisionDataCommand),r.set("data",e),r.set("correlation",t||""),r.set("operationMetadata",JSON.stringify(n)),this.sendDictionaryRequestMessage(r)}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0);class i{constructor(e){this.closeHandler=null,this.messageHandler=null,this.openHandler=null,this.webSocket=new WebSocket(e),this.webSocket.binaryType="arraybuffer",this.webSocket.onclose=e=>{this.closeHandler&&this.closeHandler(e.code)},this.webSocket.onmessage=e=>{this.messageHandler&&this.messageHandler(e.data)},this.webSocket.onopen=()=>{this.openHandler&&this.openHandler()}}close(){this.webSocket.close()}send(e){this.webSocket.send(e)}get onclose(){return this.closeHandler}set onclose(e){this.closeHandler=e}get onmessage(){return this.messageHandler}set onmessage(e){this.messageHandler=e}get onopen(){return this.openHandler}set onopen(e){this.openHandler=e}get readyState(){switch(this.webSocket.readyState){case WebSocket.OPEN:return r.k.Open;case WebSocket.CONNECTING:return r.k.Connecting;case WebSocket.CLOSING:return r.k.Closing;case WebSocket.CLOSED:default:return r.k.Closed}}}class a{createWebSocket(e){return new i(e)}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a}));var r=n(0);function i(e){let t={};for(let[n,r]of e)t[n]=r;return t}class a{constructor(){this.lastStartTimeInMS=Date.now(),this.elapsedSessionTimeInMS=0,this.timerState=r.e.NotStarted,this.elapsedSessionTimeInMS=0,this.timerState=r.e.NotStarted}restart(e){this.timerState=e?r.e.Started:r.e.Paused,this.lastStartTimeInMS=Date.now(),this.elapsedSessionTimeInMS=0}resume(){this.timerState===r.e.Paused&&(this.timerState=r.e.Started,this.lastStartTimeInMS=Date.now())}pause(){this.timerState===r.e.Started&&(this.timerState=r.e.Paused,this.elapsedSessionTimeInMS+=Date.now()-this.lastStartTimeInMS)}stop(){this.timerState===r.e.Started&&(this.elapsedSessionTimeInMS+=Date.now()-this.lastStartTimeInMS),this.timerState=r.e.Stopped}getElapsedSessionTimeInMS(){return this.timerState===r.e.Started?this.elapsedSessionTimeInMS+(Date.now()-this.lastStartTimeInMS):this.elapsedSessionTimeInMS}}},function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},i=/%[sdj%]/g;t.format=function(e){if(!S(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(o(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,a=r.length,s=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),c=r[n];n<a;c=r[++n])g(c)||!f(c)?s+=" "+c:s+=" "+o(c);return s},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}};var a,s={};function o(e,n){var r={seen:[],stylize:l};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),u(r,e,r.depth)}function c(e,t){var n=o.styles[t];return n?"["+o.colors[n][0]+"m"+e+"["+o.colors[n][1]+"m":e}function l(e,t){return e}function u(e,n,r){if(e.customInspect&&n&&v(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return S(i)||(i=u(e,i,r)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(S(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return T(t)?e.stylize(""+t,"number"):p(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}(e,n);if(a)return a;var s=Object.keys(n),o=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(n)),_(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return h(n);if(0===s.length){if(v(n)){var c=n.name?": "+n.name:"";return e.stylize("[Function"+c+"]","special")}if(C(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(b(n))return e.stylize(Date.prototype.toString.call(n),"date");if(_(n))return h(n)}var l,f="",M=!1,I=["{","}"];return d(n)&&(M=!0,I=["[","]"]),v(n)&&(f=" [Function"+(n.name?": "+n.name:"")+"]"),C(n)&&(f=" "+RegExp.prototype.toString.call(n)),b(n)&&(f=" "+Date.prototype.toUTCString.call(n)),_(n)&&(f=" "+h(n)),0!==s.length||M&&0!=n.length?r<0?C(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),l=M?function(e,t,n,r,i){for(var a=[],s=0,o=t.length;s<o;++s)F(t,String(s))?a.push(m(e,t,n,r,String(s),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(m(e,t,n,r,i,!0))})),a}(e,n,r,o,s):s.map((function(t){return m(e,n,r,o,t,M)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(l,f,I)):I[0]+f+I[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,n,r,i,a){var s,o,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?o=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(o=e.stylize("[Setter]","special")),F(r,i)||(s="["+i+"]"),o||(e.seen.indexOf(c.value)<0?(o=g(n)?u(e,c.value,null):u(e,c.value,n-1)).indexOf("\n")>-1&&(o=a?o.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+o.split("\n").map((function(e){return"   "+e})).join("\n")):o=e.stylize("[Circular]","special")),y(s)){if(a&&i.match(/^\d+$/))return o;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+o}function d(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function g(e){return null===e}function T(e){return"number"==typeof e}function S(e){return"string"==typeof e}function y(e){return void 0===e}function C(e){return f(e)&&"[object RegExp]"===M(e)}function f(e){return"object"==typeof e&&null!==e}function b(e){return f(e)&&"[object Date]"===M(e)}function _(e){return f(e)&&("[object Error]"===M(e)||e instanceof Error)}function v(e){return"function"==typeof e}function M(e){return Object.prototype.toString.call(e)}function I(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(y(a)&&(a=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!s[n])if(new RegExp("\\b"+n+"\\b","i").test(a)){var r=e.pid;s[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else s[n]=function(){};return s[n]},t.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=p,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=T,t.isString=S,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=C,t.isObject=f,t.isDate=b,t.isError=_,t.isFunction=v,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(24);var E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function w(){var e=new Date,t=[I(e.getHours()),I(e.getMinutes()),I(e.getSeconds())].join(":");return[e.getDate(),E[e.getMonth()],t].join(" ")}function F(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",w(),t.format.apply(t,arguments))},t.inherits=n(25),t._extend=function(e,t){if(!t||!f(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var R="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function L(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(R&&e[R]){var t;if("function"!=typeof(t=e[R]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),R&&Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=R,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var a=this,s=function(){return i.apply(a,arguments)};t.apply(this,n).then((function(t){e.nextTick(s,null,t)}),(function(t){e.nextTick(L,t,s)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(23))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(2),i=n(0),a=n(1),s=n(3);function o(e){let t={},n={};return new Promise(async(o,c)=>{let l=e.logger;if(0===e.docId.length)return n.recordErrorCode=a.a.InvalidDocId,n.recordErrorReason="",t[a.a.CustomEndpointClientFailureReason]="InvalidDocId",n.errorInfo=t,void c(n);let u=e.docId,h=e.docId.indexOf("access_token");-1===h?l.sendTraceTag(595716120,i.i.PptSession,r.a.Warning,"Transcriber::RequestCustomEndpoint access_token was not found in docID. TranscriberID: "+e.transcriberID):u=e.docId.substring(0,h);const m=Object(s.v4)();l.sendTraceTag(595716121,i.i.PptSession,r.a.Info,`Transcriber::RequestCustomEndpoint CorrelationID: ${m} TranscriberID: ${e.transcriberID}`);let d=e.speechFrontDoorBase.replace("wss","https");d=d.replace("ws","http");const p=`${d}CustomEndpointHandler.ashx?action=GetOrCreateCustomEndpoint&podurl=${e.podUrl}&PODSID=${e.podSessionId}&docid=${u}&locale=${e.speechLanguage}&client=web&contenttype=url&fenablecontentlogging=${e.isContentLoggingEnabled}&correlationid=${m}&wacusersessionid=${e.userSessionId}&wacuserdatacluster=${e.userDataCenterClusterId}\n    &speechMode=${e.speechMode}&app=${e.clientApp}`;let g=new XMLHttpRequest;e.telemetryManager.recordCustomEndpointStart(m),g.open("POST",p,!0),g.timeout=e.CustomEndpointRequestTimeoutInMs,g.send(),g.onload=()=>{l.sendTraceTag(595716160,i.i.PptSession,r.a.Info,"requestCustomEndpointHandler: OnLoad Transcriber ID: "+e.transcriberID),n.customEndpointID=g.getResponseHeader("X-EndpointID"),e.telemetryManager.recordCustomEndpointEnd(n.customEndpointID),o(n)},g.onerror=()=>{l.sendTraceTag(595716161,i.i.PptSession,r.a.Info,"requestCustomEndpointHandler: OnError Transcriber ID: "+e.transcriberID),n.recordErrorCode=a.a.CustomEndpointServerError,n.recordErrorReason=`${g.getResponseHeader("X-ErrorCode")} ${g.getResponseHeader("X-FailureReason")} ${g.status}`,e.telemetryManager.recordCustomEndpointError();let t={};t[a.a.CustomEndpointServerErrorCode]=g.getResponseHeader("X-ErrorCode"),t[a.a.CustomEndpointServerFailureReason]=g.getResponseHeader("X-FailureReason"),n.errorInfo=t,c(n)},g.ontimeout=()=>{l.sendTraceTag(595716162,i.i.PptSession,r.a.Info,"requestCustomEndpointHandler: OnTimeout Transcriber ID: "+e.transcriberID),n.recordErrorCode=a.a.CustomEndpointClientError,n.recordErrorReason="CustomEndpointRequestTimeout";let t={};t[a.a.CustomEndpointClientFailureReason]="CustomEndpointRequestTimeout",n.errorInfo=t,e.telemetryManager.recordCustomEndpointTimeout(),c(n)}})}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0),i=n(3);class a{constructor(e,t){this.mediaStream=null,this.messageLen=0,this.MAX_BUFFER_SIZE=4096,this.message=new Float32Array(4096),this.m_audioCaptureInProgress=!1,this.audioHandler=null,this.c_maxBufferSize=16384,this.speechProcessorScript=e,this.m_microphoneDeviceId=t}async startAudioCapture(){let e=null;return e=!this.m_microphoneDeviceId||{deviceId:{exact:this.m_microphoneDeviceId}},this.m_audioCaptureInProgress=!0,this.mediaStream=await navigator.mediaDevices.getUserMedia({audio:e,video:!1}),this.m_audioCaptureInProgress?this.initializeAudioSession():(this.stopAudioCapture(),r.f.ErrorAudioCaptureStalePermission)}stopAudioCapture(){this.m_audioCaptureInProgress=!1,this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>{e.stop()}),this.mediaStream=null),this.streamSource&&(this.scriptNode&&this.streamSource.disconnect(this.scriptNode),this.streamSource=null),this.scriptNode&&(this.scriptNode.onaudioprocess=null,this.scriptNode.disconnect(this.audioCtx.destination),this.scriptNode=null),this.speechProcessorScript&&this.m_workletNode&&(this.m_workletNode.disconnect(this.audioCtx.destination),this.m_workletNode=null)}pauseAudioCapture(){this.setAudioEnabled(!1)}resumeAudioCapture(){this.setAudioEnabled(!0)}get sampleRate(){return this.audioCtx?this.audioCtx.sampleRate:null}get onaudioprocess(){return this.audioHandler}set onaudioprocess(e){this.audioHandler=e}setAudioEnabled(e){this.mediaStream&&this.mediaStream.getTracks().forEach(t=>{t.enabled=e})}initializeAudioSession(){return this.audioCtx=a.createAudioContext(),this.audioCtx?(this.speechProcessorScript&&this.audioCtx.audioWorklet?this.audioCtx.audioWorklet.addModule(this.speechProcessorScript).then(()=>{this.connectToMediaWithAudioWorklet()}).catch(()=>{this.connectToMediaWithScriptProcessor()}):this.connectToMediaWithScriptProcessor(),r.f.ErrorNone):r.f.ErrorAudioSetupFailure}connectToMediaWithAudioWorklet(){let e=new AudioWorkletNode(this.audioCtx,"speech-processor");e.port.onmessage=e=>{const t=e.data;if(this.messageLen===this.MAX_BUFFER_SIZE){if(this.audioHandler){let e=a.encodeWAVWithoutHeader(this.message);this.audioHandler(e,Object(i.v4)())}this.messageLen=0}this.message.set(t,this.messageLen),this.messageLen+=t.length};const t=this.audioCtx.createMediaStreamSource(this.mediaStream);t.connect(e),e.connect(this.audioCtx.destination),this.m_workletNode=e,this.streamSource=t}connectToMediaWithScriptProcessor(){this.streamSource=this.audioCtx.createMediaStreamSource(this.mediaStream);let e=Math.pow(2,Math.floor(Math.log(.2*this.audioCtx.sampleRate)/Math.log(2))),t=e<=this.c_maxBufferSize?e:this.c_maxBufferSize;this.scriptNode=this.audioCtx.createScriptProcessor(t,1,1),this.scriptNode.onaudioprocess=e=>{if(this.audioHandler){let t=a.encodeWAVWithoutHeader(e.inputBuffer.getChannelData(0));this.audioHandler(t,Object(i.v4)())}},this.streamSource.connect(this.scriptNode),this.scriptNode.connect(this.audioCtx.destination)}static createAudioContext(){let e;try{e=new AudioContext}catch(e){}if(!e)try{e=new window.webkitAudioContext}catch(e){}return e}static encodeWAVWithoutHeader(e){const t=new ArrayBuffer(2*e.length),n=new DataView(t);return a.floatTo16BitPCM(n,0,e),n}static floatTo16BitPCM(e,t,n){let r=t;for(let t=0;t<n.length;t+=1,r+=2){const i=Math.max(-1,Math.min(1,n[t]));e.setInt16(r,i<0?32768*i:32767*i,!0)}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(2),i=n(0),a=n(1);let s;class o{constructor(e){this.m_sessionTelemetry=new Map,this.m_fatalErrors=new Array,this.m_nonFatalErrors=new Array,s=e,this.recordSpeechSettings()}publishSessionTelemetry(){s.sendTraceTag(595686043,i.i.PptSession,r.a.Info,JSON.stringify(function(e){let t=Object.create(null);for(let[n,r]of e)t[n]=r;return t}(this.m_sessionTelemetry)))}recordSpeechSettings(){this.m_sessionTelemetry.set(a.b.DataLoggingTimeInterval,a.d.DataLoggingIntervalMS),this.m_sessionTelemetry.set(a.b.FEnableContentlogging,a.d.IsContentLoggingEnabled),this.m_sessionTelemetry.set(a.b.RealTimeFactorLowerThreshold,a.d.RealTimeFactorLowerThreshold),this.m_sessionTelemetry.set(a.b.RealTimeFactorUpperThreshold,a.d.RealTimeFactorUpperThreshold)}recordSpeechClientConnectionStart(e){this.initialize(),this.m_sessionTelemetry.set(a.b.TranscriptionStartTime,Date.now()),this.m_sessionTelemetry.set(a.b.SpeechLanguage,e.sourceLanguage),this.m_sessionTelemetry.set(a.b.TranslationLanguage,e.targetLanguages),this.m_sessionTelemetry.set(a.b.SpeechMode,e.speechMode)}recordSpeechRecognitionStart(){this.m_sessionTelemetry.set(a.b.SpeechClientRecognitionStartTime,Date.now())}recordSpeechClientConnectionEnd(e){this.m_sessionTelemetry.set(a.b.TranscriptionEndTime,Date.now()),this.m_sessionTelemetry.has(a.b.WebSocketOpenedTimestamp)||s.sendTraceTag(593253271,i.i.PptSession,r.a.Warning,"recordSpeechClientConnectionEnd: WebSocketOpenedTimestamp is null. TranscriberID:  "+e);let t=Date.now(),n=t-this.m_sessionTelemetry.get(a.b.WebSocketOpenedTimestamp);this.m_sessionTelemetry.set(a.b.WebSocketClosedTimestamp,t),this.m_sessionTelemetry.set(a.b.WebSocketConnectionDurationMS,n),this.m_sessionTelemetry.set(a.b.FatalErrors,this.m_fatalErrors),this.m_sessionTelemetry.set(a.b.NonFatalErrors,this.m_nonFatalErrors)}recordWebSocketConnectionStart(e,t){let n="Unknown";n=-1!==e.toLowerCase().indexOf(".edog")?"EDog":-1!==e.toLowerCase().indexOf(".live-int.")?"Int":"Production",this.m_sessionTelemetry.set(a.b.TranscriberID,t),this.m_sessionTelemetry.set(a.b.Endpoint,n),this.m_sessionTelemetry.set(a.b.InitializeWebSocketStartTimeMS,Date.now())}recordWebSocketCreation(){this.m_sessionTelemetry.set(a.b.WebSocketCreateTimestamp,Date.now())}recordWebSocketRetryCounts(e){this.m_sessionTelemetry.set(a.b.WebSocketRetryAttempts,e)}recordWebSocketConnectionOpen(){this.m_sessionTelemetry.set(a.b.WebSocketOpenedTimestamp,Date.now())}recordWebSocketConnectionEnd(){this.m_sessionTelemetry.set(a.b.InitializeWebSocketEndTimeMS,Date.now())}recordCustomEndpointStart(e){this.m_sessionTelemetry.set(a.b.CustomEndpointRequestCorrelationID,e),this.m_sessionTelemetry.set(a.b.RequestCustomEndpointStartTimeMS,Date.now())}recordCustomEndpointEnd(e){this.m_sessionTelemetry.set(a.b.WebSocketCustomEndpoint,e),this.m_sessionTelemetry.set(a.b.RequestCustomEndpointEndTimeMS,Date.now())}recordCustomEndpointError(){this.m_sessionTelemetry.set(a.b.RequestCustomEndpointFailedEndTimeMS,Date.now())}recordCustomEndpointTimeout(){this.m_sessionTelemetry.set(a.b.RequestCustomEndpointTimedOutEndTimeMS,Date.now())}recordFrontdoorRoundTripLatency(e){this.m_sessionTelemetry.set(a.b.AverageFrontDoorRoundTripLatencyCount,e)}recordNetworkQuality(e,t){this.m_sessionTelemetry.set(a.b.TotalNetworkErrorMessageCount,e),this.m_sessionTelemetry.set(a.b.TotalNetworkWarningMessageCount,t)}recordInitialAudioMessage(){this.m_sessionTelemetry.has(a.b.SendFirstMessageTime)||this.m_sessionTelemetry.set(a.b.SendFirstMessageTime,Date.now())}recordAudioStatistics(e,t){this.m_sessionTelemetry.set(a.b.AudioFactorCalculationDurationMS,e),this.m_sessionTelemetry.set(a.b.TotalAudioFactorOutsideOfThresholdCount,t)}recordInitialMessageLatency(){if(!this.m_sessionTelemetry.has(a.b.FirstMessageLatencyMS)&&this.m_sessionTelemetry.get(a.b.SendFirstMessageTime)){let e=Date.now()-this.m_sessionTelemetry.get(a.b.SendFirstMessageTime);this.m_sessionTelemetry.set(a.b.FirstMessageLatencyMS,e)}}recordPartialMessageLatency(e,t,n,r,i){this.m_sessionTelemetry.set(a.b.MaxPartialMessageLatencyMS,e),this.m_sessionTelemetry.set(a.b.MinPartialMessageLatencyMS,t),this.m_sessionTelemetry.set(a.b.TotalPartialMessagesCount,n),this.m_sessionTelemetry.set(a.b.TotalHighLatencyPartialMessagesCount,r),this.m_sessionTelemetry.set(a.b.TotalPartialMessageLatency,i)}recordFinalMessageLatency(e,t,n,r,i){this.m_sessionTelemetry.set(a.b.MaxFinalMessageLatencyMS,e),this.m_sessionTelemetry.set(a.b.MinFinalMessageLatencyMS,t),this.m_sessionTelemetry.set(a.b.TotalFinalMessagesCount,n),this.m_sessionTelemetry.set(a.b.TotalHighLatencyFinalMessagesCount,r),this.m_sessionTelemetry.set(a.b.TotalFinalMessageLatency,i)}recordMessageLatencyStats(e,t,n){this.m_sessionTelemetry.set(a.b.TotalMessageCorrelationIDNotFoundCount,e),this.m_sessionTelemetry.set(a.b.LatencyTableDeletedCount,t),this.m_sessionTelemetry.set(a.b.TotalEntriesInLatencyTable,n)}recordRealTimeReceiveFactorStats(e,t){this.m_sessionTelemetry.set(a.b.TotalTranscriptOutsideOfThresholdCount,e),this.m_sessionTelemetry.set(a.b.MessageLatencyCalculationTimeMS,t)}recordSpeechClientError(e,t,n,a){let o={};o.ErrorName=e||"ErrorEmpty",o.ErrorReason=t,o.ClientTimestampMS=n;let c=a?this.m_fatalErrors:this.m_nonFatalErrors;c.length<10?c.push(o):s.sendTraceTag(593253272,i.i.PptSession,r.a.Warning,"Transcriber::recordSpeechClientError Will not append error to error list because the list contains too many errors "+JSON.stringify(o))}recordWebsocketCloseError(e){this.m_sessionTelemetry.set(a.a.WebSocketErrorCode,e)}initialize(){this.m_fatalErrors=[],this.m_nonFatalErrors=[],this.m_sessionTelemetry.clear()}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(2),i=n(0),a=n(1),s=n(14),o=n(4);let c;class l{}var u;l.HeartbeatInterval=5e3,l.RoundtripLatencyWarnThreshold=500,l.PongMessageReceieveMaxTimeout=l.HeartbeatInterval+1e4,l.NetworkPingPongWarningThresholdInMs=500,l.NetworkPingPongErrorThresholdInMs=2e3,l.NetworkPingPongMaxWarningCount=6,l.NetworkPingPongMaxErrorCount=3,l.NetworkQualityWarningPriority=10,l.NetworkQualityErrorPriority=100,function(e){e[e.Normal=0]="Normal",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(u||(u={}));class h{constructor(e,t){this.m_transcriberId="",this.m_heartbeatSendTime=0,this.m_currentHeartbeatSendInterval=0,this.m_gapNumberBetweenPingPongMessage=0,this.m_countRoundtripLatencyInWarnWindow=0,this.m_countRoundtripLatencyInErrorWindow=0,this.m_countFragmentLatencyInWarnWindow=0,this.m_countFragmentLatencyInErrorWindow=0,this.m_inFragmentLatencyWarnStatus=!1,this.m_inFragmentLatencyErrorStatus=!1,this.m_totalNetworkErrorMessageCount=0,this.m_totalNetworkWarningMessageCount=0,this.m_currentHeartbeatLatency=0,this.m_messageLatencyTable={},this.m_totalEntriesInLatencyTable=0,this.c_maxEntriesInLatencyTable=1200,this.m_latencyTableDeletedCount=0,this.m_totalPartialMessagesCount=0,this.m_totalPartialMessageLatency=0,this.m_maxPartialMessageLatency=Number.MIN_VALUE,this.m_minPartialMessageLatency=Number.MAX_VALUE,this.m_totalHighLatencyPartialMessagesCount=0,this.m_maxFinalMessageLatency=Number.MIN_VALUE,this.m_minFinalMessageLatency=Number.MAX_VALUE,this.m_totalFinalMessagesCount=0,this.m_totalHighLatencyFinalMessagesCount=0,this.m_totalFinalMessageLatency=0,this.m_totalMessageCorrelationIDNotFoundCount=0,this.m_networkQualityWarningCount=0,this.m_networkQualityErrorCount=0,this.m_currentNetworkQualityStatus=0,this.m_pongMessageTimerId=0,this.m_isWaitingForPongResponse=!1,this.m_frontdoorRoundTripLatencyCount=0,this.m_frontdoorTotalRoundTripLatency=0,this.events=new o.EventEmitter,c=e,this.telemetryManager=t,this.m_realTimeFactorHandler=new s.a(e,this.telemetryManager)}on(e,t){return this.events.on(e,t),this}startSession(e){this.initialize(),this.m_transcriberId=e,this.m_realTimeFactorHandler.startSession(e),this.m_pongMessageTimerId=setInterval(this.checkForPongResponse.bind(this),l.PongMessageReceieveMaxTimeout)}resetMessageLatency(){this.m_messageLatencyTable={}}initialize(){this.m_transcriberId="",this.m_heartbeatSendTime=0,this.m_currentHeartbeatSendInterval=0,this.m_gapNumberBetweenPingPongMessage=0,this.m_countRoundtripLatencyInWarnWindow=0,this.m_countRoundtripLatencyInErrorWindow=0,this.m_countFragmentLatencyInWarnWindow=0,this.m_countFragmentLatencyInErrorWindow=0,this.m_inFragmentLatencyWarnStatus=!1,this.m_inFragmentLatencyErrorStatus=!1,this.m_totalNetworkErrorMessageCount=0,this.m_totalNetworkWarningMessageCount=0,this.m_currentHeartbeatLatency=0,this.m_messageLatencyTable={},this.m_totalEntriesInLatencyTable=0,this.m_latencyTableDeletedCount=0,this.m_totalPartialMessagesCount=0,this.m_totalPartialMessageLatency=0,this.m_maxPartialMessageLatency=Number.MIN_VALUE,this.m_minPartialMessageLatency=Number.MAX_VALUE,this.m_totalHighLatencyPartialMessagesCount=0,this.m_maxFinalMessageLatency=Number.MIN_VALUE,this.m_minFinalMessageLatency=Number.MAX_VALUE,this.m_totalFinalMessagesCount=0,this.m_totalHighLatencyFinalMessagesCount=0,this.m_totalFinalMessageLatency=0,this.m_totalMessageCorrelationIDNotFoundCount=0,this.m_networkQualityWarningCount=0,this.m_networkQualityErrorCount=0,this.m_currentNetworkQualityStatus=0,this.m_frontdoorRoundTripLatencyCount=0,this.m_frontdoorTotalRoundTripLatency=0}logRoundTripLatencyInfo(e,t){let n={CountFragmentLatencyInErrorWindow:this.m_countFragmentLatencyInErrorWindow,CountFragmentLatencyInWarnWindow:this.m_countFragmentLatencyInWarnWindow,CountRoundtripLatencyInErrorWindow:this.m_countRoundtripLatencyInErrorWindow,CountRoundtripLatencyInWarnWindow:this.m_countRoundtripLatencyInWarnWindow,CurrentHearbeatSendInterval:this.m_currentHeartbeatSendInterval,CurrentHeartbeatLatency:this.m_currentHeartbeatLatency,RoundtripLatencyMS:t,MessageCorrelationID:e,TranscriberID:this.m_transcriberId};c.sendTraceTag(595716097,i.i.PptSession,r.a.Warning,JSON.stringify(n))}logMessageLatencyInfo(e,t){let n={CountFragmentLatencyInErrorWindow:this.m_countFragmentLatencyInErrorWindow,CountFragmentLatencyInWarnWindow:this.m_countFragmentLatencyInWarnWindow,CountRoundtripLatencyInErrorWindow:this.m_countRoundtripLatencyInErrorWindow,CountRoundtripLatencyInWarnWindow:this.m_countRoundtripLatencyInWarnWindow,CurrentHearbeatSendInterval:this.m_currentHeartbeatSendInterval,CurrentHeartbeatLatency:this.m_currentHeartbeatLatency,PartialMessageLatency:t,MessageCorrelationID:e,TranscriberID:this.m_transcriberId};c.sendTraceTag(595716097,i.i.PptSession,r.a.Warning,JSON.stringify(n))}calculateMessageLatencyStats(e,t){t>=a.d.FragmentLatencyWarnThreshold?(this.m_countFragmentLatencyInWarnWindow=Math.min(a.d.FragmentLatencyWarnWindow,this.m_countFragmentLatencyInWarnWindow+1),t>=a.d.FragmentLatencyErrorThreshold?this.m_countFragmentLatencyInErrorWindow=Math.min(a.d.FragmentLatencyErrorWindow,this.m_countFragmentLatencyInErrorWindow+1):this.m_countFragmentLatencyInErrorWindow=Math.max(0,this.m_countFragmentLatencyInErrorWindow-1)):(this.m_countFragmentLatencyInWarnWindow=Math.max(0,this.m_countFragmentLatencyInWarnWindow-1),this.m_countFragmentLatencyInErrorWindow=Math.max(0,this.m_countFragmentLatencyInErrorWindow-1)),t>=a.d.FragmentLatencyWarnThreshold&&this.logMessageLatencyInfo(e,t)}calculateRoundTripLatencyStats(e,t){t>=a.d.RoundtripLatencyWarnThreshold?(this.m_countRoundtripLatencyInWarnWindow=Math.min(a.d.FragmentLatencyWarnWindow,this.m_countRoundtripLatencyInWarnWindow+1),t>=a.d.RoundtripLatencyErrorThreshold?this.m_countRoundtripLatencyInErrorWindow=Math.min(a.d.FragmentLatencyErrorWindow,this.m_countRoundtripLatencyInErrorWindow+1):this.m_countRoundtripLatencyInErrorWindow=Math.max(0,this.m_countRoundtripLatencyInErrorWindow-1)):(this.m_countRoundtripLatencyInWarnWindow=Math.max(0,this.m_countRoundtripLatencyInWarnWindow-1),this.m_countRoundtripLatencyInErrorWindow=Math.max(0,this.m_countRoundtripLatencyInErrorWindow-1)),t>=a.d.RoundtripLatencyWarnThreshold&&this.logRoundTripLatencyInfo(e,t)}calculateNetworkQualityStats(e,t,n){let s=this.m_currentHeartbeatSendInterval>=a.d.HeartbeatInterval+a.d.RoundtripLatencyWarnThreshold,o=this.m_currentHeartbeatLatency>=a.d.RoundtripLatencyWarnThreshold,l=!s&&o;this.m_countFragmentLatencyInErrorWindow>=a.d.FragmentLatencyErrorWindow||this.m_countRoundtripLatencyInErrorWindow>=a.d.FragmentLatencyErrorWindow?(this.m_inFragmentLatencyErrorStatus=!0,this.m_totalNetworkErrorMessageCount+=1):0===this.m_countFragmentLatencyInErrorWindow&&0===this.m_countRoundtripLatencyInErrorWindow&&(this.m_inFragmentLatencyErrorStatus=!1,this.m_gapNumberBetweenPingPongMessage=0),this.m_countFragmentLatencyInWarnWindow>=a.d.FragmentLatencyWarnWindow||this.m_countRoundtripLatencyInWarnWindow>=a.d.FragmentLatencyWarnWindow?(this.m_inFragmentLatencyWarnStatus=!0,this.m_totalNetworkWarningMessageCount+=1):0===this.m_countFragmentLatencyInWarnWindow&&0===this.m_countRoundtripLatencyInWarnWindow&&(this.m_inFragmentLatencyWarnStatus=!1);let u={CountFragmentLatencyInErrorWindow:this.m_countFragmentLatencyInErrorWindow,CountFragmentLatencyInWarnWindow:this.m_countFragmentLatencyInWarnWindow,CountRoundtripLatencyInErrorWindow:this.m_countRoundtripLatencyInErrorWindow,CountRoundtripLatencyInWarnWindow:this.m_countRoundtripLatencyInWarnWindow,PartialMessageLatency:t,RoundtripLatencyMS:n,MessageCorrelationID:e,TranscriberID:this.m_transcriberId,CurrentHearbeatSendInterval:this.m_currentHeartbeatSendInterval,CurrentHeartbeatLatency:this.m_currentHeartbeatLatency,IsHighHeartbeatLatency:o,IsBrowserFreeze:s,IsNetworkIssue:l};this.m_inFragmentLatencyErrorStatus?c.sendTraceTag(595716098,i.i.PptSession,r.a.Error,JSON.stringify(u)):this.m_inFragmentLatencyWarnStatus&&c.sendTraceTag(595716099,i.i.PptSession,r.a.Error,JSON.stringify(u))}onPingMessageSent(e){this.m_isWaitingForPongResponse=!0;let t=0!==this.m_heartbeatSendTime?this.m_heartbeatSendTime:Date.now(),n=Date.now(),s=n-t;this.m_heartbeatSendTime=n,this.m_currentHeartbeatSendInterval=s;let o={RealHeartbeatSendInterval:s,PreHeartbeatSendTime:t,CurHeartbeatSendTime:n,TranscriberID:this.m_transcriberId,CorrelationID:e};if(s>l.HeartbeatInterval+l.RoundtripLatencyWarnThreshold?c.sendTraceTag(595716173,i.i.PptSession,r.a.Warning,JSON.stringify(o)):c.sendTraceTag(595716174,i.i.PptSession,r.a.Info,JSON.stringify(o)),this.m_gapNumberBetweenPingPongMessage>=2){let t=a.d.NoInternetConnectionInMs;this.calculateRoundTripLatencyStats(e,t),this.calculateNetworkQualityStats(e,-1,t),c.sendTraceTag(595716175,i.i.PptSession,r.a.Error,`Transcriber::startSpeechConnection Probably loss network connection: TranscriberID: ${this.m_transcriberId} CorrelationID: ${e}`),this.telemetryManager.recordSpeechClientError(a.a.LossInternetConnection,"gapNumberBetweenPingPongMessage :"+this.m_gapNumberBetweenPingPongMessage,Date.now(),!1)}this.m_gapNumberBetweenPingPongMessage+=1}checkForPongResponse(){this.m_isWaitingForPongResponse&&this.updateNetworkQuality(u.Error)}detectNetworkQuality(e){switch(e>=l.NetworkPingPongWarningThresholdInMs&&this.m_networkQualityWarningCount<l.NetworkPingPongMaxWarningCount?this.m_networkQualityWarningCount+=1:e<l.NetworkPingPongWarningThresholdInMs&&this.m_networkQualityWarningCount>0&&(this.m_networkQualityWarningCount-=1),e>=l.NetworkPingPongErrorThresholdInMs&&this.m_networkQualityErrorCount<l.NetworkPingPongMaxErrorCount?this.m_networkQualityErrorCount+=1:e<l.NetworkPingPongErrorThresholdInMs&&this.m_networkQualityErrorCount>0&&(this.m_networkQualityErrorCount-=1),this.m_currentNetworkQualityStatus){case u.Normal:this.m_networkQualityErrorCount===l.NetworkPingPongMaxErrorCount?this.updateNetworkQuality(u.Error):this.m_networkQualityWarningCount===l.NetworkPingPongMaxWarningCount&&this.updateNetworkQuality(u.Warning);break;case u.Warning:this.m_networkQualityErrorCount===l.NetworkPingPongMaxErrorCount?this.updateNetworkQuality(u.Error):0===this.m_networkQualityErrorCount&&0===this.m_networkQualityWarningCount&&this.updateNetworkQuality(u.Normal);break;case u.Error:0===this.m_networkQualityErrorCount&&this.m_networkQualityWarningCount>0?this.updateNetworkQuality(u.Warning):0===this.m_networkQualityErrorCount&&0===this.m_networkQualityWarningCount&&this.updateNetworkQuality(u.Normal)}}updateNetworkQuality(e){if(this.m_currentNetworkQualityStatus===e)return;this.m_currentNetworkQualityStatus=e;let t=0,n=0;switch(e){case u.Normal:t=0,n=i.j.None;break;case u.Warning:t=l.NetworkQualityWarningPriority,n=i.j.Warning_SlowConnection;break;case u.Error:t=l.NetworkQualityErrorPriority,n=i.j.Error_SlowConnection}let r={severity:0,priority:t,shortCode:n,longCode:0,shortString:"",longString:""};this.events.emit("qualityStatusUpdate",r)}onPongMessageReceived(e){this.m_isWaitingForPongResponse=!1;let t=-1;this.m_gapNumberBetweenPingPongMessage-=1;let n=Date.now();t=n-this.m_heartbeatSendTime,this.calculateFrontDoorRoundTripLatency(e),this.m_currentHeartbeatLatency=t;let s={RoundtripLatency:t,HeartbeatSendTime:this.m_heartbeatSendTime,HeartbeatReceiveTime:n,TranscriberID:this.m_transcriberId,CorrelationID:e};t>a.d.RoundtripLatencyWarnThreshold?c.sendTraceTag(595716113,i.i.PptSession,r.a.Warning,JSON.stringify(s)):c.sendTraceTag(595716114,i.i.PptSession,r.a.Info,JSON.stringify(s)),this.calculateRoundTripLatencyStats(e,this.m_currentHeartbeatLatency),this.calculateNetworkQualityStats(e,-1,this.m_currentHeartbeatLatency)}calculatePreMessageLatency(e){try{let t=Date.now();if(this.m_messageLatencyTable[e]=t,this.m_totalEntriesInLatencyTable+=1,this.m_totalEntriesInLatencyTable>this.c_maxEntriesInLatencyTable){let e=6e4;this.m_latencyTableDeletedCount+=1;for(let n in this.m_messageLatencyTable)this.m_messageLatencyTable[n]<t-e&&(delete this.m_messageLatencyTable[n],this.m_totalEntriesInLatencyTable-=1);c.sendTraceTag(595716171,i.i.PptSession,r.a.Info,`Transcriber::calculatePreMessageLatency Deleted all entries in the latency table older than 1 minute. Number of times entries in the latency table have surpassed allowed max: \n                ${this.m_latencyTableDeletedCount} TranscriberID: ${this.m_transcriberId}`)}}catch(e){c.sendTraceTag(595716172,i.i.PptSession,r.a.Warning,`Transcriber::calculatePreMessageLatency Exception while calculating message latency ${e} TranscriberID: ${this.m_transcriberId}`)}}calculatePartialMessageLatency(e,t,n,s){let o=Date.now();if(this.m_totalPartialMessagesCount+=1,this.m_totalPartialMessageLatency+=n,this.m_maxPartialMessageLatency=Math.max(this.m_maxPartialMessageLatency,n),this.m_minPartialMessageLatency=Math.min(this.m_minPartialMessageLatency,n),n>a.d.MaxAllowedFragmentLatencyMS&&(this.m_totalHighLatencyPartialMessagesCount+=1,!a.d.IsLogEachTranscriptMessage)){let a=this.m_totalPartialMessageLatency/this.m_totalPartialMessagesCount;c.sendTraceTag(595716101,i.i.PptSession,r.a.Warning,JSON.stringify({PartialMessageCount:this.m_totalPartialMessagesCount,PartialMessageLatency:n,MaxPartialMessageLatency:this.m_maxPartialMessageLatency,MinPartialMessageLatency:this.m_minPartialMessageLatency,AvePartialMessageLatency:a,TotalPartialMessageLatency:this.m_totalPartialMessageLatency,MessageCorrelationID:e,MessageSentTime:s,CurrentTime:o,TotalHighLatencyPartialMessagesCount:this.m_totalHighLatencyPartialMessagesCount,HeartbeatRoundtripLatency:t,TranscriberID:this.m_transcriberId}))}this.calculateMessageLatencyStats(e,n),this.calculateRoundTripLatencyStats(e,t),this.calculateNetworkQualityStats(e,n,t)}calculateFinalMessageLatency(e,t,n,s){let o=Date.now();if(this.m_totalFinalMessagesCount+=1,this.m_totalFinalMessageLatency+=n,this.m_maxFinalMessageLatency=Math.max(this.m_maxFinalMessageLatency,n),this.m_minFinalMessageLatency=Math.min(this.m_minFinalMessageLatency,n),n>a.d.MaxAllowedFinalFragmentLatencyMS&&(this.m_totalHighLatencyFinalMessagesCount+=1,!a.d.IsLogEachTranscriptMessage)){let a=this.m_totalFinalMessageLatency/this.m_totalFinalMessagesCount;c.sendTraceTag(595716102,i.i.PptSession,r.a.Warning,JSON.stringify({FinalMessageCount:this.m_totalFinalMessagesCount,FinalMessageLatency:n,MaxFinalMessageLatency:this.m_maxFinalMessageLatency,MinFinalMessageLatency:this.m_minFinalMessageLatency,AveFinalMessageLatency:a,TotalFinalMessageLatency:this.m_totalFinalMessageLatency,MessageCorrelationID:e,MessageSentTime:s,CurrentTime:o,TotalHighLatencyFinalMessagesCount:this.m_totalHighLatencyFinalMessagesCount,HeartbeatRoundtripLatency:t,TranscriberID:this.m_transcriberId}))}for(let e in this.m_messageLatencyTable)this.m_messageLatencyTable[e]<=s&&(delete this.m_messageLatencyTable[e],this.m_totalEntriesInLatencyTable-=1)}calculatePostMessageLatency(e,t,n){try{let a=Date.now(),s=0,o=this.m_messageLatencyTable[t];o?(s=Date.now()-o,e?this.calculateFinalMessageLatency(t,n,s,o):this.calculatePartialMessageLatency(t,n,s,o)):(this.m_totalMessageCorrelationIDNotFoundCount+=1,c.sendTraceTag(595716103,i.i.PptSession,r.a.Warning,`calculatePostMessageLatency: correlationID: ${t} was not present in the correlationID table. Total messages with the correlation id not found ${this.m_totalMessageCorrelationIDNotFoundCount}\n          TranscriberID: ${this.m_transcriberId} isFinalMessage: ${e}`)),this.m_realTimeFactorHandler.calculateAndLogRealTimeReceiveFactorStats(a,t,s,n,e)}catch(e){c.sendTraceTag(595716107,i.i.PptSession,r.a.Warning,`calculatePostMessageLatency:Calculating the message latency threw an exception: ${e} TranscriberID: ${this.m_transcriberId}`)}}calculatePreAudioMessageStats(e){this.m_realTimeFactorHandler.calculatePreAudioMetrics(e)}calculatePostAudioMessageStats(e){this.m_realTimeFactorHandler.calculateAndLogRealTimeSendFactorStats(e)}isNetworkError(){return!!this.m_inFragmentLatencyErrorStatus&&(c.sendTraceTag(595716115,i.i.PptSession,r.a.Warning,"SpeechHealthManager: Temporary network error"),this.telemetryManager.recordSpeechClientError(a.a.TemporaryDisableSubtitleDueNetworkError,"Network error with error windows : "+this.m_countFragmentLatencyInErrorWindow,Date.now(),!1),!0)}stopSession(){this.m_pongMessageTimerId&&(clearInterval(this.m_pongMessageTimerId),this.m_pongMessageTimerId=0),this.m_realTimeFactorHandler.onSessionEnd();let e=this.m_frontdoorTotalRoundTripLatency/this.m_frontdoorRoundTripLatencyCount;this.telemetryManager.recordFrontdoorRoundTripLatency(e),this.telemetryManager.recordNetworkQuality(this.m_totalNetworkErrorMessageCount,this.m_totalNetworkWarningMessageCount),this.telemetryManager.recordMessageLatencyStats(this.m_totalMessageCorrelationIDNotFoundCount,this.m_latencyTableDeletedCount,this.m_totalEntriesInLatencyTable),this.telemetryManager.recordPartialMessageLatency(this.m_maxPartialMessageLatency,this.m_minPartialMessageLatency,this.m_totalPartialMessagesCount,this.m_totalHighLatencyPartialMessagesCount,this.m_totalPartialMessageLatency),this.telemetryManager.recordFinalMessageLatency(this.m_maxFinalMessageLatency,this.m_minFinalMessageLatency,this.m_totalFinalMessagesCount,this.m_totalHighLatencyFinalMessagesCount,this.m_totalFinalMessageLatency)}calculateFrontDoorRoundTripLatency(e){let t=this.m_messageLatencyTable[e];if(t){let n=Date.now(),a=n-t,s={RoundtripLatency:a,HeartbeatSendTime:t,HeartbeatReceiveTime:n,TranscriberID:this.m_transcriberId,CorrelationID:e};c.sendTraceTag(594032288,i.i.PptSession,r.a.Info,JSON.stringify(s)),this.m_frontdoorRoundTripLatencyCount+=1,this.m_frontdoorTotalRoundTripLatency+=a,this.detectNetworkQuality(a)}else c.sendTraceTag(594346950,i.i.PptSession,r.a.Warning,`onPongMessageReceived: correlationID: ${e} was not present in the correlationID table, TranscriberID: ${this.m_transcriberId}`)}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),i=n(2),a=n(0);let s;class o{constructor(e,t){this.m_startLogIntervalTranscript=Number.MAX_VALUE,this.m_intervalTranscript=Number.MAX_VALUE,this.m_messageLatencyCalculationTime=0,this.m_totalTranscriptMessageCountInPreviousTimeInterval=0,this.m_totalTranscriptMessageCountInCurrentTimeInterval=0,this.m_lastReceivedTranscriptTimeUTC=Number.MAX_VALUE,this.m_lastTranscriptLogUTC=Number.MIN_VALUE,this.m_realTimeReceiveDataFactorCount=0,this.m_realTimeReceiveDataFactorSum=0,this.m_minRealTimeReceiveDataFactor=Number.MAX_VALUE,this.m_maxRealTimeReceiveDataFactor=Number.MIN_VALUE,this.m_realTimeReceiveDataFactorCountInTimeInterval=0,this.m_realTimeReceiveDataFactorSumInTimeInterval=0,this.m_minRealTimeReceiveDataFactorInTimeInterval=Number.MAX_VALUE,this.m_maxRealTimeReceiveDataFactorInTimeInterval=Number.MIN_VALUE,this.m_totalTranscriptFactorOutsideOfThresholdCount=0,this.m_transcriberId="",this.m_totalAudioMessageCountInPreviousTimeInterval=0,this.m_totalAudioMessageCountInCurrentTimeInterval=0,this.m_lastSentAudioTimeUTC=Number.MAX_VALUE,this.m_currentSentAudioTimeUTC=Number.MAX_VALUE,this.m_lastAudioLogUTC=Number.MIN_VALUE,this.m_realTimeSendDataFactorCount=0,this.m_realTimeSendDataFactorSum=0,this.m_minRealTimeSendDataFactor=Number.MAX_VALUE,this.m_maxRealTimeSendDataFactor=Number.MIN_VALUE,this.m_realTimeSendDataFactorCountInTimeInterval=0,this.m_realTimeSendDataFactorSumInTimeInterval=0,this.m_minRealTimeSendDataFactorInTimeInterval=Number.MAX_VALUE,this.m_maxRealTimeSendDataFactorInTimeInterval=Number.MIN_VALUE,this.m_intervalAudio=Number.MAX_VALUE,this.m_totalAudioFactorOutsideOfThresholdCount=0,this.m_startLogIntervalAudio=Number.MAX_VALUE,this.m_startTime=0,this.m_prepAudioCount=0,this.m_prepAudioSum=0,this.m_minPrepAudio=Number.MAX_VALUE,this.m_maxPrepAudio=Number.MIN_VALUE,this.m_audioFactorCalculationDuration=0,this.m_intervalTranscript=r.d.DataLoggingIntervalMS,this.m_intervalAudio=r.d.DataLoggingIntervalMS,this.m_lastAudioLogUTC=Date.now(),this.m_lastTranscriptLogUTC=Date.now(),s=e,this.telemetryManager=t}startSession(e){this.initialize(),this.m_transcriberId=e,this.m_startTime=Date.now()}calculatePreAudioMetrics(e){this.m_currentSentAudioTimeUTC=Date.now();let t=Date.now()-e;this.m_prepAudioCount+=1,this.m_prepAudioSum+=t,this.m_minPrepAudio=Math.min(this.m_minPrepAudio,t),this.m_maxPrepAudio=Math.max(this.m_maxPrepAudio,t)}calculateAndLogRealTimeSendFactorStats(e){try{let t=Date.now();if(this.m_totalAudioMessageCountInCurrentTimeInterval+=1,this.m_totalAudioMessageCountInPreviousTimeInterval>0&&this.m_lastSentAudioTimeUTC<Number.MAX_VALUE){let t=this.m_intervalAudio/this.m_totalAudioMessageCountInPreviousTimeInterval,n=Date.now()-this.m_lastSentAudioTimeUTC,r=t/(n>0?n:1);r>0&&this.calculateRealTimeSendFactorStats(e,r,n,t)}Date.now()-this.m_lastAudioLogUTC>r.d.DataLoggingIntervalMS&&this.logRealTimeSendStatsForEachInterval(),this.m_lastSentAudioTimeUTC=this.m_currentSentAudioTimeUTC;let n=Date.now()-t;this.m_audioFactorCalculationDuration+=n}catch(e){s.sendTraceTag(595716178,a.i.PptSession,i.a.Warning,`calculateAndLogRealTimeSendFactorStats: Calculating audio sending metrics threw an exception: ${e}\n             TranscriberID: ${this.m_transcriberId}`)}}initialize(){this.m_transcriberId="",this.m_startTime=0,this.m_startLogIntervalTranscript=Number.MAX_VALUE,this.m_intervalTranscript=Number.MAX_VALUE,this.m_messageLatencyCalculationTime=0,this.m_totalTranscriptMessageCountInPreviousTimeInterval=0,this.m_totalTranscriptMessageCountInCurrentTimeInterval=0,this.m_lastReceivedTranscriptTimeUTC=Number.MAX_VALUE,this.m_lastTranscriptLogUTC=Number.MIN_VALUE,this.m_realTimeReceiveDataFactorCount=0,this.m_realTimeReceiveDataFactorSum=0,this.m_minRealTimeReceiveDataFactor=Number.MAX_VALUE,this.m_maxRealTimeReceiveDataFactor=Number.MIN_VALUE,this.m_realTimeReceiveDataFactorCountInTimeInterval=0,this.m_realTimeReceiveDataFactorSumInTimeInterval=0,this.m_minRealTimeReceiveDataFactorInTimeInterval=Number.MAX_VALUE,this.m_maxRealTimeReceiveDataFactorInTimeInterval=Number.MIN_VALUE,this.m_totalTranscriptFactorOutsideOfThresholdCount=0,this.m_totalAudioMessageCountInPreviousTimeInterval=0,this.m_totalAudioMessageCountInCurrentTimeInterval=0,this.m_lastSentAudioTimeUTC=Number.MAX_VALUE,this.m_currentSentAudioTimeUTC=Number.MAX_VALUE,this.m_lastAudioLogUTC=Number.MIN_VALUE,this.m_realTimeSendDataFactorCount=0,this.m_realTimeSendDataFactorSum=0,this.m_minRealTimeSendDataFactor=Number.MAX_VALUE,this.m_maxRealTimeSendDataFactor=Number.MIN_VALUE,this.m_realTimeSendDataFactorCountInTimeInterval=0,this.m_realTimeSendDataFactorSumInTimeInterval=0,this.m_minRealTimeSendDataFactorInTimeInterval=Number.MAX_VALUE,this.m_maxRealTimeSendDataFactorInTimeInterval=Number.MIN_VALUE,this.m_intervalAudio=Number.MAX_VALUE,this.m_totalAudioFactorOutsideOfThresholdCount=0,this.m_startLogIntervalAudio=Number.MAX_VALUE,this.m_prepAudioCount=0,this.m_prepAudioSum=0,this.m_minPrepAudio=Number.MAX_VALUE,this.m_maxPrepAudio=Number.MIN_VALUE,this.m_audioFactorCalculationDuration=0}calculateRealTimeSendFactorStats(e,t,n,o){if(this.m_realTimeSendDataFactorCount+=1,this.m_realTimeSendDataFactorSum+=t,this.m_minRealTimeSendDataFactor=Math.min(this.m_minRealTimeSendDataFactor,t),this.m_maxRealTimeSendDataFactor=Math.max(this.m_maxRealTimeSendDataFactor,t),this.m_realTimeSendDataFactorCountInTimeInterval+=1,this.m_realTimeSendDataFactorSumInTimeInterval+=t,this.m_minRealTimeSendDataFactorInTimeInterval=Math.min(this.m_minRealTimeSendDataFactorInTimeInterval,t),this.m_maxRealTimeSendDataFactorInTimeInterval=Math.max(this.m_maxRealTimeSendDataFactorInTimeInterval,t),t<r.d.RealTimeFactorLowerThreshold||t>r.d.RealTimeFactorUpperThreshold){this.m_totalAudioFactorOutsideOfThresholdCount+=1;let r=0,c=0,l=0;this.m_realTimeSendDataFactorCount>0&&(r=1*this.m_realTimeSendDataFactorSum/this.m_realTimeSendDataFactorCount,c=this.m_minRealTimeSendDataFactor,l=this.m_maxRealTimeSendDataFactor),s.sendTraceTag(595716176,a.i.PptSession,i.a.Warning,JSON.stringify({MessageCorrelationID:e,SessionDurationInMS:Date.now()-this.m_startTime,RealTimeSendingDataFactor:t,AvgRealTimeSendingDataFactor:r,MinRealTimeSendingDataFactor:c,MaxRealTimeSendingDataFactor:l,AvgSendingDataDurationForInterval:o,RealTimeDurationForCurrentMessage:n,TotalAudioMessageCountInPreviousTimeInterval:this.m_totalAudioMessageCountInPreviousTimeInterval,AdjustedTimeInterval:this.m_intervalAudio,TranscriberID:this.m_transcriberId}))}}logRealTimeSendStatsForEachInterval(){let e=0,t=0,n=0;this.m_realTimeSendDataFactorCount>0&&(e=1*this.m_realTimeSendDataFactorSum/this.m_realTimeSendDataFactorCount,t=this.m_minRealTimeSendDataFactor,n=this.m_maxRealTimeSendDataFactor);let r=0;this.m_totalAudioMessageCountInPreviousTimeInterval>0&&(r=this.m_intervalAudio/this.m_totalAudioMessageCountInPreviousTimeInterval);let o=0,c=0,l=0;this.m_realTimeSendDataFactorCountInTimeInterval>0&&(o=1*this.m_realTimeSendDataFactorSumInTimeInterval/this.m_realTimeSendDataFactorCountInTimeInterval,c=this.m_minRealTimeSendDataFactorInTimeInterval,l=this.m_maxRealTimeSendDataFactorInTimeInterval);let u=0,h=0,m=0;this.m_prepAudioCount>0&&(u=this.m_prepAudioSum/this.m_prepAudioCount,h=this.m_minPrepAudio,m=this.m_maxPrepAudio),s.sendTraceTag(595716177,a.i.PptSession,i.a.Info,JSON.stringify({SessionDurationInMS:Date.now()-this.m_startTime,AvgRealTimeSendingDataFactor:e,MinRealTimeSendingDataFactor:t,MaxRealTimeSendingDataFactor:n,AvgRealTimeSendingDataFactorForInterval:o,MinRealTimeSendingDataFactorForInterval:c,MaxRealTimeSendingDataFactorForInterval:l,AvgPrepAudioForInterval:u,MinPrepAudioForInterval:h,MaxPrepAudioForInterval:m,AvgSendingDataDurationForInterval:r,TotalAudioMessageCountInPreviousTimeInterval:this.m_totalAudioMessageCountInPreviousTimeInterval,AdjustedTimeInterval:this.m_intervalAudio,TranscriberID:this.m_transcriberId})),this.m_totalAudioMessageCountInPreviousTimeInterval=this.m_totalAudioMessageCountInCurrentTimeInterval,this.m_totalAudioMessageCountInCurrentTimeInterval=0,this.m_realTimeSendDataFactorCountInTimeInterval=0,this.m_realTimeSendDataFactorSumInTimeInterval=0,this.m_minRealTimeSendDataFactorInTimeInterval=Number.MAX_VALUE,this.m_maxRealTimeSendDataFactorInTimeInterval=Number.MIN_VALUE,this.m_prepAudioCount=0,this.m_prepAudioSum=0,this.m_minPrepAudio=Number.MAX_VALUE,this.m_maxPrepAudio=Number.MIN_VALUE,this.m_lastAudioLogUTC=Date.now(),this.resetAudioIntervalStats()}resetAudioIntervalStats(){this.m_startLogIntervalAudio<Number.MAX_VALUE&&(this.m_intervalAudio=Date.now()-this.m_startLogIntervalAudio),this.m_startLogIntervalAudio=Date.now()}calculateAndLogRealTimeReceiveFactorStats(e,t,n,i,a){let s=Date.now()-e;this.m_messageLatencyCalculationTime+=s;let o=0,c=0,l=0;this.m_totalTranscriptMessageCountInCurrentTimeInterval+=1,this.m_totalTranscriptMessageCountInPreviousTimeInterval>0&&this.m_lastReceivedTranscriptTimeUTC<Number.MAX_VALUE&&(l=this.m_intervalTranscript/this.m_totalTranscriptMessageCountInPreviousTimeInterval,c=Date.now()-this.m_lastReceivedTranscriptTimeUTC,o=l/(c>0?c:1),o>0&&this.calculateRealTimeReceiveFactorStats(t,n,i,a,o,l,c)),r.d.IsLogEachTranscriptMessage||this.logRealTimeReceiveStatsForEachTranscript(t,n,i,a,l,o),Date.now()-this.m_lastTranscriptLogUTC>r.d.DataLoggingIntervalMS&&this.logRealTimeReceiveStatsForEachInterval(t,n,i,a),this.m_lastReceivedTranscriptTimeUTC=Date.now()}calculateRealTimeReceiveFactorStats(e,t,n,o,c,l,u){if(this.m_realTimeReceiveDataFactorCount+=1,this.m_realTimeReceiveDataFactorSum+=c,this.m_minRealTimeReceiveDataFactor=Math.min(this.m_minRealTimeReceiveDataFactor,c),this.m_maxRealTimeReceiveDataFactor=Math.max(this.m_maxRealTimeReceiveDataFactor,c),this.m_realTimeReceiveDataFactorCountInTimeInterval+=1,this.m_realTimeReceiveDataFactorSumInTimeInterval+=c,this.m_minRealTimeReceiveDataFactorInTimeInterval=Math.min(this.m_minRealTimeReceiveDataFactorInTimeInterval,c),this.m_maxRealTimeReceiveDataFactorInTimeInterval=Math.max(this.m_maxRealTimeReceiveDataFactorInTimeInterval,c),!r.d.IsLogEachTranscriptMessage&&(c<r.d.RealTimeFactorLowerThreshold||c>r.d.RealTimeFactorUpperThreshold)){this.m_totalTranscriptFactorOutsideOfThresholdCount+=1;let r=0,h=0,m=0;this.m_realTimeReceiveDataFactorCount>0&&(r=1*this.m_realTimeReceiveDataFactorSum/this.m_realTimeReceiveDataFactorCount,h=this.m_minRealTimeReceiveDataFactor,m=this.m_maxRealTimeReceiveDataFactor),s.sendTraceTag(595716104,a.i.PptSession,i.a.Warning,JSON.stringify({MessageCorrelationID:e,MessageLatency:t,IsFinalMessage:o,RealTimeReceivingDataFactor:c,AvgRealTimeReceivingDataFactor:r,MinRealTimeReceivingDataFactor:h,MaxRealTimeReceivingDataFactor:m,AvgReceivingDataDurationForInterval:l,RealTimeDurationForCurrentMessage:u,TotalTranscriptMessageCountInPreviousTimeInterval:this.m_totalTranscriptMessageCountInPreviousTimeInterval,AdjustedTimeInterval:this.m_intervalTranscript,HeartbeatRoundtripLatency:n,TranscriberID:this.m_transcriberId}))}}logRealTimeReceiveStatsForEachTranscript(e,t,n,r,o,c){let l=0,u=0,h=0,m=0,d=0,p=0,g=0;0===this.m_totalTranscriptMessageCountInPreviousTimeInterval&&this.m_lastReceivedTranscriptTimeUTC<Number.MAX_VALUE&&(l=Date.now()-this.m_lastReceivedTranscriptTimeUTC),this.m_realTimeReceiveDataFactorCount>0&&(u=1*this.m_realTimeReceiveDataFactorSum/this.m_realTimeReceiveDataFactorCount,h=this.m_minRealTimeReceiveDataFactor,m=this.m_maxRealTimeReceiveDataFactor),this.m_realTimeReceiveDataFactorCountInTimeInterval>0&&(d=1*this.m_realTimeReceiveDataFactorSumInTimeInterval/this.m_realTimeReceiveDataFactorCountInTimeInterval,p=this.m_minRealTimeReceiveDataFactorInTimeInterval,g=this.m_maxRealTimeReceiveDataFactorInTimeInterval),s.sendTraceTag(595716105,a.i.PptSession,i.a.Info,JSON.stringify({MessageCorrelationID:e,MessageLatency:t,IsFinalMessage:r,RealTimeReceivingDataFactor:c,AvgRealTimeReceivingDataFactor:u,MinRealTimeReceivingDataFactor:h,MaxRealTimeReceivingDataFactor:m,AvgRealTimeReceivingDataFactorForInterval:d,MinRealTimeReceivingDataFactorForInterval:p,MaxRealTimeReceivingDataFactorForInterval:g,AvgReceivingDataDurationForInterval:o,RealTimeDurationForCurrentMessage:l,TotalTranscriptMessageCountInPreviousTimeInterval:this.m_totalTranscriptMessageCountInPreviousTimeInterval,AdjustedTimeInterval:this.m_intervalTranscript,HeartbeatRoundtripLatency:n,TranscriberID:this.m_transcriberId}))}logRealTimeReceiveStatsForEachInterval(e,t,n,o){let c=0,l=0,u=0,h=0,m=0,d=0;if(!r.d.IsLogEachTranscriptMessage){this.m_realTimeReceiveDataFactorCount>0&&(c=1*this.m_realTimeReceiveDataFactorSum/this.m_realTimeReceiveDataFactorCount,l=this.m_minRealTimeReceiveDataFactor,u=this.m_maxRealTimeReceiveDataFactor);let r=0;this.m_totalAudioMessageCountInPreviousTimeInterval>0&&(r=this.m_intervalTranscript/this.m_totalAudioMessageCountInPreviousTimeInterval),this.m_realTimeReceiveDataFactorCountInTimeInterval>0&&(h=1*this.m_realTimeReceiveDataFactorSumInTimeInterval/this.m_realTimeReceiveDataFactorCountInTimeInterval,m=this.m_minRealTimeReceiveDataFactorInTimeInterval,d=this.m_maxRealTimeReceiveDataFactorInTimeInterval),s.sendTraceTag(595716106,a.i.PptSession,i.a.Info,JSON.stringify({MessageCorrelationID:e,MessageLatency:t,IsFinalMessage:o,AvgRealTimeReceivingDataFactor:c,MinRealTimeReceivingDataFactor:l,MaxRealTimeReceivingDataFactor:u,AvgRealTimeReceivingDataFactorForInterval:h,MinRealTimeReceivingDataFactorForInterval:m,MaxRealTimeReceivingDataFactorForInterval:d,AvgReceivingDataDurationForInterval:r,TotalTranscriptMessageCountInPreviousTimeInterval:this.m_totalTranscriptMessageCountInPreviousTimeInterval,AdjustedTimeInterval:this.m_intervalTranscript,HeartbeatRoundtripLatency:n,TranscriberID:this.m_transcriberId}))}this.m_totalTranscriptMessageCountInPreviousTimeInterval=this.m_totalTranscriptMessageCountInCurrentTimeInterval,this.m_totalTranscriptMessageCountInCurrentTimeInterval=0,this.m_realTimeReceiveDataFactorCountInTimeInterval=0,this.m_realTimeReceiveDataFactorSumInTimeInterval=0,this.m_minRealTimeReceiveDataFactorInTimeInterval=Number.MAX_VALUE,this.m_maxRealTimeReceiveDataFactorInTimeInterval=Number.MIN_VALUE,this.m_lastTranscriptLogUTC=Date.now(),this.resetTranscriptInterval()}resetTranscriptInterval(){this.m_startLogIntervalTranscript<Number.MAX_VALUE&&(this.m_intervalTranscript=Date.now()-this.m_startLogIntervalTranscript),this.m_startLogIntervalTranscript=Date.now()}onSessionEnd(){this.telemetryManager.recordAudioStatistics(this.m_audioFactorCalculationDuration,this.m_totalAudioFactorOutsideOfThresholdCount),this.telemetryManager.recordRealTimeReceiveFactorStats(this.m_totalTranscriptFactorOutsideOfThresholdCount,this.m_messageLatencyCalculationTime)}}},function(e,t,n){"use strict";var r=n(0),i=n(3);n.d(t,"a",(function(){return s}));class a{}a.defaultRequestedVideoHeight=322,a.defaultRequestedVideoWidth=572;class s extends class{constructor(){this.mediaStream=null,this.__isCapturing=!1}async startMediaCapture(e,t){return this.mediaStream=await navigator.mediaDevices.getUserMedia({audio:!1,video:{width:e,height:t,facingMode:"user"}}),this.initializeWebcamCapture()}stopMediaCapture(){this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>{e.stop()}),this.mediaStream=null),this.isCapturing=!1}pauseMediaCapture(){this.setMediaEnabled(!1)}resumeMediaCapture(){this.setMediaEnabled(!0)}setMediaEnabled(e){this.mediaStream&&this.mediaStream.getTracks().forEach(t=>{t.enabled=e}),this.isCapturing=e}initializeWebcamCapture(){if(!this.mediaStream)return r.f.ErrorWebcamSetupFailure;let e=this.mediaStream.getVideoTracks();return 0===e.length?r.f.ErrorWebcamNotFoundError:e.length>1?r.f.ErrorMultipleWebcamsFound:(this.isCapturing=!0,r.f.ErrorNone)}set isCapturing(e){e!==this.__isCapturing&&this.onCapturingContentChanged(e),this.__isCapturing=e}get stream(){return this.mediaStream}}{constructor(e,t){super(),this.lastVideoWidth=-1,this.lastVideoHeight=-1,this.requestedVideoHeight=a.defaultRequestedVideoHeight,this.requestedVideoWidth=a.defaultRequestedVideoWidth,this.onWebcamFrame=null,this.processFeedHandler=null,e.requestedVideoWidth&&(this.requestedVideoWidth=e.requestedVideoWidth),e.requestedVideoHeight&&(this.requestedVideoHeight=e.requestedVideoHeight),this.videoView=e.videoView,this.workingCanvas=e.workingCanvas,this.webcamFrameWidth=e.webcamFrameWidth?e.webcamFrameWidth:500,this.delayBetweenCapturesMS=1e3/e.numFramesPerSecond,this.onWebcamFrame=t,this.workingCanvas&&(this.workingCanvas.width=this.webcamFrameWidth)}async startMediaCapture(){let e=await super.startMediaCapture(this.requestedVideoWidth,this.requestedVideoHeight);return e!==r.f.ErrorNone?e:(this.videoView.srcObject=this.stream,await this.videoView.play(),r.f.ErrorNone)}stopMediaCapture(){this.videoView.pause(),this.videoView.srcObject=null,super.stopMediaCapture()}tryCaptureFrame(){if(!this.videoView||!this.workingCanvas)return null;const e=this.workingCanvas.getContext("2d");if(!e)return null;if((this.videoView.videoHeight!==this.lastVideoHeight||this.videoView.videoWidth!==this.lastVideoWidth)&&this.videoView.videoWidth){let e=this.webcamFrameWidth/this.videoView.videoWidth;this.workingCanvas.height=e*this.videoView.videoHeight,this.lastVideoHeight=this.videoView.videoHeight,this.lastVideoWidth=this.videoView.videoWidth}return e.drawImage(this.videoView,0,0,this.workingCanvas.width,this.workingCanvas.height),this.workingCanvas.toDataURL("image/jpeg")}tryProcessFeed(){if(!this.onWebcamFrame)return;const e=this.tryCaptureFrame();e&&this.onWebcamFrame(e,Object(i.v4)())}onCapturingContentChanged(e){this.onWebcamFrame&&(e?this.processFeedHandler=setInterval(()=>this.tryProcessFeed(),this.delayBetweenCapturesMS):this.processFeedHandler&&clearInterval(this.processFeedHandler))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"SpeechClientFactory",(function(){return i}));var r=n(6);class i{createSpeechClient(e,t,n,i,a,s){if(t)return new r.a(e,t,n,i,a,s)}}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},function(e,t,n){(function(e){!function(e){function t(e){if("utf-8"!==(e=void 0===e?"utf-8":e))throw new RangeError("Failed to construct 'TextEncoder': The encoding label provided ('"+e+"') is invalid.")}function n(e,t){if(t=void 0===t?{fatal:!1}:t,"utf-8"!==(e=void 0===e?"utf-8":e))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}if(e.TextEncoder&&e.TextDecoder)return!1;Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var n=e.length,r=0,i=Math.max(32,n+(n>>1)+7),a=new Uint8Array(i>>3<<3);t<n;){var s=e.charCodeAt(t++);if(55296<=s&&56319>=s){if(t<n){var o=e.charCodeAt(t);56320==(64512&o)&&(++t,s=((1023&s)<<10)+(1023&o)+65536)}if(55296<=s&&56319>=s)continue}if(r+4>a.length&&(i+=8,i=(i*=1+t/e.length*2)>>3<<3,(o=new Uint8Array(i)).set(a),a=o),0==(4294967168&s))a[r++]=s;else{if(0==(4294965248&s))a[r++]=s>>6&31|192;else if(0==(4294901760&s))a[r++]=s>>12&15|224,a[r++]=s>>6&63|128;else{if(0!=(4292870144&s))continue;a[r++]=s>>18&7|240,a[r++]=s>>12&63|128,a[r++]=s>>6&63|128}a[r++]=63&s|128}}return a.slice(0,r)},Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(n.prototype,"fatal",{value:!1}),Object.defineProperty(n.prototype,"ignoreBOM",{value:!1}),n.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");t=0;for(var n=(e=new Uint8Array(e)).length,r=[];t<n;){var i=e[t++];if(0===i)break;if(0==(128&i))r.push(i);else if(192==(224&i)){var a=63&e[t++];r.push((31&i)<<6|a)}else if(224==(240&i)){a=63&e[t++];var s=63&e[t++];r.push((31&i)<<12|a<<6|s)}else 240==(248&i)&&(65535<(i=(7&i)<<18|(a=63&e[t++])<<12|(s=63&e[t++])<<6|63&e[t++])&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i))}return String.fromCharCode.apply(null,r)},e.TextEncoder=t,e.TextDecoder=n}("undefined"!=typeof window?window:void 0!==e?e:this)}).call(this,n(20))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r,i,a=n(17),s=n(18),o=0,c=0;e.exports=function(e,t,n){var l=t&&n||0,u=t||[],h=(e=e||{}).node||r,m=void 0!==e.clockseq?e.clockseq:i;if(null==h||null==m){var d=a();null==h&&(h=r=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==m&&(m=i=16383&(d[6]<<8|d[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:c+1,T=p-o+(g-c)/1e4;if(T<0&&void 0===e.clockseq&&(m=m+1&16383),(T<0||p>o)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=p,c=g,i=m;var S=(1e4*(268435455&(p+=122192928e5))+g)%4294967296;u[l++]=S>>>24&255,u[l++]=S>>>16&255,u[l++]=S>>>8&255,u[l++]=255&S;var y=p/4294967296*1e4&268435455;u[l++]=y>>>8&255,u[l++]=255&y,u[l++]=y>>>24&15|16,u[l++]=y>>>16&255,u[l++]=m>>>8|128,u[l++]=255&m;for(var C=0;C<6;++C)u[l+C]=h[C];return t||s(u)}},function(e,t,n){var r=n(17),i=n(18);e.exports=function(e,t,n){var a=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var o=0;o<16;++o)t[a+o]=s[o];return t||i(s)}},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,l=[],u=!1,h=-1;function m(){u&&c&&(u=!1,c.length?l=c.concat(l):h=-1,l.length&&d())}function d(){if(!u){var e=o(m);u=!0;for(var t=l.length;t;){for(c=l,l=[];++h<t;)c&&c[h].run();h=-1,t=l.length}c=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||u||o(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}])}));
//# sourceMappingURL=PPTSpeechClient.js.map