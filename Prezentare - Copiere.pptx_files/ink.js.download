var ink;(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{inkCanvasFactoryGlobal:()=>Vi,inkDryStoreFactoryGlobal:()=>ns,inkStrokeRasterizerFactoryGlobal:()=>Ji});var i,s={logActivity:function(t,e,i,s){}};function n(t){s=t}function o(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")}function r(){return-1!==navigator.userAgent.indexOf("Firefox")}function a(){return/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}function h(){return!o()&&("mix-blend-mode","darken",void 0!==window.CSS&&window.CSS.supports("mix-blend-mode","darken"))}function u(t){t.style.pointerEvents="auto"}function c(t){t.style.pointerEvents="none"}function l(t){return new HapticsPredefinedWaveform(t)}!function(t){t[t.WAVEFORM_CLICK=4099]="WAVEFORM_CLICK",t[t.WAVEFORM_BUZZ_CONTINUOUS=4100]="WAVEFORM_BUZZ_CONTINUOUS",t[t.WAVEFORM_RUMBLE_CONTINUOUS=4101]="WAVEFORM_RUMBLE_CONTINUOUS",t[t.WAVEFORM_PRESS=4102]="WAVEFORM_PRESS",t[t.WAVEFORM_RELEASE=4103]="WAVEFORM_RELEASE",t[t.WAVEFORM_HOVER=4104]="WAVEFORM_HOVER",t[t.WAVEFORM_SUCCESS=4105]="WAVEFORM_SUCCESS",t[t.WAVEFORM_ERROR=4106]="WAVEFORM_ERROR",t[t.WAVEFORM_INK_CONTINUOUS=4107]="WAVEFORM_INK_CONTINUOUS",t[t.WAVEFORM_PENCIL_CONTINUOUTS=4108]="WAVEFORM_PENCIL_CONTINUOUTS",t[t.WAVEFORM_MARKER_CONTINUOUS=4109]="WAVEFORM_MARKER_CONTINUOUS",t[t.WAVEFORM_CHISEL_MARKER_CONTINUOUS=4110]="WAVEFORM_CHISEL_MARKER_CONTINUOUS",t[t.WAVEFORM_BRUSH_CONTINUOUS=4111]="WAVEFORM_BRUSH_CONTINUOUS",t[t.WAVEFORM_ERASER_CONTINUOUS=4112]="WAVEFORM_ERASER_CONTINUOUS",t[t.WAVEFORM_FIRST_CUSTOM_VENDOR_DEFINED=10752]="WAVEFORM_FIRST_CUSTOM_VENDOR_DEFINED",t[t.WAVEFORM_SECOND_CUSTOM_VENDOR_DEFINED=8479]="WAVEFORM_SECOND_CUSTOM_VENDOR_DEFINED",t[t.WAVEFORM_GALAXY_PEN_CONTINUOUS=4113]="WAVEFORM_GALAXY_PEN_CONTINUOUS"}(i||(i={}));class p{constructor(){this.isPointerDown=!1}play(t){if(void 0===this.haptics)return;const e=t();void 0!==e&&this.haptics.play(e)}stop(){var t;null===(t=this.haptics)||void 0===t||t.stop()}onPointerDown(t){var e;this.isPointerDown=!0,this.extractHapticsDevice(t),null===(e=this.output)||void 0===e||e.onPointerDown(t)}onPointerMove(t){var e;this.extractHapticsDevice(t),null===(e=this.output)||void 0===e||e.onPointerMove(t)}onPointerUp(t){var e;this.isPointerDown=!1,this.extractHapticsDevice(t),null===(e=this.output)||void 0===e||e.onPointerUp(t)}extractHapticsDevice(t){var e;this.haptics=null!==(e=t.haptics)&&void 0!==e?e:void 0}}const d={r:0,g:0,b:0,a:1},g={r:255,g:255,b:255,a:1};function m(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}class f{constructor(t){this.color=m(void 0!==t?t:d)}setRed(t){return this.color.r=t,this}setGreen(t){return this.color.g=t,this}setBlue(t){return this.color.b=t,this}setAlpha(t){return this.color.a=t,this}setHexRGB(t){return 7===t.length&&"#"===t[0]&&(this.color.r=parseInt(t.substr(1,2),16),this.color.g=parseInt(t.substr(3,2),16),this.color.b=parseInt(t.substr(5,2),16)),this}build(){return m(this.color)}}const v={type:0},y={width:4,height:4,color:d,effect:v,tip:"ellipse",rasterOperation:"copy"};function w(t){return{width:t.width,height:t.height,color:t.color,effect:t.effect,tip:t.tip,rasterOperation:t.rasterOperation}}class S{constructor(t){this.attributes=w(void 0!==t?t:y)}setWidth(t){return this.attributes.width=t,this}setHeight(t){return this.attributes.height=t,this}setColor(t){return this.attributes.color=t,this}setEffect(t){return this.attributes.effect=t,this}setTip(t){return this.attributes.tip=t,this}setRasterOperation(t){return this.attributes.rasterOperation=t,this}build(){return w(this.attributes)}}let P=!1;class x{constructor(t,e){this.penType="pen",this.cachedPenTimeInSec=0,this.lastCountedTimeInSec=0,this.penEnterTimeInSec=0,this.penLeaveTimeInSec=0,this.onUnload=()=>{clearInterval(this.logIntervalId),this.logPenUsage()},this.pointerEnter=t=>{t.pointerType===this.penType&&(this.penEnterTimeInSec||(this.penEnterTimeInSec=Math.floor(Date.now()/1e3),this.penEnterTimeInSec<=this.lastCountedTimeInSec&&(this.penEnterTimeInSec=this.lastCountedTimeInSec),this.penLeaveTimeInSec=0))},this.pointerLeave=()=>{const t=Math.ceil(Date.now()/1e3);if(this.penEnterTimeInSec&&t>this.lastCountedTimeInSec){this.penLeaveTimeInSec=t;const e=this.penLeaveTimeInSec-this.penEnterTimeInSec;this.cachedPenTimeInSec+=e}this.lastCountedTimeInSec=t,this.penEnterTimeInSec=0},this.visibilityChange=()=>{document.hidden&&this.pointerLeave()},this.logger=t,this.registerPenEvents();const i=void 0!==e?e:1;this.logIntervalId=window.setInterval(this.logPenUsage.bind(this),60*i*1e3)}registerPenEvents(){window.document.body.addEventListener("pointerenter",this.pointerEnter),window.document.body.addEventListener("pointerleave",this.pointerLeave),window.document.addEventListener("visibilitychange",this.visibilityChange),window.addEventListener("beforeunload",this.onUnload)}logPenUsage(){0!==this.cachedPenTimeInSec&&(this.logger.logActivity("PenMinutes",1e3*this.cachedPenTimeInSec,["PenInputSec"],[this.cachedPenTimeInSec]),this.cachedPenTimeInSec=0)}}var k;!function(t){t.Pen="pen",t.Pencil="pencil",t.Highlighter="highlighter",t.Erase="erase",t.ActionPen="actionPen",t.Laser="laser",t.Lasso="lasso",t.RemoteInk="remoteInk"}(k||(k={}));class b{constructor(t,e){this.penType="pen",this.mouseType="mouse",this.remoteInputType="unknown",this.logDataNames=["InputType","Activity","InkSec"],this.inkLogName="InkMinutes",this.cachedInkTimeInSec=0,this.cachedRemoteInkTimeInSec=0,this.cachedInkStartTime=0,this.lastInkInSec=0,this.isPointerDown=!1,this.isEventRegistered=!1,this.onPointerDown=t=>{void 0!==this.lastActivity&&(this.countDistinctSecond(t.pointerType),this.isPointerDown=!0)},this.onPointerMove=t=>{void 0!==this.lastActivity&&(void 0===this.lastInputType&&(this.lastInputType=t.pointerType),this.shouldCountPointerMove(t)&&this.countDistinctSecond(t.pointerType))},this.onPointerUp=t=>{void 0!==this.lastActivity&&(this.countDistinctSecond(t.pointerType),this.isPointerDown=!1,this.setLocalInkLogTimerHandle(window.setTimeout(this.logLocalInkMinute,1e3*this.logIntervalInSec)))},this.beforeUnload=()=>{this.logLocalInkMinute(),this.resetLocalInkCache(),this.logRemoteInkMinute()},this.logLocalInkMinute=()=>{if(0===this.cachedInkTimeInSec)return;if(void 0===this.lastActivity||void 0===this.lastInputType)return void(this.cachedInkTimeInSec=0);const t=[this.lastInputType,this.lastActivity,this.cachedInkTimeInSec];this.logger.logActivity(this.inkLogName,1e3*this.cachedInkTimeInSec,this.logDataNames,t),this.cachedInkTimeInSec=0},this.logRemoteInkMinute=()=>{if(0===this.cachedRemoteInkTimeInSec)return;const t=[this.remoteInputType,k.RemoteInk,this.cachedRemoteInkTimeInSec];this.logger.logActivity(this.inkLogName,1e3*this.cachedRemoteInkTimeInSec,this.logDataNames,t),this.cachedRemoteInkTimeInSec=0},this.logger=t,this.logIntervalInSec=60*(void 0===e?1:e)}activate(t){this.isEventRegistered&&this.unregisterEvents(),this.wetCanvas=t,this.registerEvents()}deactivate(){this.isEventRegistered&&this.unregisterEvents(),this.logLocalInkMinute(),this.logRemoteInkMinute()}start(t){this.lastActivity!==t&&(void 0!==this.lastActivity&&this.end(),this.lastActivity=t)}end(){this.logLocalInkMinute(),this.resetLocalInkCache()}onRemoteWetStart(){this.countRemoteWetTime(!1)}onRemoteWetAppend(){this.countRemoteWetTime(!1)}onRemoteWetEnd(){this.countRemoteWetTime(!0)}onRemoteLaserStart(t){this.isPointerDown||1!==t&&2!==t||this.countDistinctSecond(this.remoteInputType)}onRemoteLaserMove(t){this.isPointerDown||(1!==t&&2!==t||this.countDistinctSecond(this.remoteInputType),1===t&&this.cachedRemoteInkTimeInSec>this.logIntervalInSec&&this.logRemoteInkMinute())}onRemoteLaserEnd(){this.isPointerDown||(this.countDistinctSecond(this.remoteInputType),this.setRemoteInkLogTimerHandle(window.setTimeout(this.logRemoteInkMinute,1e3*this.logIntervalInSec)))}setLocalInkLogTimerHandle(t){void 0!==this.localInkLogTimerHandle&&window.clearTimeout(this.localInkLogTimerHandle),this.localInkLogTimerHandle=t}resetLocalInkCache(){this.lastActivity=void 0,this.lastInputType=void 0}registerEvents(){this.wetCanvas.addEventListener("pointerdown",this.onPointerDown,!0),this.wetCanvas.addEventListener("pointermove",this.onPointerMove,!0),this.wetCanvas.addEventListener("pointerup",this.onPointerUp,!0),this.wetCanvas.addEventListener("beforeunload",this.beforeUnload),this.isEventRegistered=!0}unregisterEvents(){this.wetCanvas.removeEventListener("pointerdown",this.onPointerDown,!0),this.wetCanvas.removeEventListener("pointermove",this.onPointerMove,!0),this.wetCanvas.removeEventListener("pointerup",this.onPointerUp,!0),this.wetCanvas.removeEventListener("beforeunload",this.beforeUnload),this.isEventRegistered=!1}shouldCountPointerMove(t){return this.lastActivity===k.Laser&&this.mouseType===t.pointerType&&this.mouseType===this.lastInputType||!!this.isPointerDown||this.penType===t.pointerType&&this.penType===this.lastInputType}countDistinctSecond(t){const e=Math.floor(Date.now()/1e3);if(e>this.lastInkInSec){if(t===this.remoteInputType)return this.cachedRemoteInkTimeInSec+=1,void(this.lastInkInSec=e);this.lastInputType!==t?(void 0!==this.lastInputType&&this.logLocalInkMinute(),this.lastInputType=t,this.cachedInkTimeInSec=1):this.cachedInkTimeInSec+=1,this.lastInkInSec=e,1===this.cachedInkTimeInSec&&(this.cachedInkStartTime=this.lastInkInSec),this.lastInkInSec-this.cachedInkStartTime>this.logIntervalInSec&&this.logLocalInkMinute()}}countRemoteWetTime(t){this.isPointerDown||(this.countDistinctSecond(this.remoteInputType),t&&this.setRemoteInkLogTimerHandle(window.setTimeout(this.logRemoteInkMinute,1e3*this.logIntervalInSec)))}setRemoteInkLogTimerHandle(t){void 0!==this.remoteInkLogTimerHandle&&window.clearTimeout(this.remoteInkLogTimerHandle),this.remoteInkLogTimerHandle=t}}function T(){return t="canvas",document.createElement(t);var t}function M(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function E(){return M("g")}function I(){return M("pattern")}function A(){return M("rect")}function C(){return M("svg")}function L(){return M("text")}var R={info:function(){}};function O(t){R=t}function D(t,e){t.output=e}function N(t,e,i){D(t,e),D(e,i)}function U(t,e,i,s){D(t,e),N(e,i,s)}const W=.5;function H(t){return{x:t.offsetX,y:t.offsetY,pressure:t.pressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timeStamp}}function z(t){return{x:t.offsetX,y:t.offsetY,pressure:W,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timeStamp}}class F{onPointerDown(t){this.output.beginStroke(z(t))}onPointerMove(t){this.output.addPoint(z(t))}onPointerUp(t){this.output.endStroke(z(t))}}class V{onPointerDown(t){this.output.beginStroke(H(t))}onPointerMove(t){this.output.addPoint(H(t))}onPointerUp(t){this.output.endStroke(H(t))}}function _(){return r()?new F:new V}class X{beginStroke(t){this.lastPoint=t,this.output.beginStroke(t)}addPoint(t){this.lastPoint=t,this.output.addPoint(t)}endStroke(t){this.lastPoint=t,this.output.endStroke(t)}}class B{beginStroke(t){this.output.beginStroke(t),this.point=t}addPoint(t){this.point.x===t.x&&this.point.y===t.y||(this.output.addPoint(t),this.point=t)}endStroke(t){this.output.endStroke(t)}}class Y{beginStroke(t){this.out1={x:t.x,y:t.y},this.out2=this.out1,this.output.beginStroke(t)}addPoint(t){this.output.addPoint(this.filter(t))}endStroke(t){this.output.endStroke(this.filter(t))}filter(t){const e={x:j(t.x,this.out1.x,this.out2.x),y:j(t.y,this.out1.y,this.out2.y)};return this.out2=this.out1,this.out1=e,{x:e.x,y:e.y,pressure:t.pressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timestamp}}}function j(t,e,i){return.16999999999999993*t+1.33*e+-.5*i}class ${constructor(){this.lastPressure=W}beginStroke(t){this.output.beginStroke(t),this.lastPressure=t.pressure}addPoint(t){this.output.addPoint(t),this.lastPressure=t.pressure}endStroke(t){this.output.endStroke(0===t.pressure?{x:t.x,y:t.y,pressure:this.lastPressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timestamp}:t)}}class K{constructor(t){this.deduper=new B,this.endStrokePressure=new $,this.jitter=new Y,t?(this.preJitterLastPointExtractor=new X,U(this.deduper,this.endStrokePressure,this.preJitterLastPointExtractor,this.jitter)):N(this.deduper,this.endStrokePressure,this.jitter)}beginStroke(t){D(this.jitter,this.output),this.deduper.beginStroke(t)}addPoint(t){this.deduper.addPoint(t)}endStroke(t){this.deduper.endStroke(t)}}function q(t,e,i,s){const n=(t+e)/2,o=(e+i)/2,r=(i+s)/2,a=(n+o)/2,h=(o+r)/2;return[t,n,a,(a+h)/2,h,r,s]}function J(t,e,i,s){return[(i-t)/6+e,(e-s)/6+i]}class G{constructor(){this.began=!1}beginStroke(t){this.output.beginStroke(t),this.cp=[t,t,t,t],this.began=!0}addPoint(t){const[e,i]=this.push(t);this.began?this.began=!1:this.output.addSegment(e,i,this.cp[2])}endStroke(t){this.addPoint(t);const[e,i]=this.push(t);this.output.endStroke(e,i,this.cp[2])}push(t){return this.cp.shift(),this.cp.push(t),function(t,e,i,s){const[n,o]=J(t.x,e.x,i.x,s.x),[r,a]=J(t.y,e.y,i.y,s.y),[h,u]=Z(e.pressure,i.pressure),[c,l]=Z(e.tiltX,i.tiltX),[p,d]=Z(e.tiltY,i.tiltY),[g,m]=Z(e.timestamp,i.timestamp);return[{x:n,y:r,pressure:h,tiltX:c,tiltY:p,timestamp:g},{x:o,y:a,pressure:u,tiltX:l,tiltY:d,timestamp:m}]}(this.cp[0],this.cp[1],this.cp[2],this.cp[3])}}function Z(t,e){const i=(e-t)/3;return[t+i,e-i]}class Q{constructor(){this.deduperJitterTransform=new K(!1),this.fitter=new G,D(this.deduperJitterTransform,this.fitter)}beginStroke(t){D(this.fitter,this.output),this.deduperJitterTransform.beginStroke(t)}addPoint(t){this.deduperJitterTransform.addPoint(t)}endStroke(t){this.deduperJitterTransform.endStroke(t)}}function tt(t,e){return{x:t.x+e.x,y:t.y+e.y}}function et(t,e){return t.x*e.x+t.y*e.y}function it(t,e){return{x:t.x-e.x,y:t.y-e.y}}function st(t,e){return{x:t.x*e,y:t.y*e}}function nt(t,e){const i=it(t,e);return et(i,i)}function ot(t,e,i){const s=Math.sin(i),n=Math.cos(i),o=t.x-e.x,r=t.y-e.y,a=o*s+r*n;return{x:o*n-r*s+e.x,y:a+e.y}}function rt(t,e,i){const s=nt(e,t);if(0===s)return nt(i,t);const n=(i.x-e.x)*(e.y-t.y)-(e.x-t.x)*(i.y-e.y);return n*n/s}class at{constructor(t){this.flatness=t*t}beginStroke(t){this.output.beginStroke(t),this.beginPoint=t}addSegment(t,e,i){ht(this.beginPoint,t,e,i,this.flatness,this.output),this.output.addPoint(i),this.beginPoint=i}endStroke(t,e,i){ht(this.beginPoint,t,e,i,this.flatness,this.output),this.output.endStroke(i)}}function ht(t,e,i,s,n,o){const[r,a,h,u,c,l,p]=function(t,e,i,s){const[n,o,r,a,h,u,c]=q(t.x,e.x,i.x,s.x),[l,p,d,g,m,f,v]=q(t.y,e.y,i.y,s.y),[y,w,S,P,x,k,b]=q(t.pressure,e.pressure,i.pressure,s.pressure),[T,M,E,I,A,C,L]=q(t.tiltX,e.tiltX,i.tiltX,s.tiltX),[R,O,D,N,U,W,H]=q(t.tiltY,e.tiltY,i.tiltY,s.tiltY),[z,F,V,_,X,B,Y]=q(t.timestamp,e.timestamp,i.timestamp,s.timestamp);return[{x:n,y:l,pressure:y,tiltX:T,tiltY:R,timestamp:z},{x:o,y:p,pressure:w,tiltX:M,tiltY:O,timestamp:F},{x:r,y:d,pressure:S,tiltX:E,tiltY:D,timestamp:V},{x:a,y:g,pressure:P,tiltX:I,tiltY:N,timestamp:_},{x:h,y:m,pressure:x,tiltX:A,tiltY:U,timestamp:X},{x:u,y:f,pressure:k,tiltX:C,tiltY:W,timestamp:B},{x:c,y:v,pressure:b,tiltX:L,tiltY:H,timestamp:Y}]}(t,e,i,s);rt(r,p,u)<=n||(ht(r,a,h,u,n,o),o.addPoint(u),ht(u,c,l,p,n,o))}class ut{constructor(t){this.bezierStrokePath=new Q,this.flattener=new at(t),D(this.bezierStrokePath,this.flattener)}beginStroke(t){D(this.flattener,this.output),this.bezierStrokePath.beginStroke(t)}addPoint(t){this.bezierStrokePath.addPoint(t)}endStroke(t){this.bezierStrokePath.endStroke(t)}}class ct{constructor(t){this.pointerToStroke=_(),this.strokeSmoothener=new ut(t),D(this.pointerToStroke,this.strokeSmoothener)}onPointerDown(t){D(this.strokeSmoothener,this.output),this.pointerToStroke.onPointerDown(t)}onPointerMove(t){this.pointerToStroke.onPointerMove(t)}onPointerUp(t){this.pointerToStroke.onPointerUp(t)}}function lt(t){return"pen"===t.pointerType}class pt{constructor(){this.transform=t=>t}beginStroke(t){this.output.beginStroke(this.transform(t))}addPoint(t){this.output.addPoint(this.transform(t))}endStroke(t){this.output.endStroke(this.transform(t))}}function dt(t,e=1e-6){return-e<=t&&t<=e}function gt(t,e=1e-6){return t<-e||e<t}function mt(t,e,i=1e-6){return dt(t-e,i)}function ft(t,e,i=1e-6){return gt(t-e,i)}function vt(t,e){const i={a:NaN,b:NaN,c:NaN},s=mt(t.x,e.x),n=mt(t.y,e.y);return s&&!n?(i.a=1,i.b=0):!s&&n?(i.a=0,i.b=1):s||n||(i.a=(e.y-t.y)/(t.x-e.x),i.b=1),i.c=-i.a*t.x-i.b*t.y,i}function yt(t,e){return vt(t,ot({x:t.x+1,y:t.y},t,e))}function wt(t){const e=dt(t.a),i=dt(t.b);return e&&!i?[{x:0,y:-t.c/t.b},{x:1,y:-t.c/t.b}]:!e&&i?[{x:-t.c/t.a,y:0},{x:-t.c/t.a,y:1}]:e||i?[]:[{x:0,y:-t.c/t.b},{x:1,y:-t.c/t.b-t.a/t.b}]}function St(t,e){const i=wt(t);return 2!==i.length?{a:NaN,b:NaN,c:NaN}:vt(tt(i[0],e),tt(i[1],e))}function Pt(t,e){var i;return null!==(i=xt(e,{a:-e.b,b:e.a,c:e.b*t.x-e.a*t.y}))&&void 0!==i?i:{x:NaN,y:NaN}}function xt(t,e){const i=dt(t.b)?e:t,s=dt(t.b)?t:e;if(dt(i.b))return;if(mt(i.a/i.b,s.a/s.b))return;const n=(s.b*i.c-s.c*i.b)/(s.a*i.b-s.b*i.a),o=(-i.c-i.a*n)/i.b;return isFinite(n)&&isFinite(o)?{x:n,y:o}:void 0}function kt(t){return 1.5*t+.25}class bt{constructor(t,e,i,s){this.snapTopEdgeUnitVector={x:0,y:-1},this.isActivated=!1,this.reset(t,e,i,s)}reset(t,e,i,s){this.centerLine=yt(t,e),this.snapTopEdgeUnitVector=ot({x:0,y:-1},{x:0,y:0},e),this.halfWidth=i,this.snapWidth=s}activate(){this.isActivated=!0}deactivate(){this.isActivated=!1}getCenterLine(){return this.centerLine}getSnapTopEdgeUnitVector(){return this.snapTopEdgeUnitVector}rotate(t,e){this.centerLine=function(t,e,i){const s=wt(t);return 2!==s.length?{a:NaN,b:NaN,c:NaN}:vt(ot(s[0],e,i),ot(s[1],e,i))}(this.centerLine,t,e),this.snapTopEdgeUnitVector=ot(this.snapTopEdgeUnitVector,{x:0,y:0},e)}translate(t){this.centerLine=St(this.centerLine,t)}isUnderRuler(t,e,i){if(!this.isActivated)return!1;const s=void 0!==i?this.getPointerAttributesOffset(i,e):0;return function(t,e){return Math.abs(e.a*t.x+e.b*t.y+e.c)/Math.sqrt(e.a*e.a+e.b*e.b)}(t,this.centerLine)-s<=this.halfWidth}getSnapEdge(t,e=!0){if(!this.isActivated)return{edge:0,centerProjection:{x:0,y:0},centerDistance:0,snapUnitVector:{x:0,y:0}};let i=0,s={x:0,y:0};const n=Pt(t,this.centerLine),o=it(t,n),r=Math.sqrt(o.x*o.x+o.y*o.y);return(!e||r<=this.halfWidth+this.snapWidth)&&(s=st(o,1/r),i=et(this.snapTopEdgeUnitVector,s)>=0?1:2),{edge:i,centerProjection:n,centerDistance:r,snapUnitVector:s}}snapToEdge(t,e,i,s){if(0===i)return t;const n=1===i?this.snapTopEdgeUnitVector:st(this.snapTopEdgeUnitVector,-1);return tt(Pt(t,this.centerLine),st(n,this.halfWidth+this.getPointerAttributesOffset(s,e)))}intersectEdge(t,e,i,s,n){if(!this.isActivated)return;const o=this.getSnapEdge(t,!1),r=st(o.snapUnitVector,this.halfWidth),a=xt(St(this.centerLine,r),vt(t,i));if(void 0===a)return;const h=it(t,a),u=Math.sqrt(h.x*h.x+h.y*h.y);if(0===u)return;const c=e+(s-e)*u/Math.sqrt(nt(t,i)),l=(o.centerDistance-this.halfWidth)/u;return tt(a,st(h,this.getPointerAttributesOffset(n,c)/(l*u)))}getPointerAttributesOffset(t,e){let i=0;if("ellipse"===t.tip)i=t.width;else if(0!==this.centerLine.a&&0===this.centerLine.b)i=t.width;else if(0===this.centerLine.a&&0!==this.centerLine.b)i=t.height;else{const e=Math.atan(Math.abs(this.centerLine.a/this.centerLine.b));i=(t.height+t.width*Math.tan(e))*Math.cos(e)}return i=kt(e)*i,i/2}}class Tt{constructor(t,e){this.scaleFactor={x:1,y:1},this.rulerStrokePathSink=e,this.inputToStroke=t,N(this.inputToStroke,this.scaleTransform(),e)}onPointerDown(t){D(this.rulerStrokePathSink,this.output),this.rulerStrokePathSink.setOverridePointPressureToDefaultWithSnap(lt(t)),this.inputToStroke.onPointerDown(t)}onPointerMove(t){this.inputToStroke.onPointerMove(t)}onPointerUp(t){this.inputToStroke.onPointerUp(t)}setScale(t){t.x<=0||t.y<=0||(this.scaleFactor=t)}scaleTransform(){const t=new pt;return t.transform=t=>({x:t.x*this.scaleFactor.x,y:t.y*this.scaleFactor.y,pressure:t.pressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timestamp}),t}}const Mt=new bt({x:0,y:0},0,0,0);class Et{constructor(t,e,i){this.snapRulerEdge=0,this.prevPoint=void 0,this.strokeStatus=0,this.overridePointPressureToDefaultWithSnap=!1,this.rulerModel=t,this.pointerAttributes=e,this.primaryRulerSink=i}getSnapRulerEdge(){return this.snapRulerEdge}setOverridePointPressureToDefaultWithSnap(t){this.overridePointPressureToDefaultWithSnap=t}beginStroke(t){(void 0===this.primaryRulerSink||0===this.primaryRulerSink.getSnapRulerEdge())&&this.rulerProxy().isUnderRuler({x:t.x,y:t.y},t.pressure)||(this.strokeStatus=1,void 0===this.primaryRulerSink?this.snapRulerEdge=this.rulerProxy().getSnapEdge({x:t.x,y:t.y}).edge:this.snapRulerEdge=this.primaryRulerSink.getSnapRulerEdge(),this.output.beginStroke(this.snapToEdge(t)),this.prevPoint=t)}addPoint(t){this.processIncomingPoint(t,!1)}endStroke(t){this.processIncomingPoint(t,!0)}processIncomingPoint(t,e){if(0===this.strokeStatus)return;let i=!1;if(0===this.snapRulerEdge){const e=this.rulerProxy().isUnderRuler({x:t.x,y:t.y},t.pressure,this.pointerAttributes());1===this.strokeStatus&&e?(this.output.endStroke(this.snapToIntersection(t,this.prevPoint,!0)),this.strokeStatus=void 0===this.primaryRulerSink?2:0,i=!0):2!==this.strokeStatus||e||(this.strokeStatus=1,this.output.beginStroke(this.snapToIntersection(t,this.prevPoint,!1)))}if(!i&&1===this.strokeStatus){const i=this.snapToEdge(t);e?this.output.endStroke(i):this.output.addPoint(i)}this.prevPoint=t}rulerProxy(){const t=this.rulerModel();return void 0!==t?t:Mt}snapToIntersection(t,e,i){if(void 0===e)return t;const s=i?{x:e.x,y:e.y}:{x:t.x,y:t.y},n=i?e.pressure:t.pressure,o=i?{x:t.x,y:t.y}:{x:e.x,y:e.y},r=i?t.pressure:e.pressure,a=this.rulerProxy().intersectEdge(s,n,o,r,this.pointerAttributes());return void 0===a?t:{x:a.x,y:a.y,pressure:t.pressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timestamp}}snapToEdge(t){if(0===this.snapRulerEdge)return t;const e=this.overridePointPressureToDefaultWithSnap?W:t.pressure,i=this.rulerProxy().snapToEdge({x:t.x,y:t.y},e,this.snapRulerEdge,this.pointerAttributes());return{x:i.x,y:i.y,pressure:e,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timestamp}}}class It{constructor(t){this.element=t}onPointerOver(t){lt(t)&&u(this.element)}onPointerOut(t){lt(t)&&c(this.element)}}class At{constructor(t){this.hapticsExtractor=new p,this.waveform=t}set output(t){D(this.hapticsExtractor,t)}onPointerDown(t){this.hapticsExtractor.onPointerDown(t),this.hapticsExtractor.play(this.waveform)}onPointerMove(t){this.hapticsExtractor.onPointerMove(t)}onPointerUp(t){this.hapticsExtractor.onPointerUp(t),this.hapticsExtractor.stop()}}class Ct{constructor(t){this.onPointerDown=t=>{this.output.onPointerDown(t)},this.onTouchStart=t=>{this.output.onTouchStart(t)},this.element=t}activate(){this.element.addEventListener("pointerdown",this.onPointerDown,!0),this.element.addEventListener("touchstart",this.onTouchStart,!0)}deactivate(){this.element.removeEventListener("pointerdown",this.onPointerDown,!0),this.element.removeEventListener("touchstart",this.onTouchStart,!0)}}class Lt{constructor(t){this.onPointerOver=t=>{this.output.onPointerOver(t)},this.onPointerOut=t=>{this.output.onPointerOut(t)},this.element=t}activate(){this.element.addEventListener("pointerover",this.onPointerOver),this.element.addEventListener("pointerout",this.onPointerOut)}deactivate(){this.element.removeEventListener("pointerover",this.onPointerOver),this.element.removeEventListener("pointerout",this.onPointerOut)}}function Rt(t){return 2===t.button||2==(2&t.buttons)}function Ot(t){return 5===t.button||32==(32&t.buttons)}class Dt{constructor(){this.active=!1}onMouseDown(t){this.output.onMouseDown(t),this.active=!0}onMouseMove(t){this.active&&this.output.onMouseMove(t)}onMouseUp(t){this.active=!1,this.output.onMouseUp(t)}}class Nt{constructor(t){this.onMouseDown=t=>{this.output.onMouseDown(t)},this.onMouseMove=t=>{this.output.onMouseMove(t)},this.onMouseUp=t=>{this.output.onMouseUp(t)},this.element=t}activate(){this.element.addEventListener("mousedown",this.onMouseDown),this.element.addEventListener("mousemove",this.onMouseMove),this.element.addEventListener("mouseup",this.onMouseUp)}deactivate(){this.element.removeEventListener("mousedown",this.onMouseDown),this.element.removeEventListener("mousemove",this.onMouseMove),this.element.removeEventListener("mouseup",this.onMouseUp)}}function Ut(t){t.preventDefault()}function Wt(t){t.preventDefault(),t.stopPropagation()}class Ht{onMouseDown(t){this.output.onMouseDown(t),Wt(t)}onMouseMove(t){this.output.onMouseMove(t),Wt(t)}onMouseUp(t){this.output.onMouseUp(t),Wt(t)}}class zt{constructor(t){N(this.head=new Nt(t),new Ht,this.tail=new Dt)}activate(){this.head.activate()}deactivate(){this.head.deactivate()}set output(t){this.tail.output=t}}function Ft(t){return{offsetX:t.offsetX,offsetY:t.offsetY,pressure:.5,tiltX:0,tiltY:0,timeStamp:t.timeStamp,pointerType:"mouse"}}class Vt{onMouseDown(t){this.output.onPointerDown(Ft(t))}onMouseMove(t){this.output.onPointerMove(Ft(t))}onMouseUp(t){this.output.onPointerUp(Ft(t))}}class _t{constructor(t,e,i){this.normalOutput=t,this.tailOutput=e,this.barrelOutput=i,this.output=t}onPointerDown(t){lt(t)?Ot(t)?this.output=this.tailOutput:Rt(t)?this.output=this.barrelOutput:this.output=this.normalOutput:this.output=this.normalOutput,this.output.onPointerDown(t)}onPointerMove(t){this.output.onPointerMove(t)}onPointerUp(t){this.output.onPointerUp(t)}}class Xt{constructor(){this.activePointerId=-1}onPointerDown(t){-1===this.activePointerId&&(this.activePointerId=t.pointerId,this.output.onPointerDown(t))}onPointerMove(t){this.activePointerId===t.pointerId&&this.output.onPointerMove(t)}onPointerUp(t){this.activePointerId===t.pointerId&&(this.output.onPointerUp(t),this.activePointerId=-1)}}class Bt{constructor(t){this.element=t}onPointerDown(t){try{this.element.setPointerCapture(t.pointerId)}finally{this.output.onPointerDown(t)}}onPointerMove(t){this.output.onPointerMove(t)}onPointerUp(t){this.output.onPointerUp(t)}}class Yt{onPointerDown(t){this.output.onPointerDown(t)}onPointerMove(t){(function(t){if("getCoalescedEvents"in t){const e=t.getCoalescedEvents();if(e.length>=1)return e}return[t]})(t).forEach((t=>{this.output.onPointerMove(t)}))}onPointerUp(t){this.output.onPointerUp(t)}}class jt{constructor(t){this.onPointerDown=t=>{this.output.onPointerDown(t)},this.onPointerMove=t=>{this.output.onPointerMove(t)},this.onPointerUp=t=>{this.output.onPointerUp(t)},this.element=t}activate(){this.element.addEventListener("pointerdown",this.onPointerDown),this.element.addEventListener("pointermove",this.onPointerMove),this.element.addEventListener("pointerup",this.onPointerUp)}deactivate(){this.element.removeEventListener("pointerdown",this.onPointerDown),this.element.removeEventListener("pointermove",this.onPointerMove),this.element.removeEventListener("pointerup",this.onPointerUp)}}class $t{constructor(t){this.element=t}activate(){this.element.addEventListener("touchmove",Ut)}deactivate(){this.element.removeEventListener("touchmove",Ut)}}class Kt{onPointerDown(t){this.output.onPointerDown(t),Wt(t)}onPointerMove(t){this.output.onPointerMove(t),Wt(t)}onPointerUp(t){this.output.onPointerUp(t),Wt(t)}}class qt{constructor(t){var e,i,s,n,o;e=this.head=new jt(t),i=new Bt(t),s=new Kt,n=new Xt,o=this.tail=new Yt,N(e,i,s),N(s,n,o),a()&&(this.preventDefaultOnTouchMove=new $t(t))}activate(){var t;this.head.activate(),null===(t=this.preventDefaultOnTouchMove)||void 0===t||t.activate()}deactivate(){var t;this.head.deactivate(),null===(t=this.preventDefaultOnTouchMove)||void 0===t||t.deactivate()}set output(t){this.tail.output=t}}class Jt{constructor(){this.wasPenDown=!1}onPointerDown(t){this.wasPenDown=lt(t)}onTouchStart(t){this.wasPenDown&&Wt(t)}}class Gt{constructor(){this.activeIdentifier=-1}onTouchStart(t,e){-1===this.activeIdentifier&&(this.activeIdentifier=e.identifier,this.output.onTouchStart(t,e))}onTouchMove(t,e){this.activeIdentifier===e.identifier&&this.output.onTouchMove(t,e)}onTouchEnd(t,e){this.activeIdentifier===e.identifier&&(this.output.onTouchEnd(t,e),this.activeIdentifier=-1)}}class Zt{onTouchStart(t){for(let e=0;e<t.changedTouches.length;e+=1)this.output.onTouchStart(t,t.changedTouches[e])}onTouchMove(t){for(let e=0;e<t.changedTouches.length;e+=1)this.output.onTouchMove(t,t.changedTouches[e])}onTouchEnd(t){for(let e=0;e<t.changedTouches.length;e+=1)this.output.onTouchEnd(t,t.changedTouches[e])}}class Qt{constructor(t){this.onTouchStart=t=>{this.output.onTouchStart(t)},this.onTouchMove=t=>{this.output.onTouchMove(t)},this.onTouchEnd=t=>{this.output.onTouchEnd(t)},this.element=t}activate(){this.element.addEventListener("touchstart",this.onTouchStart),this.element.addEventListener("touchmove",this.onTouchMove),this.element.addEventListener("touchend",this.onTouchEnd)}deactivate(){this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchmove",this.onTouchMove),this.element.removeEventListener("touchend",this.onTouchEnd)}}class te{onTouchStart(t){this.output.onTouchStart(t),Wt(t)}onTouchMove(t){this.output.onTouchMove(t),Wt(t)}onTouchEnd(t){this.output.onTouchEnd(t),Wt(t)}}class ee{constructor(t){U(this.head=new Qt(t),new te,new Zt,this.tail=new Gt)}activate(){this.head.activate()}deactivate(){this.head.deactivate()}set output(t){this.tail.output=t}}function ie(t){return 180*t/Math.PI}function se(t,e){const i=e.target.getBoundingClientRect();return{offsetX:e.clientX-i.left,offsetY:e.clientY-i.top,pressure:e.force,tiltX:ie(Math.atan(Math.cos(e.azimuthAngle)/Math.tan(e.altitudeAngle))),tiltY:ie(Math.atan(Math.sin(e.azimuthAngle)/Math.tan(e.altitudeAngle))),timeStamp:t.timeStamp,pointerType:"touch"}}class ne{onTouchStart(t,e){this.output.onPointerDown(se(t,e))}onTouchMove(t,e){this.output.onPointerMove(se(t,e))}onTouchEnd(t,e){this.output.onPointerUp(se(t,e))}}class oe{constructor(){this.offsetX=0,this.offsetY=0}setDrawingAttributes(t){this.output.setDrawingAttributes(1===t.effect.type?new S(t).setEffect({type:1,pattern:t.effect.pattern,offsetX:this.offsetX,offsetY:this.offsetY}).build():t)}beginStroke(t){this.output.beginStroke(t),this.begin=t}addPoint(t){this.output.addPoint(t)}endStroke(t){this.output.endStroke(t);const e=t.x-this.begin.x,i=t.y-this.begin.y,s=e>0?48:-48;this.offsetX+=e+s,this.offsetY+=i+s,this.offsetX%=540,this.offsetY%=540}}class re{constructor(t=y){this.offset=new oe,this.setDrawingAttributes(t)}setDrawingAttributes(t){this.attributes=t}getDrawingAttributes(){return this.attributes}beginStroke(t){D(this.offset,this.output),this.out=1===this.attributes.effect.type?this.offset:this.output,this.out.setDrawingAttributes(this.attributes),this.out.beginStroke(t)}addPoint(t){this.out.addPoint(t)}endStroke(t){this.out.endStroke(t)}}function ae(){return{left:Number.MAX_VALUE,right:-Number.MAX_VALUE,top:Number.MAX_VALUE,bottom:-Number.MAX_VALUE}}function he(t,e){t.left=Math.min(t.left,e.left),t.top=Math.min(t.top,e.top),t.right=Math.max(t.right,e.right),t.bottom=Math.max(t.bottom,e.bottom)}function ue(t,e,i){const[s,n]=function(t,e,i){const s=[-e.x,e.x,-e.y,e.y],n=[t.x-i.left,i.right-t.x,t.y-i.top,i.bottom-t.y];let o=0,r=1;for(let t=0;t<4;t+=1)if(0===s[t]){if(n[t]<0)return[10,-10]}else s[t]<0?o=Math.max(o,n[t]/s[t]):r=Math.min(r,n[t]/s[t]);return[o,r]}(t,it(e,t),i);return s<=n}function ce(t,e,i,s){const n=e.x-t.x,o=e.y-t.y,r=s.x-i.x,a=s.y-i.y,h=n*a-r*o;if(0===h)return!1;const u=(r*(t.y-i.y)-a*(t.x-i.x))/h,c=(n*(t.y-i.y)-o*(t.x-i.x))/h;return u>=0&&u<=1&&c>=0&&c<=1}function le(){}function pe(t){return t*Math.PI/180}class de{toCSSColor(t){return function(t){return`rgba(${t.r},${t.g},${t.b},${t.a})`}(t)}}var ge,me,fe;!function(t){t.Mouse="mouse",t.Pen="pen",t.Touch="touch",t.Keyboard="keyboard"}(ge||(ge={})),function(t){t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight",t.ArrowUp="ArrowUp",t.ArrowDown="ArrowDown"}(me||(me={})),function(t){t[t.logMove=0]="logMove",t[t.logRotate=1]="logRotate",t[t.performedManipulation=2]="performedManipulation"}(fe||(fe={}));class ve{constructor(t,e){this.isMoving=!1,this.isSnapped=!1,this.rotationTimer=-1,this.logRotate=!1,this.logMove=!1,this.primaryFingerPos={x:0,y:0},this.secondaryFingerPos={x:0,y:0},this.lastMovePos={x:0,y:0},this.primaryId=-1,this.thirdFingerId=-1,this.fingerToLastPosMap=new Map,this.mouseLastPos=void 0,this.penLastPosMap=new Map,this.lastMidpointPos={x:0,y:0},this.useBrowserSpecificTransform=!0,this.fixFirefoxMultitouch=!1,this.onPointerDown=t=>{const e=ye({x:t.clientX,y:t.clientY},this.eventsElement,this.ruler.getProperties().scale,this.useBrowserSpecificTransform);this.eventsElement.setPointerCapture(t.pointerId),this.onPointerDownImpl(t.isPrimary,t.pointerId,e,t.pointerType),this.preventDefaultAndStopPropagation(t)},this.onPointerMove=t=>{void 0!==this.setCursor&&this.setCursor();const e=ye({x:t.clientX,y:t.clientY},this.eventsElement,this.ruler.getProperties().scale,this.useBrowserSpecificTransform);this.onPointerMoveImpl(t.pointerId,e,t.isPrimary,t.pointerType),this.preventDefaultAndStopPropagation(t)},this.onPointerUp=t=>{if(this.removePointerFromMap(t.pointerType,t.pointerId),this.isRulerInUse()||this.ruler.setOpacity(this.ruler.getSettings().opacityUntouched),t.pointerId===this.primaryId&&this.fingerToLastPosMap.size>0){for(const t of Array.from(this.fingerToLastPosMap.keys()))if(1!==t){this.primaryId=t;break}this.primaryFingerPos=this.secondaryFingerPos}this.isMoving=this.isRulerInUse(),this.isMoving||(this.logRulerActivity(t.pointerType),this.logRotate=!1,this.logMove=!1),this.preventDefaultAndStopPropagation(t)},this.onWheel=t=>{0!==t.deltaY&&(function(t,e,i){const s=i.getProperties(),n=tt(s.compassOffset,s.position);i.rotate(t);const o=ot(n,e,pe(t));i.move(o.x-n.x,o.y-n.y)}(t.deltaY>0?1:-1,this.lastMovePos,this.ruler),Wt(t),clearTimeout(this.wheelLoggerTask),this.logRotate=!0,this.wheelLoggerTask=window.setTimeout((()=>{this.logRulerActivity(ge.Mouse),this.logRotate=!1}),1e3))},this.onKeyDown=t=>{const e=function(t,e){let i=!1,s=!1;switch(t.key){case me.ArrowLeft:return t.altKey&&t.shiftKey?(s=!0,e.rotate(-1)):t.altKey?(s=!0,e.rotate(-15)):(i=!0,e.move(-1,0)),[i,s,!0];case me.ArrowRight:return t.altKey&&t.shiftKey?(s=!0,e.rotate(1)):t.altKey?(s=!0,e.rotate(15)):(i=!0,e.move(1,0)),[i,s,!0];case me.ArrowUp:return e.move(0,-1),[!0,s,!0];case me.ArrowDown:return e.move(0,1),[!0,s,!0];default:return[i,s,!1]}}(t,this.ruler);this.logMove=!!e[fe.logMove]||this.logMove,this.logRotate=!!e[fe.logRotate]||this.logRotate,clearTimeout(this.keyboardEventLoggerTask),this.keyboardEventLoggerTask=window.setTimeout((()=>{this.logRulerActivity(ge.Keyboard),this.logMove=!1,this.logRotate=!1}),1e3),e[fe.performedManipulation]&&Wt(t)},this.ruler=t,this.eventsElement=this.ruler.getPointerEventsElement(),this.setCursor=e}activate(){this.eventsElement.addEventListener("pointerdown",this.onPointerDown),this.eventsElement.addEventListener("pointermove",this.onPointerMove),this.eventsElement.addEventListener("pointerup",this.onPointerUp),this.eventsElement.addEventListener("wheel",this.onWheel),this.eventsElement.addEventListener("keydown",this.onKeyDown),this.ruler.setVisibility(!0)}deactivate(){this.ruler.setVisibility(!1),this.eventsElement.removeEventListener("pointerdown",this.onPointerDown),this.eventsElement.removeEventListener("pointermove",this.onPointerMove),this.eventsElement.removeEventListener("pointerup",this.onPointerUp),this.eventsElement.removeEventListener("wheel",this.onWheel),this.eventsElement.removeEventListener("keydown",this.onKeyDown)}resetManipulationState(){this.fingerToLastPosMap.clear(),this.penLastPosMap.clear(),this.mouseLastPos=void 0,this.isMoving=!1,this.primaryId=-1,this.logRotate=!1,this.logMove=!1}setLogger(t){this.rulerLogger=t}setUseBrowserSpecificTransform(t){this.useBrowserSpecificTransform=t}setFixFirefoxMultitouch(t){this.fixFirefoxMultitouch=t}onPointerDownImpl(t,e,i,s){this.ruler.setOpacity(this.ruler.getSettings().opacityTouched),this.lastMovePos=i,this.updateLastPosition(s,e,i,t,!0),this.fingerToLastPosMap.size>1&&(this.rotationTimer=Date.now(),2===this.fingerToLastPosMap.size&&(this.lastMidpointPos=st(tt(this.primaryFingerPos,this.secondaryFingerPos),.5),this.ruler.setCompassPosition(this.lastMidpointPos))),this.isMoving=!0}onPointerMoveImpl(t,e,i,s){const n=this.getLastPosition(s,t);if(this.isMoving&&n)if(s!==ge.Touch&&0===this.fingerToLastPosMap.size||s===ge.Touch&&1===this.fingerToLastPosMap.size)this.ruler.move(e.x-n.x,e.y-n.y),this.logMove=!0;else if(this.fingerToLastPosMap.size>=2&&s===ge.Touch&&t!==this.thirdFingerId){const i=t===this.primaryId?this.secondaryFingerPos:this.primaryFingerPos,s=st(tt(e,i),.5);this.ruler.move(s.x-this.lastMidpointPos.x,s.y-this.lastMidpointPos.y),this.logMove=!0,this.lastMidpointPos=s;const n=function(t,e){const i=nt(t,{x:0,y:0});return nt(e,{x:0,y:0})>i?ie(Math.atan2(e.y-t.y,e.x-t.x)):ie(Math.atan2(t.y-e.y,t.x-e.x))}(e,i),o=Date.now()-this.rotationTimer;o>10&&this.multiTouchRotate(n,o)}this.lastMovePos=e,this.updateLastPosition(s,t,e,i)}logRulerActivity(t){void 0!==this.rulerLogger&&this.rulerLogger.logActivity(t,this.logMove,this.logRotate,this.ruler.getProperties().rotation,this.isSnapped)}updateLastPosition(t,e,i,s,n=!1){t!==ge.Mouse||!n&&void 0===this.mouseLastPos?t===ge.Pen?(s&&n&&(this.penLastPosMap.clear(),this.penLastPosMap.set(e,i)),(n||void 0!==this.penLastPosMap.get(e))&&this.penLastPosMap.set(e,i)):t===ge.Touch&&(void 0===this.fingerToLastPosMap.get(e)&&s&&(this.fingerToLastPosMap.clear(),this.primaryId=e),2===this.fingerToLastPosMap.size&&void 0===this.fingerToLastPosMap.get(e)&&(this.thirdFingerId=e),this.fingerToLastPosMap.set(e,i),this.primaryId===e?this.primaryFingerPos=this.lastMovePos:(e!==this.thirdFingerId||this.fingerToLastPosMap.size<3)&&(this.secondaryFingerPos=this.lastMovePos)):this.mouseLastPos=i}isRulerInUse(){return void 0!==this.mouseLastPos||this.penLastPosMap.size>0||this.fingerToLastPosMap.size>0}getLastPosition(t,e){return t===ge.Mouse?this.mouseLastPos:t===ge.Pen?this.penLastPosMap.get(e):t===ge.Touch?this.fingerToLastPosMap.get(e):void 0}removePointerFromMap(t,e){t===ge.Mouse?this.mouseLastPos=void 0:t===ge.Pen?this.penLastPosMap.delete(e):t===ge.Touch&&this.fingerToLastPosMap.delete(e)}multiTouchRotate(t,e){const i=this.ruler.getProperties().rotation,s=3===this.fingerToLastPosMap.size?5:45;let n=(t-i)%180;const o=n/e,r=Math.min(Math.abs(t%s),s-Math.abs(t%s));r<5&&(Math.abs(o)>.03||this.isSnapped||3===this.fingerToLastPosMap.size)?(this.isSnapped=!0,n=Math.round(t/s)*s-i):r>=5&&(this.isSnapped=!1),this.ruler.rotate(n),this.rotationTimer=Date.now(),this.logRotate=!0}preventDefaultAndStopPropagation(t){r()&&this.fixFirefoxMultitouch||Ut(t),function(t){t.stopPropagation()}(t)}}function ye(t,e,i,s){var n;const o=e.createSVGPoint();o.x=t.x,o.y=t.y;const h=o.matrixTransform(null===(n=e.getScreenCTM())||void 0===n?void 0:n.inverse());if(s){if(function(){const t=-1!==navigator.userAgent.indexOf("Chrome");return-1!==navigator.userAgent.indexOf("Safari")&&!t}()||a())return{x:h.x/i,y:h.y/i};if(r()){const t=new DOMMatrix(e.style.transform);return{x:h.x/i+t.e,y:h.y/i+t.f}}}return{x:h.x,y:h.y}}class we{constructor(){this.size={w:0,h:0},this.position={x:0,y:0},this.compassOffset={x:0,y:0},this.rotation=0,this.opacity=0,this.visible=!1,this.viewSize={w:0,h:0},this.scale=0}}const Se=60;class Pe{constructor(t,e,i,s){var n,o,r,a;this.internalSize={w:0,h:0},this.currentScale=0,this.rulerAnchor=C(),this.rotationElement=E(),this.rulerElement=C(),this.rulerBodyElement=A(),this.rulerTopTicksElement=A(),this.rulerBottomTicksElement=A(),this.angleIndicatorElement=C(),this.indicatorTicksElement=C(),this.defsElement=M("defs"),this.patternElement=I(),this.compassElement=C(),this.radialTicksElement=C(),this.angleTextElement=C(),this.angleText=L(),this.colorResolver=i,this.a11yLabelWithDegreesPlaceholder=s,this.initRuler(t,e),n=this.rulerBodyElement,o=this.rulerElement,r=e.settings.borderThickness,a={w:e.properties.size.w,h:e.settings.height},Te(n,{x:r,y:r}),Me(n,a),n.setAttribute("stroke-width",`${r}`),o.appendChild(n),xe(this.rulerTopTicksElement,this.rulerElement,e.settings.borderThickness,e.properties.size.w,!1),xe(this.rulerBottomTicksElement,this.rulerElement,e.settings.borderThickness,e.properties.size.w,!0),this.initCompass(e),this.initAngleIndicator(e),this.updateTickMarkPatternElement(e.properties.scale,e.theme.tickMarkColor,e.settings.tickMarkThickness),this.updateThemeColors(e.theme)}setVisibility(t){this.rulerAnchor.setAttribute("visibility",t?"visible":"hidden")}setOpacity(t){this.rulerAnchor.setAttribute("fill-opacity",`${t}`)}setPosition(t){ke(this.rulerAnchor,t)}setRotation(t){this.updateAngleText(t),this.rotationElement.setAttribute("transform",`rotate(${t} 0 0)`)}setCompassPosition(t){ke(this.compassElement,t)}setAngleIndicatorPosition(t){ke(this.angleIndicatorElement,t)}themeChanged(t){this.updateThemeColors(t)}setAriaLabel(t){this.a11yLabelWithDegreesPlaceholder=t,null!==this.angleText.textContent&&this.updateAriaLabel(this.angleText.textContent)}setAriaDescription(t){this.rulerElement.setAttribute("aria-description",t)}scaleChanged(t){this.currentScale<=1&&t.properties.scale<=1?this.currentScale=t.properties.scale:this.updateTickMarkPatternElement(t.properties.scale,t.theme.tickMarkColor,t.settings.tickMarkThickness)}viewSizeChanged(t){this.updateInternalSize(t),ke(this.rulerElement,{x:-this.internalSize.w/2,y:-this.internalSize.h/2}),be(this.rulerElement,this.internalSize),Me(this.rulerBodyElement,{w:t.properties.size.w,h:t.settings.height});const e=t.settings.borderThickness;Me(this.rulerTopTicksElement,{w:t.properties.size.w,h:20-e}),Me(this.rulerBottomTicksElement,{w:t.properties.size.w,h:20-e})}getInternalSize(){return this.internalSize}updateInternalSize(t){this.internalSize={w:t.properties.size.w+2*t.settings.borderThickness,h:t.properties.size.h+2*t.settings.borderThickness}}initRuler(t,e){var i,s,n;this.updateInternalSize(e),i=this.rulerAnchor,s=e.properties.position,n=e.settings.opacityUntouched,ke(i,s),be(i,{w:1,h:1}),i.setAttribute("transform-origin","center"),i.setAttribute("overflow","visible"),i.setAttribute("fill-opacity",`${n}`),t.appendChild(this.rulerAnchor),this.setRotation(e.properties.rotation),this.rulerAnchor.appendChild(this.rotationElement),function(t,e){ke(t,{x:-e.w/2,y:-e.h/2}),be(t,e),t.setAttribute("touch-action","auto"),t.setAttribute("pointer-events","auto"),t.setAttribute("tabindex","0")}(this.rulerElement,this.internalSize),this.defsElement.appendChild(this.patternElement),this.rulerElement.appendChild(this.defsElement),this.rotationElement.appendChild(this.rulerElement)}initCompass(t){var e;ke(e=this.compassElement,t.properties.compassOffset),be(e,{w:1,h:1}),e.setAttribute("overflow","visible"),this.rulerAnchor.appendChild(this.compassElement);const i=t.settings.compassDiameter,s=i/2;!function(t,e,i,s){ke(t,{x:-i,y:-i}),be(t,{w:e,h:e}),t.setAttribute("stroke-width",`${s}`)}(this.radialTicksElement,i,s,t.settings.borderThickness),function(t,e){const i=e,s=e;for(let n=0;n<360;n+=10){const o=pe(n),r=e-(n%90==0?12:8),a={x:i+r*Math.cos(o),y:s+r*Math.sin(o)},h={x:i+e*Math.cos(o),y:s+e*Math.sin(o)};t.appendChild(Ie(a,h))}}(this.radialTicksElement,s),this.compassElement.appendChild(this.radialTicksElement),this.initAngleText(t.properties.rotation)}initAngleText(t){var e;(e=this.angleTextElement).setAttribute("font-family","Segoe UI Light, Helvetica Neue, sans serif"),e.setAttribute("font-size","18"),e.setAttribute("dominant-baseline","middle"),e.setAttribute("text-anchor","middle"),this.radialTicksElement.appendChild(this.angleTextElement),Ee(this.angleText,"50%","50%"),this.updateAngleText(t),this.angleTextElement.appendChild(this.angleText);const i=L();Ee(i,"68%","44%"),i.textContent="°",this.angleTextElement.appendChild(i)}updateAngleText(t){this.angleText.textContent=`${function(t){let e=Math.abs(Math.round(t)+180)%180;return e>90&&(e=180-e),e}(t)}`,this.updateAriaLabel(this.angleText.textContent)}updateAriaLabel(t){this.rulerElement.setAttribute("aria-label",this.a11yLabelWithDegreesPlaceholder.replace("{{param0}}",t))}initAngleIndicator(t){const e=t.settings.compassDiameter,i=e/2;var s;ke(s=this.angleIndicatorElement,{x:this.internalSize.w/2+t.properties.compassOffset.x,y:this.internalSize.h/2+t.properties.compassOffset.y}),be(s,{w:1,h:1}),s.setAttribute("overflow","visible"),this.rulerElement.appendChild(this.angleIndicatorElement),function(t,e,i,s){ke(t,{x:-i,y:-i}),be(t,{w:e,h:e}),t.setAttribute("stroke-width",`${s}`)}(this.indicatorTicksElement,e,i,t.settings.angleIndicatorThickness),function(t,e,i){t.appendChild(Ie({x:0,y:i},{x:12,y:i})),t.appendChild(Ie({x:e-12,y:i},{x:e,y:i}))}(this.indicatorTicksElement,e,i),this.angleIndicatorElement.appendChild(this.indicatorTicksElement)}updateTickMarkPatternElement(t,e,i){const s=Math.max(1,t),n=this.patternElement;var o,r;this.patternElement=I(),o=this.patternElement,r={w:Se*s,h:20},o.setAttribute("id","tick-marks"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("width",`${r.w}`),o.setAttribute("height",`${r.h}`),o.setAttribute("patternUnits","userSpaceOnUse"),this.ticksGroupElement=E(),function(t,e,i){t.setAttribute("stroke",e),t.setAttribute("stroke-width",`${i}`),t.setAttribute("stroke-linecap","butt")}(this.ticksGroupElement,this.colorResolver.toCSSColor(e),i),function(t,e){const i=6*t,s={x:1,y:1};for(let t=0;t<10;t++)0===t?e.appendChild(Ie(s,{x:s.x,y:20})):5===t?e.appendChild(Ie(s,{x:s.x,y:16})):e.appendChild(Ie(s,{x:s.x,y:12})),s.x+=i}(s,this.ticksGroupElement),this.patternElement.appendChild(this.ticksGroupElement),this.defsElement.removeChild(n),this.defsElement.appendChild(this.patternElement),this.currentScale=t}updateThemeColors(t){this.rulerBodyElement.setAttribute("fill",this.colorResolver.toCSSColor(t.backgroundColor)),this.rulerBodyElement.setAttribute("stroke",this.colorResolver.toCSSColor(t.borderColor)),this.radialTicksElement.setAttribute("stroke",this.colorResolver.toCSSColor(t.borderColor)),this.angleTextElement.setAttribute("stroke",this.colorResolver.toCSSColor(t.angleTextColor)),this.ticksGroupElement.setAttribute("stroke",this.colorResolver.toCSSColor(t.tickMarkColor)),this.indicatorTicksElement.setAttribute("stroke",this.colorResolver.toCSSColor(t.angleIndicatorColor))}}function xe(t,e,i,s,n){Te(t,{x:i,y:i}),Me(t,{w:s,h:20-i}),t.setAttribute("fill","url(#tick-marks)"),n&&(t.setAttribute("transform","scale(1,-1)"),t.setAttribute("transform-origin","center")),e.appendChild(t)}function ke(t,e){t.setAttribute("x",`${Ae(e.x)}`),t.setAttribute("y",`${Ae(e.y)}`)}function be(t,e){t.setAttribute("width",`${e.w}`),t.setAttribute("height",`${e.h}`)}function Te(t,e){t.setAttribute("x",`${Ae(e.x)}`),t.setAttribute("y",`${Ae(e.y)}`)}function Me(t,e){t.setAttribute("width",`${e.w}`),t.setAttribute("height",`${e.h}`)}function Ee(t,e,i){t.setAttribute("x",e),t.setAttribute("y",i),t.setAttribute("style","-webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none"),t.setAttribute("alignment-baseline","middle")}function Ie(t,e){const i=M("line");return i.setAttribute("x1",`${Ae(t.x)}`),i.setAttribute("y1",`${Ae(t.y)}`),i.setAttribute("x2",`${Ae(e.x)}`),i.setAttribute("y2",`${Ae(e.y)}`),i}function Ae(t){return`${parseFloat(t.toFixed(1))}`}class Ce{constructor(t,e,i,s){this.properties=new we,this.theme=i,this.settings=s,this.properties.viewSize={w:t.w*e,h:t.h*e},this.properties.size={w:this.calculateRulerWidth(this.properties.viewSize),h:this.settings.height},this.properties.scale=e;const n=Math.min(this.properties.viewSize.w,this.properties.viewSize.h)/2;this.properties.position={x:n,y:n},this.properties.rotation=this.settings.initialAngle}calculateRulerWidth(t){return Math.round(3*Math.sqrt(t.w*t.w+t.h*t.h))}}function Le(t,e){return 0===e||t%e==0?t:(Math.floor(t/e)+1)*e}function Re(t,e,i){return t.x>-i&&t.x<e.w+i&&t.y>-i&&t.y<e.h+i}function Oe(t,e){const i=function(t,e){let i=!0;return function(t,e,i,s){if(0===i||i%180==0)return e>=0&&e<=s.h;if(i%90==0)return t>=0&&t<=s.w;const n=Math.tan(pe(i)),o=e-t*n;if(o>=0&&o<=s.h)return!0;const r=t-e/n;if(r>=0&&r<=s.w)return!0;const a=(s.w-t)*n+e;if(a>=0&&a<=s.h)return!0;const h=(s.h-e)/n+t;return h>=0&&h<=s.w}(e.position.x+t.position.x,e.position.y+t.position.y,e.rotation+t.rotation,e.viewSize)||(t.position.x=0,t.position.y=0,t.rotation=0,i=!1),i}(t,e);return i&&function(t,e){const i=tt(e.position,t.position),s=e.rotation+t.rotation,n=e.size.w/2,o=n/3,r=pe(s),a=Math.cos(r),h=Math.sin(r),u={x:i.x+n*a,y:i.y+n*h},c={x:i.x-n*a,y:i.y-n*h};let l=0;if(Re(u,e.viewSize,o)?l=De(i,u,s,e.viewSize,o):Re(c,e.viewSize,o)&&(l=-De(i,c,s,e.viewSize,o)),0!==l){const s={x:l*a,y:l*h},n=tt(i,s);t.position=it(n,e.position),Re(tt(e.compassOffset,e.position),e.viewSize,o)&&(t.compassOffset=it(t.compassOffset,s))}}(t,e),i}function De(t,e,i,s,n){if(0===i||i%180==0)return Math.abs(e.x+2*n)<Math.abs(e.x-(2*n+s.w))?Le(Math.abs(e.x+2*n),Se):Le(Math.abs(e.x-(2*n+s.w)),Se);if(i%90==0)return Math.abs(e.y+2*n)<Math.abs(e.y-(2*n+s.h))?Le(Math.abs(e.y+2*n),Se):Le(Math.abs(e.y-(2*n+s.h)),Se);{const o=pe(i),r=Math.tan(o);let a,h,u,c;return h=Math.abs(e.x-(2*n+s.w)),a=h,u=2*n+s.w,c=(u-t.x)*r+t.y,h=Math.abs(e.x+2*n),h<a&&(a=h,u=-2*n,c=(u-t.x)*r+t.y),h=Math.abs(e.y-(2*n+s.h)),h<a&&(a=h,c=2*n+s.h,u=(c-t.y)/r+t.x),h=Math.abs(e.y+2*n),h<a&&(a=h,c=-2*n,u=(c-t.y)/r+t.x),Le(Math.sqrt(Math.pow(u-e.x,2)+Math.pow(c-e.y,2)),Se)}}var Ne,Ue;!function(t){t.Move="move",t.Rotate="rotate",t.MoveAndRotate="moveAndRotate"}(Ne||(Ne={})),function(t){t.Snapped="snapped",t.NotSnapped="notSnapped"}(Ue||(Ue={}));class We{constructor(t){this.dataNames=["InputType","Activity","Angle","SnappedState"],this.inkLogName="RulerUsage",this.logger=t}logActivity(t,e,i,s,n){const o=this.getActivityType(e,i);if(void 0!==o){const e=[t,o,s,n?Ue.Snapped:Ue.NotSnapped];this.logger.logActivity(this.inkLogName,0,this.dataNames,e)}}getActivityType(t,e){return t&&e?Ne.MoveAndRotate:t?Ne.Move:e?Ne.Rotate:void 0}}class He{constructor(t,e,i,s,n=new de,o="Ruler: {{param0}} degrees",r,a=!0){this.parentElement=t,this.state=new Ce({w:t.clientWidth,h:t.clientHeight},e,i,s),this.considerScaleWithSnapWidth=a;const h=this.computeScaleToConsiderWithSnapWidth();this.rulerModel=new bt(st(this.state.properties.position,1/h),pe(this.state.properties.rotation),this.state.settings.height/(2*h),this.state.settings.snapWidth/h),this.renderer=new Pe(t,this.state,n,o),this.manipulation=new ve(this,r)}activate(){this.manipulation.activate(),this.rulerModel.activate()}deactivate(){this.manipulation.deactivate(),this.rulerModel.deactivate()}fixFirefoxMultitouch(t){this.manipulation.setFixFirefoxMultitouch(t)}resetManipulationState(){this.manipulation.resetManipulationState()}setLogger(t){this.manipulation.setLogger(new We(t))}setUseBrowserSpecificTransform(t){this.manipulation.setUseBrowserSpecificTransform(t)}getPointerEventsElement(){return this.parentElement}getTheme(){return this.state.theme}getSettings(){return this.state.settings}getProperties(){return this.state.properties}getRulerModel(){return this.rulerModel}setTheme(t){this.state.theme=t,this.renderer.themeChanged(this.state.theme)}setScale(t){ft(this.state.properties.scale,t)&&(this.state.properties.scale=t,this.renderer.scaleChanged(this.state),this.resetModel())}setViewSize(t,e){const i=t*this.state.properties.scale,s=e*this.state.properties.scale;if(ft(this.state.properties.viewSize.w,i)||ft(this.state.properties.viewSize.h,s)){const t={w:i,h:s};this.state.properties.viewSize=t,this.state.properties.size.w=this.state.calculateRulerWidth(t),this.renderer.viewSizeChanged(this.state)}}setVisibility(t){this.state.properties.visible!==t&&(this.state.properties.visible=t,this.renderer.setVisibility(t))}setOpacity(t){ft(this.state.properties.opacity,t)&&(this.state.properties.opacity=t,this.renderer.setOpacity(t))}move(t,e){const i=new we;i.position.x=t,i.position.y=e,Oe(i,this.state.properties),this.updateState(i)}rotate(t){const e=new we;if(e.rotation=t,gt(this.state.properties.compassOffset.x)||gt(this.state.properties.compassOffset.y)){const t=tt(this.state.properties.compassOffset,this.state.properties.position);!function(t,e,i){const s=pe(t.rotation),n=it(e.position,i),o=Math.cos(s),r=Math.sin(s),a=n.x*o-n.y*r,h=n.x*r+n.y*o;t.position.x+=a-n.x,t.position.y+=h-n.y}(e,this.state.properties,t),function(t,e,i){const s=tt(e.position,t.position),n=Pt(i,yt(s,pe(e.rotation+t.rotation%180)));t.compassOffset={x:n.x-e.compassOffset.x-s.x,y:n.y-e.compassOffset.y-s.y}}(e,this.state.properties,t)}Oe(e,this.state.properties),this.updateState(e)}setCompassPosition(t){const e=it(Pt(t,yt(this.state.properties.position,pe(this.state.properties.rotation))),this.state.properties.position),i=new we;i.compassOffset=it(e,this.state.properties.compassOffset),this.updateState(i)}setAriaLabel(t){this.renderer.setAriaLabel(t)}setAriaDescription(t){this.renderer.setAriaDescription(t)}computeScaleToConsiderWithSnapWidth(){return this.considerScaleWithSnapWidth?this.state.properties.scale:1}updateState(t){const e=t.position.x,i=t.position.y;(gt(e)||gt(i))&&(this.state.properties.position.x+=e,this.state.properties.position.y+=i,this.renderer.setPosition(this.state.properties.position));const s=t.compassOffset.x,n=t.compassOffset.y;(gt(s)||gt(n))&&(this.state.properties.compassOffset.x+=s,this.state.properties.compassOffset.y+=n,function(t,e){e.setCompassPosition(t.compassOffset);const i=ot(t.compassOffset,{x:0,y:0},pe(-t.rotation)),s={x:e.getInternalSize().w/2+i.x,y:e.getInternalSize().h/2};e.setAngleIndicatorPosition(s)}(this.state.properties,this.renderer));const o=t.rotation;gt(o)&&(this.state.properties.rotation=(this.state.properties.rotation+o)%360,this.renderer.setRotation(this.state.properties.rotation)),this.resetModel()}resetModel(){const t=this.computeScaleToConsiderWithSnapWidth();this.rulerModel.reset(st(this.state.properties.position,1/t),pe(this.state.properties.rotation),this.state.settings.height/(2*t),this.state.settings.snapWidth/t)}}const ze={opacityUntouched:.9,opacityTouched:.75,height:120,borderThickness:1,tickMarkThickness:1,compassDiameter:64,angleIndicatorThickness:3,initialAngle:45,snapWidth:30},Fe={angleTextColor:{r:0,g:0,b:0,a:1},backgroundColor:{r:230,g:230,b:230,a:1},borderColor:{r:0,g:0,b:0,a:1},tickMarkColor:{r:0,g:0,b:0,a:1},angleIndicatorColor:{r:255,g:0,b:0,a:1}};var Ve="stencilContainer";function _e(t,e,i){void 0===i&&(i=Ve);var s=Xe(i);s&&(s.setAttribute("width",""+t),s.setAttribute("height",""+e))}function Xe(t){void 0===t&&(t=Ve);try{return function(t){const e=document.getElementById(t);if(null===e)throw new Error(`Could not find element with id: ${t}`);return e}(t)}catch(t){return null}}var Be=function(){function t(){this.active=!1}return t.prototype.setup=function(t,e,i){t&&(this.rulerManager=new He(t,1,e,i,void 0,"",void 0,!1),this.rulerManager.setLogger(s),this.rulerManager.setUseBrowserSpecificTransform(!1))},t.prototype.isActive=function(){return this.active},t.prototype.activate=function(e){var i;t.INSTANCE.setScale(e),this.isActive()||(void 0===this.rulerManager&&this.setup(Xe(),Fe,ze),null===(i=this.rulerManager)||void 0===i||i.activate(),this.active=!0)},t.prototype.deactivate=function(){var t;null===(t=this.rulerManager)||void 0===t||t.deactivate(),this.active=!1},t.prototype.getRulerModel=function(){var t;return null===(t=this.rulerManager)||void 0===t?void 0:t.getRulerModel()},t.prototype.setScale=function(t){var e;t>0&&(null===(e=this.rulerManager)||void 0===e||e.setScale(t))},t.prototype.isUnderRuler=function(t,e,i){return!!this.isActive()&&!!this.rulerManager&&this.rulerManager.getRulerModel().isUnderRuler(t,e,i)},t.INSTANCE=new t,t}(),Ye=function(){function t(t,e){this.hapticsExtractor=new p,this.playHapticsInterval=0,this.needPlayStrokeHitHaptics=!1,this.needRestartContinuousHaptics=!1,this.inkDryStore=t,this.hitTestDataMap=new Map,this.shapeNodesErased=new Set,this.viewModelModifier=e}return t.prototype.onPointerDown=function(t){this.hapticsExtractor.onPointerDown(t),this.previousPoint={x:t.offsetX,y:t.offsetY},this.generateHitTestData()},t.prototype.onPointerMove=function(t){var e=this,i={x:t.offsetX,y:t.offsetY};if(Be.INSTANCE.isUnderRuler(i,.5,y))this.previousPoint=i;else{this.hapticsExtractor.onPointerMove(t);var s=new Set;this.hitTestDataMap.forEach((function(t,n){var o,r=!1,a=16-((o=t.bounds).right-o.left),h=16-function(t){return t.bottom-t.top}(t.bounds);a>=0&&h>=0&&function(t,e,i,s,n){return ue(t,e,function(t,e,i){return{left:t.left-e,right:t.right+e,top:t.top-i,bottom:t.bottom+i}}(i,s,n))}(e.previousPoint,i,t.bounds,a/2,h/2)?r=!0:ue(e.previousPoint,i,t.bounds)&&t.strokeCollection.stream({add:function(t){!r&&function(t,e,i){let s,n=!1;const o={add:le},r=t=>{ce(s,t,e,i)&&(o.add=le,n=!0),s=t};return o.add=t=>{o.add=r,s=t},t.streamPoints(o),n}(t,e.previousPoint,i)&&(r=!0)}}),r&&s.add(n)})),s.forEach((function(t){e.shapeNodesErased.add(t),e.hitTestDataMap.delete(t)})),this.hideInkCollections(s),0!==s.size&&this.ensurePlayStrokeHitHaptics(),this.previousPoint=i}},t.prototype.onPointerUp=function(t){this.hapticsExtractor.onPointerUp(t),this.clearHaptics(),this.hitTestDataMap.clear(),this.deleteInkCollections(this.shapeNodesErased),this.shapeNodesErased.size>0&&R.info("Strokes erased count: "+this.shapeNodesErased.size+". Pointer type: "+t.pointerType+"."),this.shapeNodesErased.clear(),R.info("Action: Eraser. PointerType: "+t.pointerType+".")},t.prototype.generateHitTestData=function(){this.hitTestDataMap=this.inkDryStore.generateHitTestData()},t.prototype.deleteInkCollections=function(t){var e=this;t.forEach((function(i){e.inkDryStore.unregisterInk(i)||t.delete(i)}));var i=[];t.forEach((function(t){i.push(t)})),this.viewModelModifier.deleteInkCollections(i)},t.prototype.hideInkCollections=function(t){var e=[];t.forEach((function(t){e.push(t)})),this.viewModelModifier.hideInkCollections(e)},t.prototype.ensurePlayStrokeHitHaptics=function(){var t=this;this.needPlayStrokeHitHaptics=!0,0===this.playHapticsInterval&&(this.playHapticsInterval=window.setInterval((function(){return t.playStrokeEraserHaptics()}),50))},t.prototype.clearHaptics=function(){0!==this.playHapticsInterval&&(this.hapticsExtractor.stop(),window.clearInterval(this.playHapticsInterval),this.playHapticsInterval=0,this.needPlayStrokeHitHaptics=!1,this.needRestartContinuousHaptics=!1)},t.prototype.playStrokeEraserHaptics=function(){var t,e=this;this.needPlayStrokeHitHaptics?(this.hapticsExtractor.play((function(){return l({waveformId:i.WAVEFORM_CLICK,intensity:e.hapticsExtractor.isPointerDown?1:.75,vendorId:"",alternates:[]})})),this.needPlayStrokeHitHaptics=!1,this.needRestartContinuousHaptics=!0):this.needRestartContinuousHaptics&&(null===(t=this.hapticsExtractor)||void 0===t||t.play((function(){return l({waveformId:i.WAVEFORM_ERASER_CONTINUOUS,intensity:1,vendorId:"",alternates:[]})})),this.needRestartContinuousHaptics=!1)},t}();function je(t){t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.restore()}const $e={alpha:!0,desynchronized:!1};function Ke(t,e,i,s,n){const o=function(t,e){const i=t.getContext("2d",e);if(null===i)throw new Error("Could not get 2D context from canvas.");return i}(t,n);return function(t,e,i,s,n){(function(t,e,i,s){t.style.width=`${i}px`,t.style.height=`${s}px`,t.width=i*e,t.height=s*e})(t,e,s,n),i.setTransform(1,0,0,1,0,0),i.scale(e,e)}(t,e,o,i,s),o}function qe(t,e,i,s){return Ke(t,e,i,s,$e)}class Je{constructor(){this.id=0,this.drawingAttributes=y,this.points=[]}streamChannels(t){this.points.forEach((e=>{t.addPoint(e),t.addPressure(function(t){return t.pressure}(e)),t.addTilt(e),t.addTimestamp(function(t){return t.timestamp}(e))}))}streamPoints(t){this.points.forEach((e=>{t.add(e)}))}streamPath(t){Ge(this,t,0)}stream(t){Ze(this,t,0)}add(t){this.points.push(t)}}function Ge(t,e,i){if(i+2>t.points.length)return i;e.beginStroke(t.points[i]);for(let s=i+1;s<t.points.length-1;s+=1)e.addPoint(t.points[s]);return e.endStroke(t.points[t.points.length-1]),t.points.length-1}function Ze(t,e,i){return e.setDrawingAttributes(t.drawingAttributes),Ge(t,e,i)}class Qe{beginStroke(t){this.output.add(t)}addPoint(t){this.output.add(t)}endStroke(t){this.output.add(t)}}class ti{constructor(t,e,i){this.context=t,this.fillStyle=e,this.strokeStyle=i}setDrawingAttributes(){}beginStroke(t){this.context.save(),this.context.lineCap="butt",this.context.lineJoin="miter",this.context.setLineDash([5,5]),this.context.fillStyle=this.fillStyle,this.context.strokeStyle=this.strokeStyle,this.context.beginPath(),this.context.moveTo(t.x,t.y)}addPoint(t){this.context.lineTo(t.x,t.y)}endStroke(t){this.addPoint(t),this.context.closePath(),this.context.fill(),this.context.stroke(),this.context.restore()}}var ei=function(){function t(t,e,i){this.transform=new V,this.adapter=new Qe,this.lassoStroke=new Je,this.hapticsExtractor=new p,this.inkDryStore=t,U(this.hapticsExtractor,this.transform,this.adapter,this.lassoStroke),this.context=qe(e,window.devicePixelRatio,e.clientWidth,e.clientHeight),this.renderer=new ti(this.context,"rgba(128, 128, 128, 0.39)","#9b9b9b"),this.viewModelModifier=i,this.hitTestDataMap=new Map}return t.prototype.onPointerDown=function(t){this.hapticsExtractor.onPointerDown(t),this.generateHitTestData(),this.viewModelModifier.clearSelection()},t.prototype.onPointerMove=function(t){this.hapticsExtractor.onPointerMove(t),je(this.context),this.lassoStroke.streamPath(this.renderer)},t.prototype.onPointerUp=function(t){this.hapticsExtractor.onPointerUp(t),this.hitTest(t.pointerType),this.lassoStroke=new Je,U(this.hapticsExtractor,this.transform,this.adapter,this.lassoStroke),je(this.context),R.info("Action: Lasso. PointerType: "+t.pointerType+".")},t.prototype.hitTest=function(t){var e=this,s=[];this.hitTestDataMap.forEach((function(t,i){var n=!1;t.strokeCollection.stream({add:function(t){!n&&function(t,e,i){const{enclosed:s,total:n}=function(t,e){let i=0,s=0;return t.streamPoints({add:t=>{(function(t,e){let i,s,n=0,o=0;const r={x:1e11,y:20},a=e=>{ce(s,e,t,r)&&(n+=1),s=e,o+=1},h={add:t=>{i=t,s=t,o+=1,h.add=a}};return e.streamPoints(h),!(o<3)&&(a(i),n%2==1)})(t,e)&&(i+=1),s+=1}}),{enclosed:i,total:s}}(t,e);return s/n>.6}(t,e.lassoStroke)&&(n=!0)}}),n&&s.push(i)})),R.info("Strokes lassoed count: "+s.length+". Pointer type: "+t+"."),0!==s.length&&this.hapticsExtractor.play((function(){return l({waveformId:i.WAVEFORM_CLICK,intensity:e.hapticsExtractor.isPointerDown?1:.75,vendorId:"",alternates:[]})})),this.viewModelModifier.selectInkCollections(s)},t.prototype.generateHitTestData=function(){this.hitTestDataMap=this.inkDryStore.generateHitTestData()},t}(),ii=function(){function t(t,e,s,n,o,r,a,h,u,c,p){var d=this;if(this.isPenOnly=!1,this.store=s,this.drawingHaptics=u,this.zoom=c,a?(this.drawer=h?new Tt(new ct(.5),new Et((function(){return Be.INSTANCE.getRulerModel()}),(function(){return d.getDrawingAttributes()}))):new ct(.5),N(this.drawer,this.injector=new re,this.store.collector)):(this.drawer=h?new Tt(_(),new Et((function(){return Be.INSTANCE.getRulerModel()}),(function(){return d.getDrawingAttributes()}))):_(),U(this.drawer,new B,this.injector=new re,this.store.collector)),this.eraser=new Ye(n,r),this.lasso=new ei(n,o,r),this.outputSwitcher=new _t(this.drawer,this.eraser,this.lasso),void 0!==window.PointerEvent)this.continuousHaptics=new At((function(){var t;if(d.outputSwitcher.output===d.drawer)t=d.drawingHaptics();else{if(d.outputSwitcher.output!==d.eraser)return;t=i.WAVEFORM_ERASER_CONTINUOUS}return l({waveformId:t,intensity:1,vendorId:"",alternates:[]})})),U(this.input=new qt(t),this.continuousHaptics,{output:this.outputSwitcher,onPointerDown:function(t){try{o.setPointerCapture(t.pointerId)}catch(t){}p(t.shiftKey,t),(Ot(t)||Rt(t))&&d.store.strokeBeginEndListener.dryAllStrokes(),d.outputSwitcher.onPointerDown(t),!d.isPenOnly&&lt(t)&&r.notifyPenDownOnCanvas()},onPointerMove:function(t){t.shiftKey&&!d.store.collector.isLineMode&&p(!0,t),d.outputSwitcher.onPointerMove(t)},onPointerUp:function(t){d.outputSwitcher.onPointerUp(t);try{o.releasePointerCapture(t.pointerId)}catch(t){}}},this.outputSwitcher);else if(void 0!==window.TouchEvent){var g=new ee(t);N(g,new ne,this.outputSwitcher),this.input=g}else{var m=new zt(t);N(m,new Vt,this.outputSwitcher),this.input=m}D(this.pointerActivation=new Ct(e),new Jt),D(this.pointerOverOut=new Lt(e),new It(t))}return t.prototype.getDrawingAttributes=function(){var t=this.injector.getDrawingAttributes();return new S(t).setWidth(t.width*this.zoom).setHeight(t.height*this.zoom).build()},t.prototype.activate=function(){this.input.activate(),this.activatePenOnly()},t.prototype.deactivate=function(){this.deactivatePenOnly(),this.input.deactivate()},t.prototype.activatePenOnly=function(){this.pointerActivation.activate(),this.pointerOverOut.activate(),this.isPenOnly=!0},t.prototype.deactivatePenOnly=function(){this.isPenOnly=!1,this.pointerOverOut.deactivate(),this.pointerActivation.deactivate()},t.prototype.setErasing=function(){this.outputSwitcher.normalOutput=this.eraser,this.store.strokeBeginEndListener.dryAllStrokes()},t.prototype.setDrawing=function(){this.outputSwitcher.normalOutput=this.drawer},t.prototype.setLassoing=function(){this.outputSwitcher.normalOutput=this.lasso,this.store.strokeBeginEndListener.dryAllStrokes()},t.prototype.updateZoom=function(t){this.zoom=t},t}();class si{constructor(){this.modifier=t=>t}setDrawingAttributes(t){this.output.setDrawingAttributes(this.modifier(t))}beginStroke(t){this.output.beginStroke(t)}addPoint(t){this.output.addPoint(t)}endStroke(t){this.output.endStroke(t)}}class ni{constructor(t){this.isLoopActive=!1,this.animationCallback=()=>{this.delegate(),this.isLoopActive&&window.requestAnimationFrame(this.animationCallback)},this.delegate=t}onStrokeBegin(){this.isLoopActive=!0,window.requestAnimationFrame(this.animationCallback)}onStrokeEnd(){this.isLoopActive=!1}}function oi(t){throw t}class ri{constructor(t){this.context=t}beginPath(){this.context.beginPath()}arc(t,e,i,s,n,o){this.context.arc(t,e,i,s,n,o)}circularArc(t,e,i,s,n,o,r,a,h){let u=Math.atan2(e-s,t-i),c=Math.atan2(r-s,o-i);u=u<0?2*Math.PI+u:u,c=c<0?2*Math.PI+c:c,this.arc(i,s,n,u,c,h)}lineTo(t,e){this.context.lineTo(t,e)}moveTo(t,e){this.context.moveTo(t,e)}closePath(){this.context.closePath()}}class ai{constructor(t,e,i){this.incomingTangent1={x:Number.NaN,y:Number.NaN},this.incomingTangent2={x:Number.NaN,y:Number.NaN},this.outgoingTangent1={x:Number.NaN,y:Number.NaN},this.outgoingTangent2={x:Number.NaN,y:Number.NaN},this.center={x:t,y:e},this.radius=i}}class hi{constructor(t,e){this.stroke=[],this.builder=t,this.tipRadius=e.width/2}beginStroke(t){this.builder.beginPath(),this.stroke=[],this.addPoint(t)}addPoint(t){const e=new ai(t.x,t.y,this.tipRadius*kt(t.pressure));this.stroke.push(e)}endStroke(t){this.addPoint(t),function(t){for(let e=1;e<t.length;e++){const i=t[e-1],s=t[e],n=i.center.x,o=i.center.y,r=i.radius,a=s.center.x,h=s.center.y,u=s.radius,c=n-a,l=o-h,p=Math.sqrt(c*c+l*l),d=Math.abs(u-r);if(d>p)continue;const g=1/p,m=d*g;let f=Math.sqrt(1-m*m),v=c*g,y=l*g;r>u&&(f=-f,v=-v,y=-y);const w=v*m,S=y*m,P=v*f,x=y*f,k=w+x,b=S-P,T=w-x,M=S+P;i.outgoingTangent1.x=n+r*k,i.outgoingTangent1.y=o+r*b,i.outgoingTangent2.x=n+r*T,i.outgoingTangent2.y=o+r*M,s.incomingTangent1.x=a+u*k,s.incomingTangent1.y=h+u*b,s.incomingTangent2.x=a+u*T,s.incomingTangent2.y=h+u*M}}(this.stroke),function(t,e){let i=0;for(let s=0;s<e.length;s++)(s===e.length-1||isNaN(e[s].outgoingTangent1.x))&&(ui(t,e,i,s),i=s+1)}(this.builder,this.stroke),this.builder.closePath()}}function ui(t,e,i,s){if(i===s){const s=e[i];return t.moveTo(s.center.x-s.radius,s.center.y),t.circularArc(s.center.x-s.radius,s.center.y,s.center.x,s.center.y,s.radius,s.center.x+s.radius,s.center.y,!1,!0),void t.circularArc(s.center.x+s.radius,s.center.y,s.center.x,s.center.y,s.radius,s.center.x-s.radius,s.center.y,!1,!0)}let n=e[i];t.moveTo(n.outgoingTangent1.x,n.outgoingTangent1.y);let o,r=n;n=e[i+1];for(let a=i+1;a<s;a++){o=e[a+1];const i=ci(r.outgoingTangent1,n.incomingTangent1,n.outgoingTangent1,o.incomingTangent1);void 0!==i?t.lineTo(i.x,i.y):(t.lineTo(n.incomingTangent1.x,n.incomingTangent1.y),t.circularArc(n.incomingTangent1.x,n.incomingTangent1.y,n.center.x,n.center.y,n.radius,n.outgoingTangent1.x,n.outgoingTangent1.y,!1,!0)),r=n,n=o}const a=n.radius>e[s-1].radius;t.lineTo(n.incomingTangent1.x,n.incomingTangent1.y),t.circularArc(n.incomingTangent1.x,n.incomingTangent1.y,n.center.x,n.center.y,n.radius,n.incomingTangent2.x,n.incomingTangent2.y,a,!0),r=n,n=e[s-1];for(let a=s-1;a>i;a--){o=e[a-1];const i=ci(r.incomingTangent2,n.outgoingTangent2,n.incomingTangent2,o.outgoingTangent2);void 0!==i?t.lineTo(i.x,i.y):(t.lineTo(n.outgoingTangent2.x,n.outgoingTangent2.y),t.circularArc(n.outgoingTangent2.x,n.outgoingTangent2.y,n.center.x,n.center.y,n.radius,n.incomingTangent2.x,n.incomingTangent2.y,!1,!0)),r=n,n=o}const h=n.radius>e[i+1].radius;t.lineTo(n.outgoingTangent2.x,n.outgoingTangent2.y),t.circularArc(n.outgoingTangent2.x,n.outgoingTangent2.y,n.center.x,n.center.y,n.radius,n.outgoingTangent1.x,n.outgoingTangent1.y,h,!0)}function ci(t,e,i,s){if((s.x-i.x)*(e.y-t.y)-(e.x-t.x)*(s.y-i.y)>0)return;const n=e.y-t.y,o=t.x-e.x,r=n*t.x+o*t.y,a=s.y-i.y,h=i.x-s.x,u=a*i.x+h*i.y,c=n*h-a*o;if(gt(c)){const l=1/c,p=(h*r-o*u)*l,d=(n*u-a*r)*l;if(li(p,d,t,e)&&li(p,d,i,s))return{x:p,y:d}}}function li(t,e,i,s){return(Math.min(i.x,s.x)<t||mt(Math.min(i.x,s.x),t))&&(Math.max(i.x,s.x)>t||mt(Math.max(i.x,s.x),t))&&(Math.min(i.y,s.y)<e||mt(Math.min(i.y,s.y),e))&&(Math.max(i.y,s.y)>e||mt(Math.max(i.y,s.y),e))}const pi=2*Math.PI;function di(t,e,i){t.arc(e.x,e.y,i,0,pi)}function gi(t,e,i,s){const n=e.x-i,o=e.x+i,r=e.y-s,a=e.y+s;t.moveTo(n,r),t.lineTo(o,r),t.lineTo(o,a),t.lineTo(n,a),t.lineTo(n,r)}function mi(t,e){t.moveTo(e.p1.x,e.p1.y),t.lineTo(e.p2.x,e.p2.y),t.lineTo(e.p3.x,e.p3.y),t.lineTo(e.p4.x,e.p4.y),t.lineTo(e.p1.x,e.p1.y)}class fi{constructor(t,e){this.quad={p1:{x:0,y:0},p2:{x:0,y:0},p3:{x:0,y:0},p4:{x:0,y:0}},this.builder=t,this.tipRadius=e.width/2}beginStroke(t){this.builder.beginPath(),this.updateRadius(t),di(this.builder,t,this.radius),this.lastPoint=t}addPoint(t){this.updateRadius(t),function(t,e,i,s,n){const o=i.x-t.x,r=i.y-t.y,a=Math.sqrt(o*o+r*r);if(a<=Math.abs(s-e))return!1;const h=o/a,u=-r/a,c=(s-e)/a,l=Math.sqrt(1-c*c),p=u*l+h*c,d=h*l-u*c,g=u*l-h*c,m=h*l+u*c;return n.p1.x=t.x-p*e,n.p1.y=t.y-d*e,n.p2.x=i.x-p*s,n.p2.y=i.y-d*s,n.p3.x=i.x+g*s,n.p3.y=i.y+m*s,n.p4.x=t.x+g*e,n.p4.y=t.y+m*e,!0}(t,this.radius,this.lastPoint,this.lastRadius,this.quad)&&(mi(this.builder,this.quad),di(this.builder,t,this.radius)),this.lastPoint=t}endStroke(t){this.addPoint(t),this.builder.closePath()}updateRadius(t){this.lastRadius=this.radius,this.radius=this.tipRadius*kt(t.pressure)}}class vi{constructor(t){this.builder=t}beginStroke(t){this.builder.beginPath(),this.builder.moveTo(t.x,t.y)}addPoint(t){this.builder.lineTo(t.x,t.y)}endStroke(t){this.addPoint(t)}}function yi(t,e,i,s,n,o,r){const a=t.x-e,h=t.y-i,u=t.x+e,c=t.y+i,l=s.x-n,p=s.y-o,d=s.x+n,g=s.y+o;if(l>=a&&p>=h&&d<=u&&g<=c||a>=l&&h>=p&&u<=d&&c<=g)return!1;const m=s.x-t.x>0?1:-1,f=s.y-t.y>0?1:-1;return r.p1.x=t.x-f*e,r.p1.y=t.y+m*i,r.p2.x=t.x+f*e,r.p2.y=t.y-m*i,r.p3.x=s.x+f*n,r.p3.y=s.y-m*o,r.p4.x=s.x-f*n,r.p4.y=s.y+m*o,!0}class wi{constructor(t,e,i,s){this.center={x:t,y:e},this.halfWidth=i,this.halfHeight=s}}class Si{constructor(t,e){this.stroke=[],this.quads=[],this.builder=t,this.tipWidth=e.width/2,this.tipHeight=e.height/2}beginStroke(t){this.builder.beginPath(),this.stroke=[],this.quads=[],this.addPoint(t)}addPoint(t){const e=kt(t.pressure),i=new wi(t.x,t.y,this.tipWidth*e,this.tipHeight*e),s=this.stroke.length;s>0&&function(t,e,i){const s={p1:{x:0,y:0},p2:{x:0,y:0},p3:{x:0,y:0},p4:{x:0,y:0}};yi(t.center,t.halfWidth,t.halfHeight,e.center,e.halfWidth,e.halfHeight,s)&&i.push(s)}(this.stroke[s-1],i,this.quads),this.stroke.push(i)}endStroke(t){this.addPoint(t),function(t,e,i){if(Pi(t,e[0]),0!==i.length){t.moveTo(i[0].p1.x,i[0].p1.y);for(let e=0;e<i.length;e++)t.lineTo(i[e].p2.x,i[e].p2.y),t.lineTo(i[e].p3.x,i[e].p3.y);for(let e=i.length-1;e>=0;e--)t.lineTo(i[e].p4.x,i[e].p4.y),t.lineTo(i[e].p1.x,i[e].p1.y);e.length>2&&Pi(t,e[e.length-2]),Pi(t,e[e.length-1])}}(this.builder,this.stroke,this.quads),this.builder.closePath()}}function Pi(t,e){gi(t,e.center,e.halfWidth,e.halfHeight)}class xi{constructor(t,e){this.quad={p1:{x:0,y:0},p2:{x:0,y:0},p3:{x:0,y:0},p4:{x:0,y:0}},this.builder=t,this.tipHalfWidth=e.width/2,this.tipHalfHeight=e.height/2}beginStroke(t){this.builder.beginPath(),this.updateSize(t),gi(this.builder,t,this.halfWidth,this.halfHeight),this.lastPoint=t}addPoint(t){this.updateSize(t),yi(t,this.halfWidth,this.halfHeight,this.lastPoint,this.lastHalfWidth,this.lastHalfHeight,this.quad)&&(mi(this.builder,this.quad),gi(this.builder,t,this.halfWidth,this.halfHeight)),this.lastPoint=t}endStroke(t){this.addPoint(t),this.builder.closePath()}updateSize(t){this.lastHalfWidth=this.halfWidth,this.lastHalfHeight=this.halfHeight;const e=kt(t.pressure);this.halfWidth=this.tipHalfWidth*e,this.halfHeight=this.tipHalfHeight*e}}class ki{constructor(t,e,i=new de){this.renderMode=0,this.context=t,this.canvasPathBuilder=new ri(t),this.effectResolver=e,this.colorResolver=i}setDrawingAttributes(t){this.attributes=t}beginStroke(t){this.pathBuilder=this.makeNewPathBuilder(),this.pathBuilder.beginStroke(t),this.beginPoint=t}addPoint(t){this.pathBuilder.addPoint(t)}endStroke(t){this.pathBuilder.endStroke(t),this.context.save(),function(t,e,i,s,n){t.lineWidth=e.height;const o=function(t,e,i,s,n){if(1===e.effect.type){const s=e.effect,o=i.toCanvasImageSource(s);if(void 0!==o){const i=t.createPattern(o,"repeat");if(null!==i){const o=.5;return t.scale(o,o),t.lineWidth=e.width/o,t.translate(n.x-s.offsetX,n.y-s.offsetY),i}}}return s.toCSSColor(e.color,e)}(t,e,i,s,n);switch(t.strokeStyle=o,t.fillStyle=o,e.tip){case"ellipse":t.lineCap="round",t.lineJoin="round";break;case"rectangle":t.lineCap="butt",t.lineJoin="miter";break;default:oi(e.tip)}switch(e.rasterOperation){case"copy":t.globalCompositeOperation="source-over";break;case"mask":t.globalCompositeOperation="darken";break;case"clear":t.globalCompositeOperation="destination-out";break;default:oi(e.rasterOperation)}}(this.context,this.attributes,this.effectResolver,this.colorResolver,this.beginPoint),2===this.renderMode?this.context.stroke():this.context.fill(),this.context.restore()}makeNewPathBuilder(){switch(this.renderMode){case 0:return"ellipse"===this.attributes.tip?new fi(this.canvasPathBuilder,this.attributes):new xi(this.canvasPathBuilder,this.attributes);case 1:return"ellipse"===this.attributes.tip?new hi(this.canvasPathBuilder,this.attributes):new Si(this.canvasPathBuilder,this.attributes);case 2:return new vi(this.canvasPathBuilder);default:oi(this.renderMode)}}}class bi{toCanvasImageSource(){}toSVGImageElement(){}}function Ti(t){var e=new ki(t,new bi);if(h())return e;var i=new si;return i.modifier=function(t){return"mask"===t.rasterOperation?new S(t).setColor(new f(t.color).setAlpha(.5).build()).build():t},D(i,e),i}var Mi=function(){function t(t,e,i){var s=this;this.strokeBeginEndListener={onStrokeBegin:function(){s.renderLoop.onStrokeBegin()},onStrokeEnd:function(){s.renderLoop.onStrokeEnd()}},this.incremental=!0,this.render=function(){s.incremental||s.clear(),s.store.collectChanges(s.transformer,s.incremental)},this.store=e,this.zoom=i>0?i:1,this.transformer=new si,this.wetContext=this.updateCanvasContext(this.zoom,t),this.wetRenderer=Ti(this.wetContext),D(this.transformer,this.wetRenderer),this.renderLoop=new ni(this.render)}return t.prototype.updateCanvasContext=function(t,e){var i=this;return this.wetContext=qe(e,window.devicePixelRatio,e.clientWidth,e.clientHeight),this.zoom=t>0?t:1,this.transformer.modifier=function(t){return new S(t).setWidth(t.width*i.zoom).setHeight(t.height*i.zoom).build()},this.wetContext},t.prototype.clear=function(){je(this.wetContext)},t.prototype.setIncrementalRender=function(t){this.incremental=t},t}();function Ei(){}class Ii{constructor(){this.baseId=0}generate(){return this.baseId+=1}setBaseId(t){this.baseId=t}}class Ai{constructor(t){this.idGenerator=new Ii,this.currentStroke=new Je,this.isLineMode=!1,this.inputStrokes=[],this.newPointsIndex=0,this.noop={add:Ei},this.output=this.noop,this.beginEndSink=t}setDrawingAttributes(t){this.currentStroke.drawingAttributes=t}beginStroke(t){this.newPointsIndex=0,this.currentStroke.id=this.idGenerator.generate(),this.beginEndSink.onStrokeBegin(),this.output=this.currentStroke,this.output.add(this.isLineMode?this.getConstantPressurePoint(t):t)}addPoint(t){this.isLineMode&&1===this.currentStroke.points.length?this.output.add(this.getConstantPressurePoint(t)):this.isLineMode&&this.currentStroke.points.length>1?this.currentStroke.points[this.currentStroke.points.length-1]=this.getConstantPressurePoint(t):this.output.add(t)}endStroke(t){this.output!==this.noop&&(this.isLineMode&&this.currentStroke.points.length>1?this.currentStroke.points[this.currentStroke.points.length-1]=this.getConstantPressurePoint(t):this.output.add(t),this.inputStrokes.push([this.currentStroke,this.newPointsIndex]),this.cancel())}makeCurrentStrokeStraight(){const t=this.currentStroke.points.length;t>=2&&(this.linePressure=this.getAveragePressureAcrossStroke(this.currentStroke),0===this.linePressure&&(this.linePressure=W),this.currentStroke.points.splice(1,t-2),this.currentStroke.points[0]=this.getConstantPressurePoint(this.currentStroke.points[0]),this.currentStroke.points[1]=this.getConstantPressurePoint(this.currentStroke.points[1]))}cancel(){this.output!==this.noop&&(this.output=this.noop,this.linePressure=void 0,this.currentStroke=new Je,this.beginEndSink.onStrokeEnd())}streamCollectedStrokes(t){this.inputStrokes.forEach((e=>{t.add(e[0]),e[1]=e[0].points.length-1}))}streamCollectedStrokesNewPoints(t){this.inputStrokes.forEach((e=>{e[1]=Ze(e[0],t,e[1])}))}resetCollectedStrokes(){this.inputStrokes=[]}streamCurrentStroke(t){this.newPointsIndex=Ze(this.currentStroke,t,0)}streamCurrentStrokeNewPoints(t){this.newPointsIndex=Ze(this.currentStroke,t,this.newPointsIndex)}getAveragePressureAcrossStroke(t){let e=0;for(let i=0;i<t.points.length;i+=1)e+=t.points[i].pressure;return 0===e||0===t.points.length?0:e/t.points.length}getConstantPressurePoint(t){return void 0===this.linePressure&&(this.linePressure=0===t.pressure?W:t.pressure),{x:t.x,y:t.y,pressure:this.linePressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timestamp}}}function Ci(t){const e=ae();return t.streamPoints({add:t=>{!function(t,e){t.left=Math.min(t.left,e.x),t.right=Math.max(t.right,e.x),t.top=Math.min(t.top,e.y),t.bottom=Math.max(t.bottom,e.y)}(e,t)}}),e}class Li{constructor(){this.strokes=[]}add(t){this.strokes.push(t)}stream(t){this.strokes.forEach((e=>{t.add(e)}))}}function Ri(t){const e=[];return t.stream({add:t=>{e.push(function(t){const e={id:t.id,drawingAttributes:t.drawingAttributes,x:[],y:[],pressure:[],tiltX:[],tiltY:[],timestamp:[]};return t.streamChannels({addPoint:t=>{e.x.push(t.x),e.y.push(t.y)},addPressure:t=>{e.pressure.push(t)},addTilt:t=>{e.tiltX.push(t.tiltX),e.tiltY.push(t.tiltY)},addTimestamp:t=>{e.timestamp.push(t)}}),JSON.stringify(e)}(t))}}),`[${e.join(",")}]`}var Oi=function(){function t(t){this.stroke=t}return t.prototype.getJSON=function(){var t=new Li;return t.add(this.stroke),Ri(t)},t.prototype.getBoundingBox=function(t,e){var i=Ci(this.stroke);return i.left+=t,i.right+=t,i.top+=e,i.bottom+=e,i},t}();function Di(t,e){return function(i){return{x:i.x+t,y:i.y+e,tiltX:i.tiltX,tiltY:i.tiltY,pressure:i.pressure,timestamp:i.timestamp}}}var Ni=function(){function t(t){this.scale=t}return t.prototype.add=function(t){var e,i,s,n=new pt,o=Ci(t);n.transform=(e=o.left/this.scale-o.left,i=o.top/this.scale-o.top,s=this.scale,function(t){return{x:(t.x+e)*s,y:(t.y+i)*s,pressure:t.pressure,tiltX:t.tiltX,tiltY:t.tiltY,timestamp:t.timestamp}});var r=new Je;r.id=t.id,r.drawingAttributes=t.drawingAttributes,N(n,new Qe,r),t.streamPath(n),this.output.add(r)},t}(),Ui=function(){function t(t){var e=this;this.strokeSink={add:function(){},begin:function(){},end:function(){}},this.collector=new Ai({onStrokeBegin:function(){e.strokeBeginEndListener.onStrokeBegin()},onStrokeEnd:function(){e.strokeBeginEndListener.onStrokeEnd()}}),this.zoom=t}return t.prototype.updateZoom=function(t){this.zoom=t},t.prototype.collectChanges=function(t,e){e?(this.collector.streamCurrentStrokeNewPoints(t),this.collector.streamCollectedStrokesNewPoints(t)):(this.collector.streamCurrentStroke(t),this.collector.streamCollectedStrokes({add:function(e){e.stream(t)}}))},t.prototype.setStrokeSink=function(t){this.strokeSink=t},t.prototype.setLineMode=function(t){this.collector.isLineMode=t},t.prototype.initializeDryStrokesCallback=function(){var t=this;this.strokeBeginEndListener.task=function(){t.strokeSink.begin();var e=new Ni(1/t.zoom);D(e,{add:function(e){t.strokeSink.add(new Oi(e))}}),t.collector.streamCollectedStrokes(e),t.collector.resetCollectedStrokes(),t.strokeSink.end()}},t}(),Wi=function(){function t(t,e){var i=this;this.task=function(){},this.executeTask=function(){i.task(),i.isIEOrFF?requestAnimationFrame((function(){window.setTimeout((function(){i.renderer.clear()}),0)})):i.renderer.clear(),i.resetPendingTask()},this.renderer=t,this.idleTimeToDryInk=e,this.isIEOrFF=o()||r()}return t.prototype.onStrokeBegin=function(){this.renderer.strokeBeginEndListener.onStrokeBegin(),void 0!==this.timeoutTask&&this.resetPendingTask()},t.prototype.onStrokeEnd=function(){this.renderer.strokeBeginEndListener.onStrokeEnd(),this.timeoutTask=window.setTimeout(this.executeTask,this.idleTimeToDryInk)},t.prototype.dryAllStrokes=function(){this.executeTask(),this.resetPendingTask()},t.prototype.resetPendingTask=function(){window.clearTimeout(this.timeoutTask)},t}(),Hi=3.77953,zi=function(){function t(t,e,i,n,o,r,a,h,u,c){var l=this;this.toolType=0,this.isLineMode=!1,this.wetCanvas=function(t,e){var i=T();return i.width=e.clientWidth,i.height=e.clientHeight,i.style.touchAction="none",i.style.pointerEvents="none",i.style.position="absolute",i.style.top="0",i.style.left="0",t.appendChild(i),R.info("Canvas created: width:"+i.width+" height:"+i.height),i}(t,e),this.inkMinutesMetric=new b(s,1),P||(new x(s,1),P=!0),this.targetElement=e,this.enableShiftStraightLine=c,this.store=new Ui(n),this.dryStore=o,this.dryStore.updateZoom(n),this.viewModelModifier=r,this.pipeline=new ii(this.wetCanvas,i,this.store,o,this.wetCanvas,r,h,u,(function(){return l.getDrawingHaptics()}),n,(function(t,e){return l.setLineMode(t,e)})),this.renderer=new Mi(this.wetCanvas,this.store,n),this.store.strokeBeginEndListener=new Wi(this.renderer,a),this.store.initializeDryStrokesCallback(),this.attributes=new S,this.color=new f,this.setColor("#000000"),this.selectPen(),this.zoom=n}return t.prototype.startPipeline=function(){this.pipeline.activate(),this.inkMinutesMetric.activate(this.wetCanvas)},t.prototype.stopPipeline=function(){this.renderer.clear(),this.pipeline.deactivate(),this.setDarkenMixBlendMode(!1),this.inkMinutesMetric.deactivate()},t.prototype.enableTouchMouse=function(){u(this.wetCanvas),this.pipeline.deactivatePenOnly()},t.prototype.disableTouchMouse=function(){this.pipeline.activatePenOnly(),c(this.wetCanvas)},t.prototype.setColor=function(t){this.attributes.setColor(this.color.setHexRGB(t).build()),this.pipeline.injector.setDrawingAttributes(this.attributes.build())},t.prototype.setThickness=function(t){switch(this.toolType){case 0:var e=(i=t,Math.min(13.22835,.94488*Math.pow(2,i-1)));this.attributes.setWidth(e).setHeight(e);break;case 1:e=function(t){return 7.55906*t}(t),this.attributes.setWidth(e/2).setHeight(e)}var i;this.pipeline.injector.setDrawingAttributes(this.attributes.build())},t.prototype.selectPen=function(){this.attributes.setColor(this.color.build()).setTip("ellipse").setRasterOperation("copy").setWidth(Hi).setHeight(Hi),this.pipeline.injector.setDrawingAttributes(this.attributes.build()),this.pipeline.setDrawing(),this.toolType=0,this.renderer.setIncrementalRender(!0),this.setDarkenMixBlendMode(!1),this.inkMinutesMetric.start(k.Pen)},t.prototype.selectHighlighter=function(){this.attributes.setColor(this.color.build()).setTip("rectangle").setRasterOperation("mask").setWidth(11.3386).setHeight(22.6772),this.pipeline.injector.setDrawingAttributes(this.attributes.build()),this.pipeline.setDrawing(),this.toolType=1,this.renderer.setIncrementalRender(h()),this.setDarkenMixBlendMode(!0),this.inkMinutesMetric.start(k.Highlighter)},t.prototype.setStrokeSink=function(t){this.store.setStrokeSink(t)},t.prototype.updateCanvasDimensions=function(){this.wetCanvas.style.width=this.targetElement.clientWidth+"px",this.wetCanvas.style.height=this.targetElement.clientHeight+"px",this.renderer.updateCanvasContext(this.zoom,this.wetCanvas),null!==this.wetCanvas.parentElement&&Be.INSTANCE.isActive()&&_e(this.targetElement.clientWidth,this.targetElement.clientHeight)},t.prototype.updateCanvasZoom=function(t){this.zoom=t,this.dryStore.updateZoom(t),this.pipeline.updateZoom(t),this.renderer.updateCanvasContext(this.zoom,this.wetCanvas),this.store.updateZoom(t),null!==this.wetCanvas.parentElement&&Be.INSTANCE.isActive()&&Be.INSTANCE.setScale(t)},t.prototype.selectEraser=function(){this.pipeline.setErasing(),this.viewModelModifier.clearSelection(),this.setDarkenMixBlendMode(!1),this.inkMinutesMetric.start(k.Erase)},t.prototype.setLineMode=function(t,e){this.enableShiftStraightLine&&(this.isLineMode=t,this.isLineMode&&s.logActivity("ShiftStraightLineUsage",0,["InputType"],[e.pointerType]),0!==this.toolType&&1!==this.toolType||this.renderer.setIncrementalRender(!this.isLineMode),this.store.setLineMode(t))},t.prototype.selectLasso=function(){this.attributes.setColor(this.color.build()).setTip("ellipse").setRasterOperation("copy").setWidth(Hi).setHeight(Hi),this.pipeline.injector.setDrawingAttributes(this.attributes.build()),this.pipeline.setLassoing(),this.setDarkenMixBlendMode(!1),this.inkMinutesMetric.start(k.Lasso)},t.prototype.toggleRuler=function(){null!==this.wetCanvas.parentElement&&(Be.INSTANCE.isActive()?Be.INSTANCE.deactivate():(function(t,e,i,s){var n;if(void 0===s&&(s=Ve),Xe(s))_e(e,i,s);else{var o=C();o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.overflow="hidden",o.style.touchAction="none",o.style.pointerEvents="none",o.style.zIndex="1",o.setAttribute("width",""+e),o.setAttribute("height",""+i),o.setAttribute("id",s),null===(n=t.parentElement)||void 0===n||n.appendChild(o)}}(this.wetCanvas.parentElement,this.targetElement.clientWidth,this.targetElement.clientHeight),Be.INSTANCE.activate(this.zoom)))},t.prototype.dryAllStrokes=function(){this.store.strokeBeginEndListener.dryAllStrokes()},t.prototype.setDarkenMixBlendMode=function(t){null!==this.wetCanvas.parentElement&&this.wetCanvas.parentElement.style.setProperty("mix-blend-mode",t?"darken":"normal")},t.prototype.getDrawingHaptics=function(){return"rectangle"===this.attributes.build().tip?i.WAVEFORM_MARKER_CONTINUOUS:i.WAVEFORM_INK_CONTINUOUS},t}(),Fi=function(){function t(){}return t.prototype.createEditorInkCanvas=function(t,e,i,s,n,o,r,a,h,u){return new zi(t,e,i,s,n,o,r,a,h,u)},t.prototype.setLogger=function(t){O(t)},t.prototype.setActivityLogger=function(t){n(t)},t}(),Vi=new Fi;const _i={tiltX:0,tiltY:0};class Xi{constructor(){this.id=0,this.drawingAttributes=y,this.points=[],this.pressures=[],this.tilts=[],this.timestamps=[]}streamChannels(t){this.points.forEach((e=>{t.addPoint(e)})),this.pressures.forEach((e=>{t.addPressure(e)})),this.tilts.forEach((e=>{t.addTilt(e)})),this.timestamps.forEach((e=>{t.addTimestamp(e)}))}streamPoints(t){this.points.forEach(((e,i)=>{t.add(this.getPoint(i))}))}streamPath(t){if(!(this.points.length<2)){t.beginStroke(this.getPoint(0));for(let e=1;e<this.points.length-1;e+=1)t.addPoint(this.getPoint(e));t.endStroke(this.getPoint(this.points.length-1))}}stream(t){t.setDrawingAttributes(this.drawingAttributes),this.streamPath(t)}addPoint(t){this.points.push(t)}addPressure(t){this.pressures.push(t)}addTilt(t){this.tilts.push(t)}addTimestamp(t){this.timestamps.push(t)}getPressure(t){return this.pressures.length>t?this.pressures[t]:W}getTilt(t){return this.tilts.length>t?this.tilts[t]:_i}getTimestamp(t){return this.timestamps.length>t?this.timestamps[t]:0}getPoint(t){return e=this.points[t],i=this.getPressure(t),s=this.getTilt(t),n=this.getTimestamp(t),{x:e.x,y:e.y,pressure:i,tiltX:s.tiltX,tiltY:s.tiltY,timestamp:n};var e,i,s,n}}function Bi(t){const e=new Li;return JSON.parse(t).forEach((t=>{e.add(function(t){return function(t){if(t.x.length!==t.y.length)throw new Error("X & Y don't match");if(0!==t.pressure.length&&t.pressure.length!==t.x.length)throw new Error("Pressure don't match X");if(t.tiltX.length!==t.tiltY.length)throw new Error("Tilt X & Y don't match");if(0!==t.tiltX.length&&t.tiltX.length!==t.x.length)throw new Error("Tilts don't match X.");if(0!==t.timestamp.length&&t.timestamp.length!==t.x.length)throw new Error("Timestamp don't match X")}(t),t.x.length===t.pressure.length&&t.x.length===t.tiltX.length&&t.x.length===t.timestamp.length?function(t){const e=new Je;return e.drawingAttributes=t.drawingAttributes,e.id=t.id,t.x.forEach(((i,s)=>{e.add({x:i,y:t.y[s],pressure:t.pressure[s],tiltX:t.tiltX[s],tiltY:t.tiltY[s],timestamp:t.timestamp[s]})})),e}(t):function(t){const e=new Xi;return e.drawingAttributes=t.drawingAttributes,e.id=t.id,t.x.forEach(((i,s)=>{e.addPoint({x:i,y:t.y[s]})})),t.pressure.forEach((t=>{e.addPressure(t)})),t.tiltX.forEach(((i,s)=>{e.addTilt({tiltX:i,tiltY:t.tiltY[s]})})),t.timestamp.forEach((t=>{e.addTimestamp(t)})),e}(t)}(t))})),e}class Yi{constructor(t){this.threshold=t*t}beginStroke(t){this.basePoint=t,this.midPoint=t,this.output.beginStroke(t)}addPoint(t){rt(this.basePoint,t,this.midPoint)>this.threshold?(this.output.addPoint(this.midPoint),this.basePoint=this.midPoint,this.midPoint=t):(nt(this.basePoint,t)<nt(this.basePoint,this.midPoint)&&(this.output.addPoint(this.midPoint),this.basePoint=this.midPoint),this.midPoint=t)}endStroke(t){this.addPoint(t),this.output.endStroke(t)}}class ji{constructor(t){this.points="",this.svgPolyline=t}setDrawingAttributes(t){this.svgPolyline.setAttribute("stroke-linecap","ellipse"===t.tip?"round":"square"),this.svgPolyline.setAttribute("stroke-width",""+2*t.width)}beginStroke(t){this.addPoint(t)}addPoint(t){this.points+=`${Math.round(t.x)},${Math.round(t.y)} `}endStroke(t){this.addPoint(t),this.svgPolyline.setAttribute("points",this.points),this.points=""}}function $i(t){var e=0,i=ae();return t.forEach((function(t){var s=Ci(t.stroke);he(i,s);var n=t.stroke.drawingAttributes;e=Math.max(e,n.width,n.height)})),{bounds:i,maxStrokeSize:e}}class Ki{constructor(t){this.modifier=new si,this.renderer=t,D(this.modifier,this.renderer)}add(t){this.modifier.modifier=t=>new S(t).setWidth(t.width+4.5).setHeight(t.height+4.5).build(),t.stream(this.modifier),this.modifier.modifier=t=>new S(t).setColor(g).setEffect(v).build(),t.stream(this.modifier)}}var qi=function(){function t(){this.canvas=T()}return t.prototype.deserializeJSON=function(t){var e=[];try{return Bi(t).stream({add:function(t){e.push(new Oi(t))}}),e}catch(t){return R.info("Unable to deserialize JSON. Excepton: "+t),e}},t.prototype.rasterizeStrokeCollectionWithZoom=function(t,e,i){return R.info("rasterizeStrokeCollectionWithZoom strokeCount="+t.length+" zoom="+e+" isSelected="+i),function(t,e,i,s){if(0===e.length)return{imageData:"",width:0,height:0,padding:0,isHighlighter:!1};var n=$i(e),o=n.bounds,r=n.maxStrokeSize,a=Math.ceil(2*r*i),h={left:o.left*i,top:o.top*i,right:o.right*i,bottom:o.bottom*i},u=Math.round(h.left),c=Math.round(h.top),l=Math.round(h.right)-u+2*a,p=Math.round(h.bottom)-c+2*a;t.width=l,t.height=p;var d=qe(t,window.devicePixelRatio,l,p);return d.translate(a+h.left-u,a+h.top-c),d.scale(i,i),d.translate(-o.left,-o.top),function(t,e,i){if(e){var s=new Ki(new ki(t,new bi));i.forEach((function(t){s.add(t.stroke)}))}else{var n=Ti(t);i.forEach((function(t){t.stroke.stream(n)}))}}(d,s,e),{imageData:t.toDataURL("image/png"),width:l,height:p,padding:a,isHighlighter:e.length>0&&"mask"===e[0].stroke.drawingAttributes.rasterOperation}}(this.canvas,t,e,i)},t.prototype.generateStrokeCollectionHitTestElement=function(t){return function(t){if(0===t.length)return{svgHitTestOverlay:C(),padding:0};var e=$i(t),i=e.bounds,s=e.maxStrokeSize,n=Math.ceil(2*s),o=Math.round(i.right-i.left),r=Math.round(i.bottom-i.top),a=o+2*n,h=r+2*n,u=C();return t.forEach((function(t){var e=M("polyline");u.setAttribute("width",""+a),u.setAttribute("height",""+h),e.setAttribute("stroke","black"),e.setAttribute("stroke-opacity","0.0"),e.setAttribute("fill","none"),u.appendChild(e);var s=new ji(e),n=new Yi(.7),o=new pt;o.transform=Di(-i.left,-i.top),N(n,o,s),s.setDrawingAttributes(t.stroke.drawingAttributes),t.stroke.streamPath(n)})),u.setAttribute("viewBox","-"+n+" -"+n+" "+a+" "+h),{svgHitTestOverlay:u,padding:n}}(t)},t.prototype.containsPencilInkContent=function(t){var e=!1;return t.forEach((function(t){2===t.stroke.drawingAttributes.effect.type&&(e=!0)})),e},t}(),Ji=new(function(){function t(){}return t.prototype.createEditorInkStrokeRasterizer=function(){return new qi},t}());function Gi(t){const e=ae();return t.stream({add:t=>{he(e,Ci(t))}}),e}function Zi(t,e){var i=new Li,s=new pt;s.transform=e;var n=new Qe;return t.stream({add:function(t){var e=new Je;e.id=t.id,e.drawingAttributes=t.drawingAttributes,N(s,n,e),t.streamPath(s),i.add(e)}}),i}function Qi(t,e){return Zi(t,function(t){return function(e){return{x:e.x*t,y:e.y*t,tiltX:e.tiltX,tiltY:e.tiltY,pressure:e.pressure,timestamp:e.timestamp}}}(e))}function ts(t,e){if(0===e)return t;var i=Gi(t);return function(t,e,i,s){return Zi(t,function(t,e,i){var s=i*Math.PI/180,n=Math.cos(s),o=Math.sin(s);return function(i){var s=i.x-t,r=i.y-e;return{x:s*n-r*o+t,y:s*o+r*n+e,tiltX:i.tiltX,tiltY:i.tiltY,pressure:i.pressure,timestamp:i.timestamp}}}(e,i,s))}(t,(i.right-i.left)/2,(i.bottom-i.top)/2,e)}function es(t,e,i){return Zi(t,Di(e,i))}function is(t){var e=Gi(t);return es(t,-e.left,-e.top)}var ss=function(){function t(t,e){this.zoom=1,this.inkObjectsMap=new Map,this.slideViewElement=t,this.slideViewportElement=e}return t.prototype.updateSlideElements=function(t,e){this.slideViewElement=t,this.slideViewportElement=e},t.prototype.registerInkWithStrokeCollection=function(t,e){if(!this.inkObjectsMap.has(e)){var i=new Li;t.forEach((function(t){i.add(t.stroke)}));var s=is(i);this.inkObjectsMap.set(e,{json:Ri(s),strokeCollection:Qi(s,this.zoom),locationInSlideView:{x:Number.MAX_VALUE,y:Number.MAX_VALUE},rotation:0})}},t.prototype.unregisterInk=function(t){return this.inkObjectsMap.delete(t)},t.prototype.updateZoom=function(t){var e=this;if(this.zoom!==t){this.zoom=t;try{this.inkObjectsMap.forEach((function(t,i){e.inkObjectsMap.set(i,{json:t.json,strokeCollection:ts(Qi(Bi(t.json),e.zoom),t.rotation),locationInSlideView:t.locationInSlideView,rotation:t.rotation})}))}catch(t){R.info("Unable to deserialize JSON in updateZoom. Excepton: "+t)}}},t.prototype.updateInkSlideViewLocation=function(t,e,i,s,n){if(this.inkObjectsMap.has(t)){var o=this.inkObjectsMap.get(t);if(void 0!==o){if(void 0!==s&&s.length>0&&(s!==o.json||n!==o.rotation))try{var r=is(Bi(s)),a=ts(Qi(r,this.zoom),n);return void this.inkObjectsMap.set(t,{json:Ri(r),strokeCollection:a,locationInSlideView:{x:e,y:i},rotation:n})}catch(t){return void R.info("Unable to deserialize JSON in updateInkSlideViewLocation. Excepton: "+t)}void 0!==s&&0!==s.length||R.info("Incoming JSON was undefined or of zero length!"),this.inkObjectsMap.set(t,{json:o.json,strokeCollection:o.strokeCollection,locationInSlideView:{x:e,y:i},rotation:o.rotation})}}},t.prototype.clearStore=function(){this.inkObjectsMap.clear()},t.prototype.generateHitTestData=function(){var t=new Map,e=this.calculateDistanceBetweenSlideviewAndFishbowl();return this.inkObjectsMap.forEach((function(i,s){var n=es(i.strokeCollection,i.locationInSlideView.x+e.x,i.locationInSlideView.y+e.y);t.set(s,{strokeCollection:n,bounds:Gi(n)})})),t},t.prototype.calculateDistanceBetweenSlideviewAndFishbowl=function(){return void 0!==this.slideViewElement&&void 0!==this.slideViewportElement?{x:this.slideViewElement.getBoundingClientRect().left-this.slideViewportElement.getBoundingClientRect().left,y:this.slideViewElement.getBoundingClientRect().top-this.slideViewportElement.getBoundingClientRect().top}:{x:0,y:0}},t}(),ns=new(function(){function t(){}return t.prototype.createEditorInkDryStore=function(t,e){return new ss(t,e)},t}());ink=e})();
//# sourceMappingURL=ink.js.map